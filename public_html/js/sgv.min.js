var Cookie={set:(t,n,i)=>{i={path:"/",...i};if(navigator.cookieEnabled){let e=encodeURIComponent(t)+"="+encodeURIComponent(n);i.days&&"number"==typeof i.days&&((t=new Date).setTime(t.getTime()+24*i.days*60*60*1e3),e+="; expires="+t.toUTCString()),i.path&&(e+="; path="+i.path),i.domain&&(e+="; domain="+i.domain),i.secure&&(e+="; secure"),window.document.cookie=e}},get:e=>{var t;if(""!==window.document.cookie)for(t of window.document.cookie.split(/; */)){var[n,i]=t.split("=");if(n===decodeURIComponent(e))return decodeURIComponent(i)}},delete:(e,t)=>{t={path:"/",...t};let n=encodeURIComponent(e)+"=";t.path&&(n+="; path="+t.path),n+="; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie=n}},Settings={};void 0===window.api?(Settings.get=e=>Cookie.get(e),Settings.set=e=>{for(var t in e)Cookie.set(t,e[t])}):(console.log("Settings in desktopApp!"),Settings.get=e=>window.api.invoke("getSetting",e),Settings.set=e=>{window.api.invoke("setSettings",e)});const DEMO_MODE=!1;function getRandom(e,t){return e+Math.random()*(t-e)}function valueToColor(e){var t,n,i,s;return null==e||isNaN(e)?new BABYLON.Color3(.9,.9,.9):DEMO_MODE?0===e?new BABYLON.Color3(0,0,1):-1===e?new BABYLON.Color3(1,0,0):1===e?new BABYLON.Color3(0,1,0):.5===e?new BABYLON.Color3(1,.65,0):-.5===e?new BABYLON.Color3(1,0,1):new BABYLON.Color3(.9,.9,.9):(s=sgv.graf.greenLimit,t=sgv.graf.redLimit,s=0<e?(n=0,1-(i=e<s?e/s:1)):e<0?(i=0,1-(n=t<e?e/t:1)):(i=n=0,1),new BABYLON.Color3(n,i,s))}function valueToColorBAK(e){var t,n,i,s;return null==e||isNaN(e)?new BABYLON.Color3(.9,.9,.9):(s=sgv.graf.greenLimit,t=sgv.graf.redLimit,s=0<e?(i=e<s?e/s:1,n=0):i=e<0?(n=t<e?e/t:1,0):n=0,new BABYLON.Color3(n,i,s))}function valueToEdgeWidth(e){var t,n;return DEMO_MODE||null==e||isNaN(e)||(n=Math.abs(sgv.graf.greenLimit),n=(t=Math.abs(sgv.graf.redLimit))<n?n:t,0===e)||0===n?.2:n<(e=Math.abs(e))?1.2:.2+e/n}var isMobile=!1;function detectClient(){var e=navigator.userAgent.toLowerCase();isMobile=-1<e.indexOf("android")||-1<e.indexOf("blackberry")||-1<e.indexOf("iemobile")||-1<e.indexOf("opera mini")||-1<e.indexOf("iphone")||-1<e.indexOf("ipod")||-1<e.indexOf("ipad")}detectClient(),window.addEventListener("load",()=>{var e=document.querySelector(":root"),t=this.document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),isMobile?(t.setAttribute("href","css/mobile.css"),e.style.setProperty("--isMobile",1),e.style.setProperty("@mobile",1)):(t.setAttribute("href","css/desktop.css"),e.style.setProperty("--isMobile",0)),document.head.appendChild(t)});const SVG={NS:"http://www.w3.org/2000/svg",createSVG:(e,t,n,i)=>{var s=document.createElementNS(SVG.NS,"svg");return s.setAttributeNS(null,"id",e),s.setAttributeNS(null,"height",n),s.setAttributeNS(null,"width",t),"function"==typeof i&&s.addEventListener("click",i),s.style.display="block",s},createSVG2:(e,t,n,i)=>{var s=document.createElementNS(SVG.NS,"svg");return s.setAttributeNS(null,"id",e),s.setAttributeNS(null,"viewBox","0 0 "+t+" "+n),"function"==typeof i&&s.addEventListener("click",i),s.style.display="block",s},drawSvgText:(e,t,n,i,s,a,o,l)=>{var r=document.createElementNS(SVG.NS,"text");r.setAttributeNS(null,"id","text_"+t),r.setAttributeNS(null,"x",n),r.setAttributeNS(null,"y",i),r.setAttributeNS(null,"text-anchor","middle"),r.setAttributeNS(null,"alignment-baseline","middle"),r.setAttributeNS(null,"font-size","12px"),r.setAttributeNS(null,"font-family","Arial, Helvetica, sans-serif"),r.setAttributeNS(null,"fill",a),r.textContent=s,e.appendChild(r),r.addEventListener("click",l),""!==o&&((a=document.createElementNS(SVG.NS,"rect")).setAttributeNS(null,"id","textBG_"+t),a.setAttributeNS(null,"x",n-12),a.setAttributeNS(null,"y",i-7),a.setAttributeNS(null,"width",24),a.setAttributeNS(null,"height",12),a.setAttributeNS(null,"fill",o),e.insertBefore(a,r),a.addEventListener("click",l))},drawSvgNode:(e,t,n,i,s,a,o)=>{var l=document.createElementNS(SVG.NS,"circle");l.setAttributeNS(null,"id","node_"+t),l.setAttributeNS(null,"cx",n),l.setAttributeNS(null,"cy",i),l.setAttributeNS(null,"r",s),l.setAttributeNS(null,"fill",a),l.setAttributeNS(null,"stroke","black"),l.setAttributeNS(null,"stroke-width","1"),e.appendChild(l),l.addEventListener("click",o)},drawSvgEdge:(e,t,n,i,s,a,o,l,r)=>{var d=document.createElementNS(SVG.NS,"line");d.setAttributeNS(null,"id","edge_"+t),d.setAttributeNS(null,"x1",n),d.setAttributeNS(null,"y1",i),d.setAttributeNS(null,"x2",s),d.setAttributeNS(null,"y2",a),d.setAttributeNS(null,"stroke",o),d.setAttributeNS(null,"stroke-width",l),e.appendChild(d),d.addEventListener("click",r)}};var Dispatcher={graphDeleted:()=>{sgv.SPS.reset(),sgv.SPS.refresh(),sgv.dlgMissingNodes.delAll(),sgv.dlgCPL.setModeSelection(),sgv.dlgCellView.hide(),enableMenu("menuGraphSave",!1),enableMenu("menuGraphClear",!1),enableMenu("menuViewDisplayMode",!1),enableMenu("menuViewCellView",!1)},graphCreated:()=>{sgv.dlgCellView.hide(),sgv.dlgCPL.setModeDescription(),sgv.graf.displayValues(),hideSplash(),enableMenu("menuGraphSave",!0),enableMenu("menuGraphClear",!0),enableMenu("menuViewDisplayMode",!0),enableMenu("menuViewCellView",!0)},graphChanged:()=>{sgv.dlgCPL.refresh(),sgv.dlgCellView.refresh(),sgv.dlgNodeProperties.refresh(),sgv.dlgEdgeProperties.refresh(),sgv.SPS.refresh()},currentScopeChanged:()=>{sgv.dlgCPL.refresh(),sgv.dlgCellView.refresh(),sgv.dlgNodeProperties.refresh(),sgv.dlgEdgeProperties.refresh(),sgv.SPS.refresh()},viewModeChanged:()=>{sgv.dlgCellView.refresh(),sgv.dlgNodeProperties.refresh(),sgv.dlgEdgeProperties.refresh(),sgv.SPS.refresh()}},SPS=function(e){var s=new BABYLON.SolidParticleSystem("NodeSPS",e,{isPickable:!0,expandable:!0,enableDepthSort:!0}),r=new BABYLON.SolidParticleSystem("EdgeSPS",e,{isPickable:!0,expandable:!0,enableDepthSort:!0}),a=0,o=0,t=[],n=[],l=BABYLON.MeshBuilder.CreateSphere("defaultSphere",{diameter:3,segments:8,updatable:!1}),d=BABYLON.MeshBuilder.CreateCylinder("cylinder",{height:1,diameter:1,tessellation:6,updatable:!1});function i(){s.setParticles(),s.refreshVisibleSize()}function c(){r.setParticles(),r.refreshVisibleSize()}function p(){i(),c()}function u(){var e=o++,t=s.nbParticles;if(t<=e){var n=100,i=s.nbParticles;s.addShape(l,n="number"!=typeof n?100:n),s.buildMesh();for(let e=i;e<i+n;e++)s.particles[e].isVisible=!1}return e}function g(){var e=a++,t=r.nbParticles;if(t<=e){var n=500,i=r.nbParticles;r.addShape(d,n="number"!=typeof n?500:n),r.buildMesh();for(let e=i;e<i+n;e++)r.particles[e].isVisible=!1}return e}return l.setEnabled(!1),d.setEnabled(!1),{init:function(t,n){"number"!=typeof n&&(n=500),s.addShape(l,t="number"!=typeof t?100:t),s.buildMesh();for(let e=0;e<t;e++)s.particles[e].isVisible=!1;r.addShape(d,n),r.buildMesh();for(let e=0;e<n;e++)r.particles[e].isVisible=!1;p()},reset:function(){a=o=0},onPick:function(e){var t=e.pickedMesh.name;return t===s.name?{type:"node",id:s.particles[s.pickedParticle(e).idx].nodeId}:t===r.name?{type:"edge",id:r.particles[r.pickedParticle(e).idx].edgeId}:{type:"unknown",id:-1}},refresh:p,refreshNodes:i,refreshEdges:c,bindNode:function(e,t,n){var i=u();return void 0!==(i=s.particles[i])?(i.position=t,i.color=n,i.isVisible=!0,i.nodeId=e.id,i):null},updateNodeValue:function(e,t){e=e.meshId(),(e=s.particles[e]).color=t,e.isVisible=!0},unbindNode:function(e){e=e.meshId(),s.particles[e].isVisible=!1,s.particles[e].nodeId=null,t.push(e)},bindEdge:function(e){var t=g();return void 0!==(t=r.particles[t])?(t.edgeId=e.id,t):null},setEdge:function(e,t,n,i,s){var e=e.meshId(),e=r.particles[e],a=BABYLON.Vector3.Distance(i,s),o=s.subtract(i),l=(o.normalize(),new BABYLON.Vector3);l.copyFrom(i),l.addInPlace(o.scale(a/2)),e.rotation=BABYLON.Vector3.PitchYawRollToMoveBetweenPoints(i,s),e.position=l,e.color=t,e.scaling=new BABYLON.Vector3(n,a,n),e.isVisible=!0},updateEdgeGeometry:function(e,t,n){var e=e.meshId(),e=r.particles[e],i=BABYLON.Vector3.Distance(t,n),s=n.subtract(t),a=(s.normalize(),new BABYLON.Vector3);a.copyFrom(t),a.addInPlace(s.scale(i/2)),e.rotation=PitchYawRollToMoveBetweenPoints(t,n),e.position=a,e.isVisible=!0},updateEdgeValue:function(e,t,n){e=e.meshId(),(e=r.particles[e]).color=t,e.scaling.x=n,e.scaling.z=n,e.isVisible=!0},unbindEdge:function(e){e=e.meshId(),r.particles[e].isVisible=!1,r.particles[e].edgeId=null,n.push(e)}}},GraphSize=function(e,t,n,i,s){this.cols=e,this.rows=t,this.lays=n,this.KL=i,this.KR=s},GraphDescr=function(){this.size=new GraphSize(0,0,0,0,0),this.set=function(e,t,n,i,s,a){this.setType(e),this.setSize(t,n,i,s,a)},this.setType=function(e){this.type=e},this.setSize=function(e,t,n,i,s){this.size=new GraphSize(e,t,n,i,s)}},TempGraphStructure=function(){this.nodes=[],this.edges=[],this.addEdge1=function(e,t,n){this.edges.push({n1:e,n2:t,values:{default:n}})},this.addEdge2=function(e,t,n){this.edges.push({n1:e,n2:t,values:n})},this.addNode1=function(e,t,n){e={id:e,values:{default:t},label:null};void 0!==n&&(e.label={text:n,enabled:!0}),this.nodes.push(e)},this.addNode2=function(e,t,n){e={id:e,values:t,label:null};void 0!==n&&(e.label={text:n,enabled:!0}),this.nodes.push(e)}},Label=function(e,t,n){this.createMe=async function(e,t){this.plane=this.createPlane(),this.plane.position=e.add(this.planeOffset),this.plane.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_ALL,this.plane.setEnabled(t),this.plane.isPickable=!1},this.setText=async function(e,t){this.text=e,null!==this.plane&&this.plane.dispose(),this.createMe(this.position,t)},this.getText=function(){return this.text},this.setPosition=function(e){this.position=e,null!==this.plane&&(this.plane.position=e.add(this.planeOffset))},this.createPlane=function(){var e="normal 64px Arial,Helvetica,sans-serif",t=new BABYLON.DynamicTexture("DynamicTexture",64,sgv.scene).getContext(),t=(t.font=e,t.measureText(this.text).width+8),n=BABYLON.MeshBuilder.CreatePlane(this.id+"_plane",{width:.05*t,height:3.6,updatable:!0},sgv.scene);return n.material=new BABYLON.StandardMaterial(this.id+"_plane_material",sgv.scene),n.material.diffuseTexture=new BABYLON.DynamicTexture(this.id+"_plane_texture",{width:t,height:72},sgv.scene,!1),n.material.diffuseTexture.hasAlpha=!0,n.material.opacityTexture=n.material.diffuseTexture,n.material.transparencyMode=BABYLON.Material.MATERIAL_ALPHABLEND,n.material.alpha=1,n.material.diffuseTexture.drawText(this.text,null,null,e,"#ffff00","rgba(0,0,255,0.7)",!0),n.material.emissiveColor=new BABYLON.Color3(1,1,0),n},this.setEnabled=function(e){null!==this.plane?this.plane.setEnabled(e):e&&this.createMe(this.position,!0)},this.text=t,this.planeOffset=new BABYLON.Vector3(0,5,0),this.position=n,this.id=e,this.plane=null};const createLabel=function(e,t){return new Label("q"+e,"q"+e,t)};var Node=function(e,t,n,i,s,a){var o;this.parentGraph=e,"number"!=typeof(t="string"==typeof t?parseInt(t,10):t)&&console.warning("Node id should be a number, but is: "+t),this.id=t,this.active=!0,this._chckedEdges=0,this.labelIsVisible=!1,this.values={default:Number.NaN};for(const l in a)this.values[l]=a[l];Object.defineProperty(this,"position",{get(){return this.mesh.position},set(e){this.mesh.position.copyFrom(e),null!==o.plane&&o.plane.position.copyFrom(e)}}),this.dispose=function(){sgv.SPS.unbindNode(this),null!==o&&null!==o.plane&&o.plane.dispose(),delete this.label},this.clear=function(){this.dispose()},this.showLabel=function(e){void 0!==e&&(this.labelIsVisible=e),o.setEnabled(this.labelIsVisible&&this.parentGraph.labelsVisible)},this.setLabel=function(e,t){void 0!==t&&(this.labelIsVisible=t),o.setText(e,this.labelIsVisible&&this.parentGraph.labelsVisible)},this.isLabelVisible=function(){return this.labelIsVisible},this.getLabel=function(){return o.getText()},this.move=function(e){this.mesh.position.addInPlace(e)},this.addCheck=function(){this._chckedEdges++},this.delCheck=function(){this._chckedEdges--},this.getValue=function(e){return void 0===e&&(e=this.parentGraph.currentScope),this.values.hasOwnProperty(e)?this.values[e]:Number.NaN},this.delValue=function(e){(e=void 0===e?this.parentGraph.currentScope:e)in this.values&&delete this.values[e]},this.setValue=function(e,t){void 0===t&&(t=this.parentGraph.currentScope),this.values[t]=e},this.displayValue=function(e){e=valueToColor((e=void 0===e?this.parentGraph.currentScope:e)in this.values?this.values[e]:Number.NaN);sgv.SPS.updateNodeValue(this,e)},this.currentColor=function(e){return(e=void 0===e?this.parentGraph.currentScope:e)in this.values?valueToColor(this.values[e]):new BABYLON.Color4(.2,.2,.2)},this.meshId=()=>this.mesh.idx,this.mesh=sgv.SPS.bindNode(this,new BABYLON.Vector3(n,i,s),this.currentColor()),null===this.mesh?console.error("Can't bind NodeSPS"):o=createLabel(this.id,this.mesh.position)},Edge=(Node.fromQDescr=(e,t)=>{var n=e.calcPosition2(t.x,t.y,t.z,t.n0());return new Node(e,t.toNodeId(e.rows,e.cols),n.x,n.y,n.z)},Node.fromXYZIJK=(e,t,n,i,s,a,o)=>Node.fromQDescr(e,qD(t,n,i,s,a,o)),function(e,t,n){this.parentGraph=e,this.values={default:Number.NaN},"string"==typeof t&&(t=parseInt(t,10)),"string"==typeof n&&(n=parseInt(n,10)),"number"==typeof t&&"number"==typeof n||console.warning("Edge begin and end ids should be both a numbers, but are: "+t+" and "+n),t in this.parentGraph.nodes||console.warning("First node not exists in graph: "+t),n in this.parentGraph.nodes||console.warning("Second node not exists in graph: "+n),t<n?(this.begin=t,this.end=n):(this.begin=n,this.end=t),this.id=Edge.calcId(this.begin,this.end),this._checked=!1,this.meshId=()=>i.idx,this.clear=function(){sgv.SPS.unbindEdge(this)},this.switchCheckFlag=function(){this._checked=!this._checked,this.parentGraph.checkNode(this.begin,this._checked),this.parentGraph.checkNode(this.end,this._checked)},this.delValue=function(e){(e=void 0===e?this.parentGraph.currentScope:e)in this.values&&delete this.values[e]},this.getValue=function(e){return void 0===e&&(e=this.parentGraph.currentScope),this.values.hasOwnProperty(e)?this.values[e]:Number.NaN},this.setValue=function(e,t){this.values[t=void 0===t?"default":t]=e,this.displayValue(t)},this.displayValue=function(e){void 0===e&&(e="default");let t=new BABYLON.Color3(.2,.2,.2),n=.1;e in this.values&&(t=valueToColor(this.values[e]),n=valueToEdgeWidth(this.values[e])),sgv.SPS.updateEdgeValue(this,t,n)},this.update=()=>{var e=this.values[this.parentGraph.currentScope],t=valueToColor(e),e=valueToEdgeWidth(e),n=this.parentGraph.nodePosition(this.begin),i=this.parentGraph.nodePosition(this.end);sgv.SPS.setEdge(this,t,e,n,i)};var i=sgv.SPS.bindEdge(this);null===i?console.error("Can't bind EdgeSPS"):this.update()});Edge.calcId=(e,t)=>("string"==typeof e&&(e=parseInt(e,10)),"string"==typeof t&&(t=parseInt(t,10)),"number"==typeof e&&"number"==typeof t||console.error("Edge begin and end must be a numbers"),e<t?e+","+t:t+","+e);const qD=function(e,t,n,i,s,a){return new QbDescr(e,t,n,i,s,a)},QbDescr=function(e,t,n,i,s,a){this.x=e,this.y=t,this.z=n,this.i=i,this.j=s,this.k=a,this.n0=function(){return((this.i<<1)+this.j<<1)+this.k},this.n1=function(){return((this.i<<1)+this.j<<1)+this.k+1},this.toNodeId=function(e,t){return 8*(this.x+(this.y+this.z*e)*t)+this.n1()}},Graph=(QbDescr.fromNodeId=function(e,t,n){var e=e-1,i=e%8,s=i%2,a=(i>>1)%2,i=(i>>2)%2,e=e>>3,t=n*t,o=Math.floor(e/t),e=e%t,t=Math.floor(e/n),e=e%n;return new QbDescr(e,t,o,i,a,s)},function(){this.nodes={},this.edges={},this.missing={},this.type="generic",this.scopeOfValues=["default"],this.currentScope="default",this.greenLimit=1,this.redLimit=-1,this.labelsVisible=!1,this.dispose=function(){for(const e in this.edges)this.edges[e].clear(),delete this.edges[e];for(const t in this.nodes)this.nodes[t].clear(),delete this.nodes[t];Dispatcher.graphDeleted()},this.clear=function(){this.dispose()},this.maxNodeId=function(){return Object.keys(this.nodes).length},this.addNode=function(e,t){values={},"number"==typeof t&&(values.default=t);t=this.calcPosition(e),e=new Node(this,e,t.x,t.y,t.z,values);return e.showLabel(!1),this.nodes[e.id]=e},this.getKeyByValue=function(t,n){return Object.keys(t).find(e=>t[e]===n)},this.getScopeIndex=function(t){return Object.keys(this.scopeOfValues).find(e=>this.scopeOfValues[e]===t)},this.addEdge=function(e,t){var n=Edge.calcId(e,t);return n in this.edges?(console.log("edge already exists",n),this.edges[n]):(e=new Edge(this,e,t),this.edges[n]=e)},this.delEdge=function(e){this.edges[e].clear(),delete this.edges[e],Dispatcher.graphChanged()},this.findAllConnected=i=>{var s={internal:[],horizontal:[],vertical:[],up:[],down:[],other:[]};function e(e){var t=QbDescr.fromNodeId(i,sgv.graf.rows,sgv.graf.cols),n=QbDescr.fromNodeId(e,sgv.graf.rows,sgv.graf.cols);(t.x===n.x&&t.y===n.y&&t.z===n.z?s.internal:t.x!==n.x&&t.y===n.y&&t.z===n.z?s.horizontal:t.x===n.x&&t.y!==n.y&&t.z===n.z?s.vertical:t.z<n.z?s.up:t.z>n.z?s.down:s.other).push(e)}for(const t in this.edges)this.edges[t].begin==i?e(this.edges[t].end):this.edges[t].end==i&&e(this.edges[t].begin);return s},this.findAndDeleteEdges=function(e){var t={};console.log("graf.findAndDeleteEdges",e);for(const n in this.edges)this.edges[n].begin.toString()===e?(t[this.edges[n].end]={values:this.edges[n].values},this.delEdge(n)):this.edges[n].end.toString()===e&&(t[this.edges[n].begin]={values:this.edges[n].values},this.delEdge(n));return t},this.delNode=function(e){var t=this.findAndDeleteEdges(e);this.missing[e]={label:{text:this.nodes[e].getLabel(),enabled:this.nodes[e].isLabelVisible()},values:this.nodes[e].values,edges:{}};for(const n in t)this.missing[e].edges[n]=t[n];this.nodes[e].clear(),delete this.nodes[e],sgv.dlgMissingNodes.addNode(e),Dispatcher.graphChanged()},this.restoreNode=function(e){if(e in this.nodes)return!1;if(!(e in this.missing))return!1;var t=this.calcPosition(e);this.nodes[e]=new Node(this,e,t.x,t.y,t.z,this.missing[e].values),this.nodes[e].setLabel(this.missing[e].label.text,this.missing[e].label.enabled);for(const s in this.missing[e].edges){var n=parseInt(s,10);if(n in this.nodes){var i=new Edge(this,e,s);console.log(i);for(const a in this.missing[e].edges[n].values)i.setValue(this.missing[e].edges[n].values[a],a);this.edges[i.id]=i,console.log(i.id)}else n in this.missing&&(this.missing[n].edges[e]=this.missing[e].edges[n])}return delete this.missing[e],0===Object.keys(this.missing).length&&sgv.dlgMissingNodes.hide(),Dispatcher.graphChanged(),!0},this.findAndUpdateEdges=function(e){for(const t in this.edges)this.edges[t].begin.toString()!==e&&this.edges[t].end.toString()!==e||this.edges[t].update()},this.stringToStruct=e=>{if(null==e)return null;for(var t,n={nodes:{},edges:{}},i=e.split("\n");0<i.length;)"#"!==i[0][0]&&null!==(t=function(e){e=e.split(" ");return 3===e.length?{n1:parseInt(e[0],10),n2:parseInt(e[1],10),val:parseFloat(e[2],10)}:null}(i[0]))&&(t.n1===t.n2?n.nodes[t.n1]=t.val:n.edges[Edge.calcId(t.n1,t.n2)]=t.val),i.shift();return n},this.loadScopeValues=(e,t)=>{let n=!1;void 0===e||this.scopeOfValues.includes(e)||(this.scopeOfValues.push(e),n=!0);var i=this.stringToStruct(t);for(const s in i.nodes)this.nodes[s].setValue(i.nodes[s],e);for(const a in i.edges)this.edges[a].setValue(i.edges[a],e);return this.displayValues(e),{n:n,i:this.scopeOfValues.indexOf(e)}},this.addScopeOfValues=function(e){return void 0===e||this.scopeOfValues.includes(e)?-1:(this.scopeOfValues.push(e),this.scopeOfValues.indexOf(e))},this.delScopeOfValues=function(e){if(void 0!==e&&"default"!==e){var t=this.scopeOfValues.indexOf(e);if(-1!==t){this.scopeOfValues.splice(t,1);for(const n in this.nodes)this.nodes[n].delValue(e);return this.currentScope===e&&(this.currentScope="default",this.displayValues("default")),this.scopeOfValues.indexOf(this.currentScope)}}return-1},this.hasScope=function(e){return void 0!==e&&this.scopeOfValues.includes(e)},this.displayValues=async function(e){void 0!==e&&this.scopeOfValues.includes(e)?this.currentScope=e:e=this.currentScope;for(const t in this.nodes)this.nodes[t].displayValue(e);for(const n in this.edges)this.edges[n].displayValue(e);return Dispatcher.currentScopeChanged(),!0},this.nodePosition=function(e){return this.nodes[e].position},this.checkNode=function(e,t){t?this.nodes[e].addCheck():this.nodes[e].delCheck()},this.edgeDoubleClicked=function(e){this.edges[e].switchCheckFlag()},this.moveNode=function(e,t){this.nodes[e].move(t),this.findAndUpdateEdges(e)},this.setEdgeValue=function(e,t,n){this.edges[e].setValue(t,n),this.edges[e].displayValue()},this.delEdgeValue=function(e,t){this.edges[e].delValue(t),this.edges[e].displayValue()},this.edgeValue=function(e,t){return this.edges[e].getValue(t)},this.setNodeValue=function(e,t,n){this.nodes[e].setValue(t,n),this.nodes[e].displayValue()},this.delNodeValue=function(e,t){this.nodes[e].delValue(t),this.nodes[e].displayValue()},this.nodeValue=function(e,t){return this.nodes[e].getValue(t)},this.getMinMaxEdgeVal=function(e){void 0!==e&&this.scopeOfValues.includes(e)||(e=this.currentScope);var t={min:Number.MAX_VALUE,max:-Number.MAX_VALUE,com:""};let n=!0;for(const s in this.edges){var i=this.edges[s].getValue(e);isNaN(i)||(n=!1,i<t.min&&(t.min=i),t.max<i&&(t.max=i))}return n&&(t.min=Number.NaN,t.max=Number.NaN,t.com="\nWARNING: The graph has no edge that has a weight in the current scope.\n"),t},this.getMinMaxNodeVal=function(e){void 0!==e&&this.scopeOfValues.includes(e)||(e=this.currentScope);var t={min:Number.MAX_VALUE,max:-Number.MAX_VALUE,com:""};let n=!0;for(const s in this.nodes){var i=this.nodes[s].getValue(e);isNaN(i)||(n=!1,i<t.min&&(t.min=i),t.max<i&&(t.max=i))}return n&&(t.min=Number.NaN,t.max=Number.NaN,t.com="\nWARNING: The graph has no node that has a value in the current scope.\n"),t},this.getMinMaxVal=function(e){void 0!==e&&this.scopeOfValues.includes(e)||(e=this.currentScope);var t=this.getMinMaxNodeVal(e),e=this.getMinMaxEdgeVal(e);return isNaN(t.min)?{min:e.min,max:e.max}:isNaN(e.min)?{min:t.min,max:t.max}:{min:(t.min<e.min?t:e).min,max:(t.max>e.max?t:e).max}},this.calcPosition=e=>new BABYLON.Vector3,this.setDisplayMode=function(){for(const e in this.nodes)this.nodes[e].position=this.calcPosition(e);for(const t in this.edges)this.edges[t].update();Dispatcher.viewModeChanged()},this.showLabels=function(e){this.labelsVisible=e;for(const t in this.nodes)this.nodes[t].showLabel()},this.createStructureFromTempStruct=function(s){return new Promise(e=>{for(var t of s.nodes){var n=this.addNode(t.id);n.values=t.values,null!==t.label?n.setLabel(t.label.text,t.label.enabled):n.showLabel(!1)}for(var i of s.edges)this.addEdge(i.n1,i.n2).values=i.values;this.showLabels(!0),e("ok")})},this.scale=function(e,t,n){return t===n?.5:(e-t)/(n-t)}}),Chimera=(Graph.displayModes=["classic","triangle","diamond"],Graph.currentDisplayMode="classic",Graph.switchDisplayMode=()=>{if(null===sgv.graf)console.warning("graf not defined");else{let e=Graph.displayModes.indexOf(Graph.currentDisplayMode)+1;e===Graph.displayModes.length&&(e=0),Graph.currentDisplayMode=Graph.displayModes[e],sgv.graf.setDisplayMode()}},Graph.knownGraphTypes={},Graph.registerType=(e,t)=>{Graph.knownGraphTypes[e]=t},Graph.knowType=e=>e in Graph.knownGraphTypes,Graph.create=(e,t)=>{Graph.remove(),e instanceof GraphDescr&&e.type in Graph.knownGraphTypes?(sgv.graf=new Graph.knownGraphTypes[e.type](e.size),t instanceof TempGraphStructure?sgv.graf.createStructureFromTempStruct(t).then(()=>Dispatcher.graphCreated()):sgv.graf.createDefaultStructure(()=>Dispatcher.graphCreated())):console.error("unknown graph type")},Graph.remove=()=>{null!==sgv.graf&&(sgv.graf.dispose(),sgv.graf=null,Dispatcher.graphDeleted())},function(e){Graph.call(this),this.type="chimera",this.setSize=function(e){e instanceof GraphSize?(this.cols=e.cols,this.rows=e.rows,this.layers=e.lays,this.KL=e.KL,this.KR=e.KR):(this.cols=2,this.rows=2,this.layers=1,this.KL=4,this.KR=4)},this.setSize(e),this.maxNodeId=function(){return this.cols*this.rows*8},this.connect=function(e,t,n){var e=e.toNodeId(this.rows,this.cols),t=t.toNodeId(this.rows,this.cols);e in this.nodes&&t in this.nodes&&(e=this.addEdge(e,t),"number"==typeof n)&&e.setValue(n)},this.connectVertical=function(e,t,n){for(var i of[0,1])for(var s of[0,1])this.connect(new QbDescr(e,t,n,0,i,s),new QbDescr(e,t+1,n,0,i,s))},this.connectHorizontal=function(e,t,n){for(var i of[0,1])for(var s of[0,1])this.connect(new QbDescr(e,t,n,1,i,s),new QbDescr(e+1,t,n,1,i,s))},this.connectInternalChimeraEdges=function(e,t,n){var i,s=Number.NaN;for(i of[0,1])for(var a of[0,1])for(var o of[0,1])for(var l of[0,1])this.connect(new QbDescr(e,t,n,0,i,a),new QbDescr(e,t,n,1,o,l),s)},this.modulePositionTEST=function(e,t,n){e=(this.rows-1)/2*50-50*e,t=50*t-(this.cols-1)/2*50,n=50*n-(this.layers-1)/2*50;return new BABYLON.Vector3(e,n,t)},this.modulePosition=function(e,t,n){t=(this.cols-1)/2*50-50*t,e=50*e-(this.rows-1)/2*50,n=50*n-(this.layers-1)/2*50;return new BABYLON.Vector3(t,n,e)},this.calcPosition2=function(e,t,n,i){e=this.modulePosition(e,t,n);return e.addInPlace(this.getNodeOffset2(i)),e},this.calcPosition=function(e){e=QbDescr.fromNodeId(e,this.rows,this.cols);return this.calcPosition2(e.x,e.y,e.z,e.n0())},this.addNodeXYZIJK=function(e,t,n,i,s,a){return this.addNode(qD(e,t,n,i,s,a).toNodeId(this.rows,this.cols))},this.addNodeXYZn=function(e,t,n,i){return this.addNode(qD(e,t,n,i>>2&1,i>>1&1,1&i).toNodeId(this.rows,this.cols))},this.createModuleNodes=function(t,n,i){for(let e=0;e<this.KL;e++)this.addNodeXYZn(t,n,i,e);for(let e=0;e<this.KR;e++)this.addNodeXYZn(t,n,i,e+4)},this.getNodeOffset2=function(e){return{classic:[new BABYLON.Vector3(15,-3,-10),new BABYLON.Vector3(5,-1,-10),new BABYLON.Vector3(-5,1,-10),new BABYLON.Vector3(-15,3,-10),new BABYLON.Vector3(15,3,10),new BABYLON.Vector3(5,1,10),new BABYLON.Vector3(-5,-1,10),new BABYLON.Vector3(-15,-3,10)],diamond:[new BABYLON.Vector3(0,-5,15),new BABYLON.Vector3(0,-1,5),new BABYLON.Vector3(0,1,-5),new BABYLON.Vector3(0,5,-15),new BABYLON.Vector3(15,5,0),new BABYLON.Vector3(5,1,0),new BABYLON.Vector3(-5,-1,0),new BABYLON.Vector3(-15,-5,0)],triangle:[new BABYLON.Vector3(-15,-3,9),new BABYLON.Vector3(-15,-1,3),new BABYLON.Vector3(-15,1,-3),new BABYLON.Vector3(-15,3,-9),new BABYLON.Vector3(9,3,15),new BABYLON.Vector3(3,1,15),new BABYLON.Vector3(-3,-1,15),new BABYLON.Vector3(-9,-3,15)]}[Graph.currentDisplayMode][e]},this.verticalConnections=()=>{for(let n=0;n<this.layers;n++)for(let t=0;t<this.rows-1;t++)for(let e=0;e<this.cols;e++)this.connectVertical(e,t,n)},this.horizontalConnections=()=>{for(let n=0;n<this.layers;n++)for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols-1;e++)this.connectHorizontal(e,t,n)},this.createModules=()=>{for(let n=0;n<this.layers;n++)for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++)this.createModuleNodes(e,t,n),this.connectInternalChimeraEdges(e,t,n)},this.createDefaultStructure=function(e){1<this.layers&&(this.layers=1),sgv.dlgLoaderSplash.setInfo("creating modules",()=>{this.createModules(),sgv.dlgLoaderSplash.setInfo("creating vertical connections",()=>{this.verticalConnections(),sgv.dlgLoaderSplash.setInfo("creating horizontal connections",()=>{this.horizontalConnections(),"function"==typeof e&&e()})})})}});Chimera.prototype=Object.create(Graph.prototype),Chimera.prototype.constructor=Chimera,Graph.registerType("chimera",Chimera);var Pegasus=function(e){Chimera.call(this,e),this.type="pegasus",this.pegasusConnections=()=>{for(let n=0;n<this.layers;n++)for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++)this.connectInternalPegasusEdges(e,t,n),this.connectExternalPegasusEdges(e,t,n)},this.createDefaultStructure=function(e){sgv.dlgLoaderSplash.setInfo("creating modules",()=>{this.createModules(),sgv.dlgLoaderSplash.setInfo("creating vertical connections",()=>{this.verticalConnections(),sgv.dlgLoaderSplash.setInfo("creating horizontal connections",()=>{this.horizontalConnections(),sgv.dlgLoaderSplash.setInfo("creating specific pegasus connections",()=>{this.pegasusConnections(),"function"==typeof e&&e()})})})})},this.connectExternalPegasusEdges=function(e,t,n){let i,s,a,o,l,r,d,c;DEMO_MODE?(i=l=0,s=r=-1,a=d=1,o=c=.5):i=s=a=o=l=r=d=c=Number.NaN;var p,u=0===e,g=e===this.cols-1,h=0===t,v=t===this.rows-1,f=n===this.layers-1;for(p of[0,1])for(var y of[0,1])for(var b of[0,1])f?(g||v||(this.connect(new QbDescr(e,t,n,0,0,p),new QbDescr(e+1,t+1,0,1,y,b),l),this.connect(new QbDescr(e,t,n,1,0,p),new QbDescr(e+1,t+1,0,0,y,b),r)),v||this.connect(new QbDescr(e,t,n,0,1,p),new QbDescr(e,t+1,0,1,y,b),d),g||this.connect(new QbDescr(e,t,n,1,1,p),new QbDescr(e+1,t,0,0,y,b),c)):(this.connect(new QbDescr(e,t,n,0,0,p),new QbDescr(e,t,n+1,1,y,b),i),this.connect(new QbDescr(e,t,n,1,0,p),new QbDescr(e,t,n+1,0,y,b),s),u||this.connect(new QbDescr(e,t,n,0,1,p),new QbDescr(e-1,t,n+1,1,y,b),a),h||this.connect(new QbDescr(e,t,n,1,1,p),new QbDescr(e,t-1,n+1,0,y,b),o))},this.connectInternalPegasusEdges=function(e,t,n){let i;i=DEMO_MODE?-.5:Number.NaN;for(var s of[0,1])for(var a of[0,1])this.connect(new QbDescr(e,t,n,s,a,0),new QbDescr(e,t,n,s,a,1),i)}},UI=(Pegasus.prototype=Object.create(Chimera.prototype),Pegasus.prototype.constructor=Pegasus,Graph.registerType("pegasus",Pegasus),function(){});UI.tag=function(e,t,n,i){var s=document.createElement(e);for(const a in t)s.setAttribute(a,t[a]);for(const o in n)s[o]=n[o];for(const l in i)"string"==typeof l&&"function"==typeof i[l]&&s.addEventListener(l,i[l]);return s},UI.span=function(e,t){return UI.tag("span",t,{textContent:e})},UI.selectByKey=function(e,t){t=UI.findOption(e,t.toString());return-1<t&&(e.selectedIndex=t,!0)},UI.clearSelect=function(e,t){for(var n=t?0:1;n<e.options.length;n++)e.removeChild(e.options[n]),n--},UI.findOption=function(e,t){for(var n=0;n<e.options.length;n++)if(e.options[n].value===t)return n;return-1},UI.option=function(e,t,n){var i=document.createElement("option");return i.value=e,i.text=t,void 0!==n&&(i.selected=n?"selected":""),i},UI.input=function(e){var t=document.createElement("input");for(const n in e)t.setAttribute(n,e[n]);return t},UI.newInput=function(e,t,n,i){var s=document.createElement("input");return s.setAttribute("type",e),s.value=t,void 0!==n&&""!==n&&s.setAttribute("class",n),void 0!==i&&""!==i&&s.setAttribute("id",i),s},UI.createTitlebar=function(e,t){var n=UI.tag("div",{class:"title"});return t&&n.appendChild(UI.tag("button",{class:"hidebutton"},{innerHTML:'<span id="X">❌</span><span id="value"></span>'})),n.appendChild(UI.tag("span",{class:"titleText"},{textContent:e})),n},UI.createEmptyWindow=function(e,t,n,i){var s=document.createElement("div");void 0!==e&&""!==e&&s.setAttribute("class",e),void 0!==t&&""!==t&&s.setAttribute("id",t);let a=UI.createTitlebar(n,i);return s.offset={x:0,y:0},s.isDown=!1,a.addEventListener("mouseover",function(){a.style.cursor="pointer",movable=!0}),a.addEventListener("mouseout",function(){movable=!1}),a.addEventListener("mousedown",function(e){s.isDown=movable,s.offset={x:s.offsetLeft-e.clientX,y:s.offsetTop-e.clientY}},!0),a.addEventListener("mouseup",function(){s.isDown=!1},!0),document.addEventListener("mousemove",function(e){s.isDown&&(e={x:e.clientX,y:e.clientY},s.style.left=e.x+s.offset.x+"px",s.style.top=e.y+s.offset.y+"px")},!0),s.appendChild(a),s.setAttribute("tabindex","0"),s},UI.createTransparentBtn=function(e,t,n){e=UI.tag("input",{type:"button",value:e,class:"sgvTransparentButton1",id:t});return"function"==typeof n&&e.addEventListener("click",function(){n()}),e},UI.createTransparentBtn1=function(e,t,n){t=UI.tag("button",{class:"sgvTransparentButton1",id:t});return t.appendChild(UI.tag("span",{},{innerHTML:e})),"function"==typeof n&&t.addEventListener("click",function(){n()}),t};const GenericWindow=function(e,t,n){var i,s=null,a=(this.ui=UI.tag("div",{class:"sgvUIwindow"}),!1);void 0!==e&&""!==e&&this.ui.setAttribute("id",e);let o=UI.tag("div",{class:"title"});o.appendChild(UI.tag("span",{class:"titleText"},{textContent:t})),"closeButton"in n&&!0===n.closeButton&&((e=UI.tag("input",{type:"button",class:"hidebutton",value:"❌"})).addEventListener("click",()=>this._hide()),o.appendChild(e)),this.ui.appendChild(o),"setMovable"in n&&!0===n.setMovable&&((i=this.ui).offset={x:0,y:0},i.isDown=!1,o.addEventListener("mouseover",function(){o.style.cursor="pointer",a=!0}),o.addEventListener("mouseout",function(){a=!1}),o.addEventListener("mousedown",function(e){i.isDown=a,i.offset={x:i.offsetLeft-e.clientX,y:i.offsetTop-e.clientY}},!0),o.addEventListener("mouseup",function(){i.isDown=!1},!0),document.addEventListener("mousemove",function(e){i.isDown&&(e={x:e.clientX,y:e.clientY},i.style.left=e.x+i.offset.x+"px",i.style.top=e.y+i.offset.y+"px")},!0)),this.ui.setAttribute("tabindex","0"),window.addEventListener("load",()=>window.document.body.appendChild(this.ui)),this._show=()=>{s=window.document.activeElement,this.ui.style.display="block",this.ui.focus({focusVisible:!1})},this._hide=()=>{this.ui.style.display="none",null!==s&&s.focus({focusVisible:!1})},this._switch=()=>{"none"===this.ui.style.display?this._show():this._hide()},this._test=function(){console.log("test 1a")}};function ExePanel(){function e(e){var t=UI.tag("div");return t.append(UI.tag("input",{type:"button",id:"btnDelPath"+e,value:"➖"}),UI.tag("input",{type:"text",id:"dispBtn"+e,value:"Button text"}),UI.tag("input",{type:"text",id:"editPath"+e,value:"d:/any/path/to/prog.exe"}),UI.tag("input",{type:"button",id:"btnPath"+e,value:"..."})),t}var t=[];t.push(e(1)),t.push(e(2)),t.push(e(3));let n=UI.tag("div",{class:"content",id:"graphSelection"});return t.forEach(e=>{n.appendChild(e)}),n.appendChild(UI.tag("input",{type:"button",id:"btnDelPath1",value:"➕"})),{ui:n}}function KnownProgsPanel(){function e(e){var t=UI.tag("div");let n;return t.append(UI.tag("input",{type:"checkbox",id:"chkPath"+e,checked:"checked"}),UI.tag("label",{for:"editPath"+e},{innerHTML:" Path to prog."+e+" "}),n=UI.tag("input",{type:"text",id:"editPath"+e,value:"d:/any/path/to/prog.exe"}),UI.tag("input",{type:"button",id:"btnPath"+e,value:"..."},{},{click:()=>{let e=UI.tag("input",{type:"file",id:"inputfile",display:"none"});e.addEventListener("change",()=>{void 0!==e.files[0]&&(n.value=e.files[0].name)}),e.click()}})),t}var t=[];t.push(e(1)),t.push(e(2)),t.push(e(3));let n=UI.tag("div",{class:"content",id:"graphSelection"});return t.forEach(e=>{n.appendChild(e)}),{ui:n}}GenericWindow.prototype.show=this._show,GenericWindow.prototype.hide=this._hide,GenericWindow.prototype.switch=this._switch,GenericWindow.prototype.test=()=>{console.log("test 1")};const DlgPreferences=function(){GenericWindow.call(this,"sgvPrefsDlg","Preferences",{closeButton:!0,setMovable:!0});var e,t;this.ui.appendChild(KnownProgsPanel().ui),this.ui.appendChild(((e=UI.tag("div",{id:"buttons"})).appendChild(UI.tag("input",{type:"button",class:"actionbutton",id:"cplCancelButton",name:"cancelButton",value:"Cancel"},{},{click:this._hide})),t=UI.tag("input",{type:"button",class:"actionbutton",id:"cplCreateButton",name:"createButton",value:"OK"}),e.appendChild(t),{ui:e}).ui)};var parentPrototype=Object.create(GenericWindow.prototype);(parentPrototype.constructor=DlgPreferences).prototype=parentPrototype;const DEFAULT_SCOPE="default";var sgv="undefined"==typeof exports?function(){}:exports,ParserTXT=("undefined"!=typeof global&&(global.sgv=sgv),sgv.version="1.0.0",sgv.engine=null,sgv.scene=null,sgv.camera=null,sgv.graf=null,sgv.createScene=function(){var e;sgv.scene=new BABYLON.Scene(sgv.engine),sgv.camera=new BABYLON.ArcRotateCamera("Camera",0,0,10,new BABYLON.Vector3(0,0,0),sgv.scene),sgv.camera.setPosition(new BABYLON.Vector3(166,150,0)),sgv.camera.attachControl(sgv.canvas,!0),sgv.camera.inputs.attached.pointers.panningSensibility=25,sgv.camera.upperBetaLimit=Math.PI/2*.99,sgv.camera.inertia=.5,(e=new BABYLON.HemisphericLight("HemiLight",new BABYLON.Vector3(0,1,0),sgv.scene)).intensity=.75,e.parent=sgv.camera,e.position=new BABYLON.Vector3(0,0,0),sgv.SPS=new SPS(sgv.scene),sgv.SPS.init(),sgv.nodeToConnect=0,sgv.addEventsListeners(),sgv.scene.clearColor=new BABYLON.Color3(.7,.7,.7)},sgv.addEventsListeners=function(){var a,o,l=null;function r(){var e=sgv.scene.pick(sgv.scene.pointerX,sgv.scene.pointerY,function(e){return e===l});return e.hit?e.pickedPoint:null}function d(e){function t(e){console.log("LEFT"),e.pickInfo.hit?(e=e.pickInfo,"node"===(e=sgv.SPS.onPick(e)).type&&e.id in sgv.graf.nodes?(console.log("Node picked"),0!==sgv.nodeToConnect?(sgv.graf.addEdge(sgv.nodeToConnect,e.id),sgv.nodeToConnect=0,sgv.SPS.refresh()):sgv.dlgNodeProperties.show(e.id,sgv.scene.pointerX,sgv.scene.pointerY)):"edge"===e.type&&e.id in sgv.graf.edges?(console.log("Edge picked"),sgv.dlgEdgeProperties.show(e.id,sgv.scene.pointerX,sgv.scene.pointerY)):(console.log("Unknown mesh picked"),sgv.dlgEdgeProperties.hide(),sgv.dlgNodeProperties.hide())):(console.log("Probably ground picked"),sgv.dlgEdgeProperties.hide(),sgv.dlgNodeProperties.hide())}switch(e.event.button){case 0:t(e);break;case 1:n=e,console.log("MIDDLE"),n.pickInfo.hit&&"node"===(n=sgv.SPS.onPick(n.pickInfo)).type&&n.id in sgv.graf.nodes&&(console.log("Node picked"),0===sgv.nodeToConnect?sgv.nodeToConnect=n.id:(sgv.graf.addEdge(sgv.nodeToConnect,n.id),sgv.nodeToConnect=0,sgv.SPS.refresh()));break;case 2:console.log("RIGHT")}var n}sgv.scene.onPointerObservable.add(function(e){switch(e.type){case BABYLON.PointerEventTypes.POINTERTAP:d(e);break;case BABYLON.PointerEventTypes.POINTERDOUBLETAP:e.pickInfo.hit&&e.pickInfo.pickedMesh!==l&&"edge"===(s=(s=e.pickInfo.pickedMesh).name.split(":"))[0]&&sgv.graf.edgeDoubleClicked(s[1]);break;case BABYLON.PointerEventTypes.POINTERDOWN:e.pickInfo.hit&&e.pickInfo.pickedMesh!==l&&(s=e,console.log("POINTER.DOWN"),o=s.pickInfo.pickedMesh,a=r())&&setTimeout(function(){sgv.camera.detachControl(sgv.canvas)},0),null!==sgv.graf&&sgv.graf.showLabels(!1);break;case BABYLON.PointerEventTypes.POINTERUP:null!==sgv.graf&&sgv.graf.showLabels(!0),a&&(sgv.camera.attachControl(sgv.canvas,!0),a=null);break;case BABYLON.PointerEventTypes.POINTERMOVE:null!==sgv.graf&&a&&(t=r())&&(n=t.subtract(a),"node"===(i=o.name.split(":"))[0])&&(sgv.graf.moveNode(parseInt(i[1],10),n),a=t)}var t,n,i,s})},sgv.display=function(n){void 0!==n&&"object"==typeof n||(n={}),showSplashAndRun(()=>{let e=null;function t(){return new BABYLON.Engine(sgv.canvas,!0,{doNotHandleContextLost:!0,preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!1})}null===(e="target"in n?document.getElementById(n.target):e)&&((e=document.createElement("div")).setAttribute("id","sgvWorkspaceArea"),document.body.appendChild(e)),sgv.canvas=document.createElement("canvas"),sgv.canvas.setAttribute("id","sgvRenderCanvas"),e.appendChild(sgv.canvas),window.initFunction=async function(){if(sgv.engine=await async function(){try{return t()}catch(e){return console.log("the available createEngine function failed. Creating the default engine instead"),t()}}(),!sgv.engine)throw"engine should not be null.";sgv.engine.enableOfflineSupport=!1,sgv.createScene()},initFunction().then(function(){let e=sgv.scene;sgv.engine.runRenderLoop(function(){e&&e.activeCamera&&e.render()})}),window.addEventListener("resize",function(){sgv.engine.resize(),detectClient()}),desktopInit()})},{}),ParserGEXF=(ParserTXT.importGraph=e=>{var t=new TempGraphStructure,n=[],i=e.split("\n");let s=new GraphDescr;for(var a,o,l;0<i.length;)"#"!==i[0][0]?(a=i[0],l=o=void 0,null!==(o=(a=a.trim().split(/\s+/)).length<3||(o=parseInt(a[0],10),l=parseInt(a[1],10),a=parseFloat(a[2],10),isNaN(o))||isNaN(l)?null:{n1:o,n2:l,val:a})&&(n.push(o),o.n1===o.n2?t.addNode1(o.n1,o.val):t.addEdge1(o.n1,o.n2,o.val))):1<(l=i[0].trim().split(/\s+/)).length&&("type"===(a=(a=l[1]).split("="))[0]?s.setType(a[1]):"size"===a[0]&&(5<=(a=a[1].split(",")).length?s.setSize(parseInt(a[0],10),parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3],10),parseInt(a[4],10)):4===a.length&&s.setSize(parseInt(a[0],10),parseInt(a[1],10),1,parseInt(a[2],10),parseInt(a[3],10)))),i.shift();void 0===s.type?sgv.dlgCreateGraph.show("load",t):Graph.create(s,t)},ParserTXT.exportGraph=e=>{if(null==e)return null;var t="# type="+e.type+"\n";t+="# size="+e.cols+","+e.rows+","+e.layers+","+e.KL+","+e.KR+"\n";for(const n in e.nodes)t=(t+=n+" "+n+" ")+e.nodes[n].getValue()+"\n";for(const i in e.edges)t=(t+=e.edges[i].begin+" "+e.edges[i].end+" ")+e.edges[i].getValue()+"\n";return t},{}),FileIO=(ParserGEXF.importGraph=e=>{var t=new GraphDescr,n={},i={},s=new TempGraphStructure;window.DOMParser?(parser=new DOMParser,xmlDoc=parser.parseFromString(e,"text/xml")):((xmlDoc=new ActiveXObject("Microsoft.XMLDOM")).async=!1,xmlDoc.loadXML(e));var a=xmlDoc.getElementsByTagName("attributes");for(let e=0;e<a.length;e++){var o,l,r=a[e].getAttribute("class"),d=a[e].getElementsByTagName("attribute");for(let e=0;e<d.length;e++)"node"===r?(o=function(e){var t,n=e.getAttribute("id");let i=e.getAttribute("title");return i.startsWith("default")?(e=i.split(";"),i=e[0],t=e[1],e=e[2],{id:n,title:i,type:t,size:e}):{id:n,title:i}}(d[e]),n[o.id]=o.title,"type"in o&&t.setType(o.type),"size"in o&&(o=o.size.split(","),t.setSize(parseInt(o[0]),parseInt(o[1]),parseInt(o[2]),parseInt(o[3]),parseInt(o[4])))):"edge"===r&&(l={id:(o=d[e]).getAttribute("id"),title:o.getAttribute("title")},i[l.id]=l.title)}var c=xmlDoc.getElementsByTagName("nodes")[0].getElementsByTagName("node");for(let e=0;e<c.length;e++){var p={},u=c[e].getAttribute("id"),u=(p.n1=p.n2=parseInt(u),p.values={},c[e].getAttribute("label")),g=c[e].getElementsByTagName("attvalues");if(0<g.length){var h=g[0].getElementsByTagName("attvalue");for(let e=0;e<h.length;e++){var v=h[e].getAttribute("value"),f=h[e].getAttribute("for");p.values[n[f]]=parseFloat(v)}}null===u?s.addNode2(p.n1,p.values):s.addNode2(p.n1,p.values,u)}var y=xmlDoc.getElementsByTagName("edges")[0].getElementsByTagName("edge");for(let e=0;e<y.length;e++){var b={},w=y[e].getAttribute("source"),m=y[e].getAttribute("target"),w=(b.n1=parseInt(w),b.n2=parseInt(m),b.values={},y[e].getElementsByTagName("attvalues"));if(0<w.length){var I=w[0].getElementsByTagName("attvalue");for(let e=0;e<I.length;e++){var C=I[e].getAttribute("value"),S=I[e].getAttribute("for");b.values[i[S]]=parseFloat(C)}}s.addEdge2(b.n1,b.n2,b.values)}Graph.create(t,s);for(const N in n)sgv.graf.scopeOfValues.includes(n[N])||sgv.graf.scopeOfValues.push(n[N]);return!0},ParserGEXF.exportGraph=function(t){if(null==t)return null;var n='<?xml version="1.0" encoding="UTF-8"?>\n',n=(n=(n=(n+='<gexf xmlns="http://gexf.net/1.2" version="1.2">\n')+"  <meta>\n"+"    <creator>IITiS.pl</creator>\n")+"    <description>SimGraphVisualizer GEXF export</description>\n"+"  </meta>\n")+'  <graph defaultedgetype="undirected">\n'+'    <attributes class="node">\n';for(const s in t.scopeOfValues){let e=t.scopeOfValues[s];"default"===e&&(e+=";"+t.type+";"+t.cols+","+t.rows+","+t.layers+","+t.KL+","+t.KR),n+='      <attribute id="'+s+'" title="'+e+'" type="float"/>\n'}n+="    </attributes>\n    <nodes>\n";for(const a in t.nodes)n+=function(e){let t='      <node id="'+e.id;e.isLabelVisible()&&(t+='" label="'+e.getLabel()),t+='">\n        <attvalues>\n';for(const n in e.values)t+='          <attvalue for="'+e.parentGraph.getScopeIndex(n)+'" value="'+e.values[n]+'"/>\n';return t=t+"        </attvalues>\n"+"      </node>\n"}(t.nodes[a]);n+='    </nodes>\n    <attributes class="edge">\n';for(const o in t.scopeOfValues){var e=t.scopeOfValues[o];n+='      <attribute id="'+o+'" title="'+e+'" type="float"/>\n'}n+="    </attributes>\n    <edges>\n";let i=0;for(const l in t.edges)n+=function(e,t){let n='      <edge id="'+t+'" source="'+e.begin+'" target="'+e.end+'">\n';n+="        <attvalues>\n";for(const i in e.values)n+='          <attvalue for="'+e.parentGraph.getScopeIndex(i)+'" value="'+e.values[i]+'"/>\n';return n=n+"        </attvalues>\n"+"      </edge>\n"}(t.edges[l],++i);return n=(n+="    </edges>\n")+"  </graph>\n"+"</gexf>\n"},{});FileIO.onLoadButton=()=>{let t=UI.tag("input",{type:"file",id:"inputfile",display:"none"});t.addEventListener("change",e=>{void 0!==t.files[0]&&showSplashAndRun(()=>{FileIO.loadGraph(t.files[0])})}),t.click()},FileIO.onSaveButton=()=>new Promise((n,i)=>{"function"==typeof window.showSaveFilePicker?window.showSaveFilePicker({suggestedName:"name.txt",excludeAcceptAllOption:!0,types:[{description:"Text file",accept:{"text/plain":[".txt"]}},{description:"GEXF files",accept:{"application/xml":[".gexf"]}}]}).then(e=>{let t;e.name.endsWith(".txt")?t=new Blob([ParserTXT.exportGraph(sgv.graf)]):e.name.endsWith(".gexf")?t=new Blob([ParserGEXF.exportGraph(sgv.graf)]):i("point 1"),e.createWritable().then(e=>{e.write(t).then(()=>{e.close(),n("point 3 (OK)")})}).catch(()=>{i("point 5")})}).catch(()=>{i("point 2")}):(sgv.dlgAlternateFileSave.show(),n("point 4 (OK)"))}),FileIO.download=(e,t,n)=>{var i=document.createElement("a"),e=new Blob([e],{type:n});i.download=t,i.innerHTML="Download graph file",null!=window.webkitURL?i.href=window.webkitURL.createObjectURL(e):(i.href=window.URL.createObjectURL(e),i.onclick=function(e){document.body.removeChild(e.target)},i.style.display="none",document.body.appendChild(i)),i.click()},FileIO.alternateSave=(e,t)=>{var n;".txt"===t?(n=ParserTXT.exportGraph(sgv.graf),FileIO.download(n,e+t,"text/plain")):".gexf"===t&&(n=ParserGEXF.exportGraph(sgv.graf),FileIO.download(n,e+t,"application/xml"))},sgv.stringToScope=(e,t)=>{sgv.graf.loadScopeValues(t,e).n&&sgv.dlgCPL.addScope(t),sgv.dlgCPL.selScope(t)},FileIO.loadGraph=function(e){const t=e.name,n=new FileReader;e&&(n.addEventListener("error",()=>{console.error("Error occurred reading file: "+e.name)}),n.addEventListener("load",()=>{FileIO.loadGraph2(t,n.result)}),t.endsWith("txt")||t.endsWith("gexf")?n.readAsText(e):console.error("Incorrect file extension..."))},FileIO.loadGraph2=function(e,t){e.endsWith("txt")?(Graph.remove(),ParserTXT.importGraph(t)):e.endsWith("gexf")&&(Graph.remove(),ParserGEXF.importGraph(t))&&Dispatcher.graphCreated()};const ScopePanel=function(e,t){let n,s;this.addScope=(e,t)=>{i.add(UI.option(e,e)),i.selectedIndex=t},this.delScope=(e,t)=>{e=UI.findOption(i,e);-1<e&&i.remove(e),i.selectedIndex=t},this.selScope=e=>{e=UI.findOption(i,e);-1<e&&(i.selectedIndex=e)},this.getScope=()=>i.value,this.getScopeIndex=()=>i.selectedIndex,this.refresh=()=>{if(null!==sgv.graf){UI.clearSelect(i,!0);for(const t in sgv.graf.scopeOfValues){var e=sgv.graf.scopeOfValues[t],e=UI.option(e,e);sgv.graf.currentScope===sgv.graf.scopeOfValues[t]&&(e.selected="selected"),i.appendChild(e)}}},"boolean"!=typeof e&&(e=!0),this.ui=UI.tag("div",{class:"sgvSelectBox",id:"ScopePanel"}),s=UI.tag("div",{class:"sgvD1",id:"cplDivDS"}),this.ui.appendChild(s),"string"==typeof t&&s.appendChild(UI.tag("label",{for:"cplDispValues"},{innerHTML:t}));let i=UI.tag("select",{id:"cplDispValues"});i.addEventListener("change",()=>{sgv.graf.displayValues(i.value)}),s.appendChild(i),e&&((t=UI.tag("input",{type:"button",class:"toolButton",id:"cplDelScope",value:""})).addEventListener("click",()=>{sgv.graf.delScopeOfValues(this.getScope());Dispatcher.graphChanged()}),s.appendChild(t),(e=UI.tag("input",{type:"button",class:"toolButton",id:"cplAddScope",value:""})).addEventListener("click",()=>{n.show(),s.style.display="none"}),s.appendChild(e),this.ui.appendChild((n=function(e){let t=!0,n=("string"==typeof e&&""!==e&&(t=!1),UI.tag("div",{class:"sgvD1",id:"cplDivNS"},{textContent:isMobile?"":t?"add new scope: ":"edit scope: "})),i=UI.tag("input",{type:"text",id:"cplAddScopeInput",value:t?"newScope":e});return n.appendChild(i),(e=UI.tag("input",{type:"button",class:"toolButton",id:"cplAcceptAddScope",value:""})).addEventListener("click",()=>{var e;t&&(e=i.value,sgv.graf.addScopeOfValues(e),Dispatcher.graphChanged()),n.style.display="none",s.style.display="inline"}),n.appendChild(e),(e=UI.tag("input",{type:"button",class:"toolButton",id:"cplSkipAddScope",value:""})).addEventListener("click",()=>{n.style.display="none",s.style.display="block"}),n.appendChild(e),n.style.display="none",{ui:n,show:()=>n.style.display="block",hide:()=>n.style.display="none"}}()).ui))},SlidersPanel=function(){var n,i,s,a;this.ui=UI.tag("div",{id:"LimitSlidersPanel"}),this.ui.appendChild(s=UI.tag("span",{id:"spanRed"},{textContent:"-1.0"})),(n=UI.tag("input",{type:"range",class:"graphLimit",id:"redLimit",value:"-1.0",min:"-1.0",max:"0.0",step:"0.01"})).addEventListener("input",async e=>{null!==sgv.graf&&(sgv.graf.redLimit=e.target.value,s.textContent=sgv.graf.redLimit+" ",sgv.graf.displayValues())}),this.ui.appendChild(n),this.ui.appendChild(UI.tag("span",{id:"spanZero"},{textContent:" 0 "})),(i=UI.tag("input",{type:"range",class:"graphLimit",id:"greenLimit",value:"1.0",min:"0.0",max:"1.0",step:"0.01"})).addEventListener("input",async e=>{null!==sgv.graf&&(sgv.graf.greenLimit=e.target.value,a.textContent=" "+sgv.graf.greenLimit,sgv.graf.displayValues())}),this.ui.appendChild(i),this.ui.appendChild(a=UI.tag("span",{id:"spanGreen"},{textContent:"1.0"})),this.refresh=()=>{var e,t;null!==sgv.graf&&(0<(e=sgv.graf.getMinMaxVal()).min&&(e.min=Number.NaN),e.max<0&&(e.max=Number.NaN),t=e.min,isNaN(t)?(n.disabled="disabled",s.textContent="NaN"):(t=Math.floor(100*t)/100,sgv.graf.redLimit<t&&(sgv.graf.redLimit=t),n.min=t,n.value=sgv.graf.redLimit,s.textContent=sgv.graf.redLimit+" ",n.disabled=""),t=e.max,isNaN(t)?(i.disabled="disabled",a.textContent="NaN"):(t=Math.ceil(100*t)/100,sgv.graf.greenLimit>t&&(sgv.graf.greenLimit=t),i.max=t,i.value=sgv.graf.greenLimit,a.textContent=" "+sgv.graf.greenLimit,i.disabled=""))}},DlgCPL=function(){var e,t,i,s,a,n=function(){let n=UI.tag("div",{class:"sgvUIwindow disable-select",id:"sgvDlgCPL"});return(e=UI.tag("div",{})).append((t=function(){var e=UI.tag("div",{class:"content",id:"graphSelection"});return e.appendChild(UI.createTransparentBtn1("show console","cplShowConsoleButton",()=>{sgv.dlgConsole.switchConsole()})),e.appendChild(UI.createTransparentBtn1("create graph","cplCreateButton",()=>{sgv.dlgCreateGraph.show()})),e.appendChild(UI.createTransparentBtn1("load graph","cplLoadButton",()=>{FileIO.onLoadButton()})),e.style.display="block",{ui:e,show:()=>{e.style.display="block"},hide:()=>{e.style.display="none"}}}()).ui,(i=function(){var e,t,i=UI.tag("div",{class:"content",id:"graphDescription"});return i.append((e=UI.tag("div",{}),(t=UI.tag("sub")).append(UI.span("0",{id:"dscr_KL"}),",",UI.span("0",{id:"dscr_KR"})),e.append("Current graph is ",UI.span("unknown",{id:"dscr_type"}),"-like, size: ",UI.span("0",{id:"dscr_cols"}),"x",UI.span("0",{id:"dscr_rows"}),"xK",t,UI.tag("br"),"Number of nodes: ",UI.span("0",{id:"dscr_nbNodes"}),", number of edges: ",UI.span("0",{id:"dscr_nbEdges"})),{ui:e}).ui,(s=new ScopePanel(!0,"current scope: ")).ui,(a=new SlidersPanel).ui,((t=UI.tag("div",{id:"panelBtns"})).appendChild(UI.createTransparentBtn1("display mode","cplDispModeButton",()=>{Graph.switchDisplayMode()})),t.appendChild(UI.createTransparentBtn1("cell view","cplCellViewButton",()=>{sgv.dlgCellView.switchDialog()})),t.appendChild(UI.createTransparentBtn1("show console","cplShowConsoleButton",()=>{sgv.dlgConsole.switchConsole()})),t.appendChild(UI.createTransparentBtn1("save graph","cplSaveButton",()=>{FileIO.onSaveButton().then(e=>console.log(e)).catch(e=>console.log(e))})),t.appendChild(UI.createTransparentBtn1("delete graph","cplClearButton",()=>{Graph.remove()})),{ui:t}).ui),i.style.display="none",{ui:i,addButton:(e,t,n)=>{i.appendChild(UI.createTransparentBtn1(e,t,n))},updateInfo:()=>{n.querySelector("#dscr_type").textContent=sgv.graf.type,n.querySelector("#dscr_cols").textContent=sgv.graf.cols,n.querySelector("#dscr_rows").textContent=sgv.graf.rows,n.querySelector("#dscr_KL").textContent=sgv.graf.KL,n.querySelector("#dscr_KR").textContent=sgv.graf.KR,n.querySelector("#dscr_nbNodes").textContent=Object.keys(sgv.graf.nodes).length,n.querySelector("#dscr_nbEdges").textContent=Object.keys(sgv.graf.edges).length},show:()=>{i.style.display="block"},hide:()=>{i.style.display="none"}}}()).ui),n.appendChild(e),n.appendChild(UI.tag("div",{id:"switch"},{innerHTML:"· · ·"},{click:()=>r()})),n.style.display="block",n}();function o(){e.style.display="block"}function l(){e.style.display="none"}function r(){("none"===e.style.display?o:l)()}return window.addEventListener("load",()=>{window.document.body.appendChild(n)}),{showPanel:o,hidePanel:l,switchPanel:r,setModeDescription:function(){i.updateInfo(),a.refresh(),s.refresh(),t.hide(),i.show()},setModeSelection:function(){t.show(),i.hide()},updateSliders:a.refresh,addButton:i.addButton,addScope:s.addScope,delScope:s.delScope,selScope:s.selScope,refresh:function(){a.refresh(),s.refresh()}}};sgv.dlgCPL=new DlgCPL;class DlgConsole{constructor(){this.cmdHistory=[],this.cmdHistoryPtr=-1,this.movable=!1,this.ui=this.createUI("sgvConsole"),this.initConsole(),window.addEventListener("load",()=>{window.document.body.appendChild(this.ui)})}initConsole(){let n=this.ui.querySelector("#commandline");n.addEventListener("keydown",e=>{var t;"Enter"===e.key?((t=document.getElementById("consoleHistory")).textContent+="> "+n.value+"\n",t.textContent+=this.parseCommand(n.value)+"\n",t.scrollTop=t.scrollHeight,10<this.cmdHistory.length&&this.cmdHistory.shift(),this.cmdHistory.push(n.value),this.cmdHistoryPtr=this.cmdHistory.length,n.value=""):38===e.keyCode?0<this.cmdHistoryPtr&&(this.cmdHistoryPtr--,n.value=this.cmdHistory[this.cmdHistoryPtr]):40===e.keyCode&&(this.cmdHistoryPtr<this.cmdHistory.length?(n.value=this.cmdHistory[this.cmdHistoryPtr],this.cmdHistoryPtr++):n.value="")}),this.ui.querySelector(".hidebutton").addEventListener("click",()=>{this.hideConsole()})}createUI(e){e=UI.createEmptyWindow("sgvUIwindow",e,"console",!0);return e.innerHTML+='<div class="content">                 <textarea id="consoleHistory" readonly></textarea>                 <input type="text" id="commandline">             </div>',e}parseCommand(e){function t(t){if(null===sgv.graf)return"no graph defined";t=t.split("=");if(console.log(t),t.length<2)return"too few arguments";var e=parseFloat(t[1].replace(/,/g,".")),t=t[0].split("+");if(1===t.length)return s=e,"q"===(i=t)[0][0]?(i=parseInt(i[0].slice(1),10),isNaN(i)||0===i||i>sgv.graf.maxNodeId()?"bad node Id":isNaN(s)?i in sgv.graf.nodes?(sgv.graf.delNode(i.toString()),"deleted node q"+i):"node q"+i+" already deleted":i in sgv.graf.nodes?(sgv.graf.setNodeValue(i,s),"modified node q"+i+" = "+s):i in sgv.graf.missing?(sgv.graf.restoreNode(i),(n=document.getElementById("rest"+i)).parentNode.removeChild(n),sgv.graf.setNodeValue(i,s),"restored and modified node q"+i+" = "+s):(sgv.graf.addNode(i,s),"added node q"+i+" = "+s)):void 0;if(2!==t.length)return"bad arguments";var n=t,i=e;if("q"===n[0][0]&&"q"===n[1][0]){var s=parseInt(n[0].slice(1),10),t=parseInt(n[1].slice(1),10);if(isNaN(s)||0===s)return"bad node Id: "+n[0];if(isNaN(t)||0===t)return"bad node Id: "+n[1];let e=t<s?t+","+s:s+","+t;return isNaN(i)?e in sgv.graf.edges?(sgv.graf.delEdge(e),"deleted edge "+e):"edge "+e+" not exists":e in sgv.graf.edges?(sgv.graf.setEdgeValue(e,i),"modified edge "+e):s in sgv.graf.nodes&&t in sgv.graf.nodes?(sgv.graf.addEdge(s,t).setValue(i),"added edge "+e):"NOT DONE: both connected nodes must exist in the graph"}}function n(e){switch(e){case"set":return"Set or remove value of node or edge\n\nset [nodeId](=value)\nset [nodeId]+[nodeId](=value)";case"create":return"Create new default graph\n\ncreate [chimera|pegasus] [4|8|12|16],[4|8|12|16],[1..4],[1..4]";case"clear":return"Remove current graph if exists\n\nclear";case"display":return"Switch between sets of displayed values\n\ndisplay [valueId]";case"displaymode":return"Set style of graph display.\n\ndisplaymode [classic|triangle|diamond]";default:return"For more information on a specific command, type: help command-name\n\nset\t\tSet or remove value of node or edge\ncreate\t\tCreate new default graph\nclear\t\tRemove current graph if exists\ndisplay\t\tSwitch between sets of displayed values\ndisplaymode\tSet style of graph display"}}var i,s=(e=e.trim().toLowerCase().replace(/\s+/g," ")).split(" "),a=e.indexOf(" "),o=e.substring(a+1).replace(/\s+/g,""),l="";switch(s[0].trim()){case"help":case"?":l=n(s[1]);break;case"limits":l=function(e){if(null===sgv.graf)return"no graph defined";let t="";var n;return 1===e.length?(t="Current display limits [red, green] are set to ["+sgv.graf.redLimit+", "+sgv.graf.greenLimit+"]\n",n=sgv.graf.getMinMaxNodeVal(),t+="\nnode values range in current scope is: ["+n.min+", "+n.max+"] "+n.com,n=sgv.graf.getMinMaxEdgeVal(),t+="\nedge weights range in current scope is: ["+n.min+", "+n.max+"] "+n.com):"set"!==e[1]?"bad arguments":e.length<4?"too few arguments\nUse: limits set <min> <max>":(n=parseFloat(e[2].replace(/,/g,".")),e=parseFloat(e[3].replace(/,/g,".")),isNaN(n)||isNaN(e)?"Bad arguments: <min> and <max> should be numbers.":0<n||e<0||n===e?"Bad arguments: <min> cannot be greater than zero, <max> cannot be less than zero and both values cannot be zero at the same time.":(sgv.graf.redLimit=n,sgv.graf.greenLimit=e,t="Display limits [red, green] are set to ["+sgv.graf.redLimit+", "+sgv.graf.greenLimit+"]",sgv.graf.displayValues(sgv.graf.currentScope),t))}(s);break;case"create":l=function(e,t){if("chimera"!==e&&"pegasus"!==e)return"unknown graph type, use: chimera or pegasus";if(null!==sgv.graf)return"graf exists, type: clear <Enter> to delete it";var n=new GraphDescr;if(n.setType(e),5<=(t=t.split(",")).length)n.setSize(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10),parseInt(t[4],10));else{if(4!==t.length||"chimera"!==e)return"bad arguments";n.setSize(parseInt(t[0],10),parseInt(t[1],10),1,parseInt(t[2],10),parseInt(t[3],10))}return Graph.create(n),"graph created"}(s[1],s[2]);break;case"clear":Graph.remove(),l="graph removed";break;case"set":l=t(o);break;case"scope":l=function(e,t){if(null===sgv.graf)return"no graph defined";switch(e){case"list":return sgv.graf.scopeOfValues.toString();case"add":var n=sgv.graf.addScopeOfValues(t);return 0<=n&&(sgv.dlgCPL.addScope(t,n),sgv.graf.displayValues(t)),"Added scope "+t;case"delete":n=sgv.graf.delScopeOfValues(t);return 0<=n?(sgv.dlgCPL.delScope(t,n),"Deleted scope "+t+", current scope: "+sgv.graf.currentScope):"Scope "+t+" could not to be deleted... Current scope: "+sgv.graf.currentScope;case"set":return sgv.graf.hasScope(t)?(sgv.graf.displayValues(t)&&sgv.dlgCPL.selScope(t),"Current scope: "+sgv.graf.currentScope):"Bad scope name: "+t+"... Current scope: "+sgv.graf.currentScope;default:return"Current scope: "+sgv.graf.currentScope}}(s[1],s[2]);break;case"display":i=s[1],l="displayed value: "+sgv.graf.displayValues(i);break;case"displaymode":l=null===sgv.graf?"graph is not defined":Graph.displayModes.includes(s[1])?(Graph.currentDisplayMode=s[1],sgv.graf.setDisplayMode(),"current displayMode = "+s[1]):"unknown mode\n\n"+n("displaymode");break;default:l="unknown command\n\n"+n()}return l}switchConsole(){"block"!==this.ui.style.display?this.ui.style.display="block":this.ui.style.display="none"}showConsole(){this.ui.style.display="block"}hideConsole(){this.ui.style.display="none"}}sgv.dlgConsole=new DlgConsole;const DlgCellView=function(){var L,x,E,U,B,k,V,P,e=null;const T=600,A=600,i=T/2,s=A/2;k=V=P=0,(t=UI.createEmptyWindow("sgvUIwindow","sgvCellView","Cell view",!0)).querySelector(".hidebutton").addEventListener("click",function(){u()}),n=UI.tag("div",{class:"content",id:"main"}),a=UI.tag("div",{id:"svg"}),B=SVG.createSVG2("svgView",T,A,e=>{"svgView"===e.target.id&&(sgv.dlgNodeProperties.hide(),sgv.dlgEdgeProperties.hide())}),a.appendChild(B),n.appendChild(a),(a=UI.tag("div",{class:"tools",id:"cellViewTools"})).style["text-align"]="center",(L=UI.tag("select",{id:"graphCols"})).addEventListener("change",()=>{c(parseInt(L.value,10),parseInt(x.value,10),parseInt(E.value,10))}),a.appendChild(UI.tag("label",{for:"graphCols"},{innerHTML:" column: "})),a.appendChild(L),(x=UI.tag("select",{id:"graphRows"})).addEventListener("change",()=>{c(parseInt(L.value,10),parseInt(x.value,10),parseInt(E.value,10))}),a.appendChild(UI.tag("label",{for:"graphRows"},{innerHTML:" row: "})),a.appendChild(x),(E=UI.tag("select",{id:"graphLays"})).addEventListener("change",()=>{c(parseInt(L.value,10),parseInt(x.value,10),parseInt(E.value,10))}),a.appendChild(UI.tag("label",{for:"graphLays"},{innerHTML:" layer: "})),a.appendChild(E),a.appendChild((U=new ScopePanel).ui),n.appendChild(a),n.appendChild(UI.createTransparentBtn1("CLOSE","CloseButton",()=>{u()})),t.appendChild(n),t.style.display="none";var t,n,a,o=t,l=(o.addEventListener("keydown",function(e){e=e.key;"ArrowLeft"===e?0<V&&c(V-1,k,P):"ArrowRight"===e?V<sgv.graf.cols-1&&c(V+1,k,P):"ArrowUp"===e?k<sgv.graf.rows-1&&c(V,k+1,P):"ArrowDown"===e?0<k&&c(V,k-1,P):"PageUp"===e?P<sgv.graf.layers-1&&c(V,k,P+1):"PageDown"===e?0<P&&c(V,k,P-1):"Escape"===e&&u()}),null),r=null;function D(e,t){var n={classic:[{x:-60,y:150},{x:-90,y:50},{x:-120,y:-50},{x:-150,y:-150},{x:140,y:200},{x:110,y:100},{x:80,y:0},{x:50,y:-100}]};return t="classic",{x:i+n[t][e].x,y:s+n[t][e].y}}function d(e){e.preventDefault();var t=e.target.id.split("_"),t=(id=1<t.length?t[1]:e.target.id,QbDescr.fromNodeId(id,sgv.graf.rows,sgv.graf.cols)),t=(c(t.x,t.y,t.z),e.target.getBoundingClientRect());sgv.dlgNodeProperties.show(id,t.x,t.y)}function O(e){e.preventDefault();var t=e.target.id.split("_"),n=e.target.getBoundingClientRect();1<t.length?sgv.dlgNodeProperties.show(t[1],n.x,n.y):sgv.dlgNodeProperties.show(e.target.id,n.x,n.y)}function M(e){e.preventDefault();var t=e.target.id.split("_"),n=e.target.getBoundingClientRect();1<t.length?sgv.dlgEdgeProperties.show(t[1],n.x,n.y):sgv.dlgEdgeProperties.show(e.target.id,n.x,n.y)}function G(e,t,n,i,s){var a,o,l,e=Edge.calcId(e+t,n);e in sgv.graf.edges&&(a=valueToColor(o=sgv.graf.edgeValue(e)),o=2+5*valueToEdgeWidth(o),l=valueToColor(sgv.graf.nodeValue(n)),SVG.drawSvgEdge(B,e,D(t).x,D(t).y,i,s,a.toHexString(),o,M),SVG.drawSvgText(B,n,i,s,n,"yellow",l.toHexString(),d))}function c(e,t,n){if(B.innerHTML="",null!==sgv.graf){void 0===e?e=V:V=e<sgv.graf.cols?e:e=0,void 0===t?t=k:k=t<sgv.graf.rows?t:t=0,void 0===n?n=P:P=n<sgv.graf.layers?n:n=0;sgv.graf.rows,sgv.graf.cols;UI.selectByKey(L,e),UI.selectByKey(x,t),UI.selectByKey(E,n),U.selScope(sgv.graf.currentScope),e=e,t=t,n=(n=n)*sgv.graf.cols*sgv.graf.rows,n=8*((n+=t*sgv.graf.cols)+e);var i,s,a,o,l,r,d,c=++n,p=T-20,u=A-20,g=[{x:115,y:-40},{x:75,y:-40},{x:45,y:-30},{x:45,y:-10},{x:45,y:10},{x:45,y:30},{x:75,y:40},{x:115,y:40}],h=[{x:p-95,y:-40},{x:p-55,y:-40},{x:p-25,y:-30},{x:p-25,y:-10},{x:p-25,y:10},{x:p-25,y:30},{x:p-55,y:40},{x:p-95,y:40}],v={};for(let t=0;t<8;t++){var f,y,b,w=sgv.graf.findAllConnected(c+t);for(f of w.internal){var m=Edge.calcId(c+t,f);m in v||(a=c,o=t,l=(f-1)%8,d=r=void 0,(a=Edge.calcId(a+o,a+l))in sgv.graf.edges&&(r=valueToColor(d=sgv.graf.edgeValue(a)),d=2+5*valueToEdgeWidth(d),SVG.drawSvgEdge(B,a,D(o).x,D(o).y,D(l).x,D(l).y,r.toHexString(),d,M)),v[m]=1)}for(y of w.horizontal)G(c,t,y,c+t<y?p:20,D(t).y);for(b of w.vertical)G(c,t,b,D(t).x,c+t<b?20:u);let e=0;if(t<4){for(var I of w.up)G(c,t,I,g[e].x,D(t).y+g[e].y),e++;for(var C of w.down)G(c,t,C,g[e].x,D(t).y+g[e].y),e++}else{for(var S of w.up)G(c,t,S,h[e].x,D(t).y+h[e].y),e++;for(var N of w.down)G(c,t,N,h[e].x,D(t).y+h[e].y),e++}w=c,i=t,s=void 0,(w=w+i)in sgv.graf.nodes&&(s=valueToColor(sgv.graf.nodeValue(w)),SVG.drawSvgNode(B,w,D(i).x,D(i).y,20,s.toHexString(),O),SVG.drawSvgText(B,w,D(i).x,D(i).y,w.toString(),"yellow","",O))}}}function p(){UI.clearSelect(L,!0);for(let e=0;e<sgv.graf.cols;e++)L.appendChild(UI.option(e,e));L.selectedIndex=V,UI.clearSelect(x,!0);for(let e=0;e<sgv.graf.rows;e++)x.appendChild(UI.option(e,e));x.selectedIndex=k,UI.clearSelect(E,!0);for(let e=0;e<sgv.graf.layers;e++)E.appendChild(UI.option(e,e));E.selectedIndex=P,1===sgv.graf.layers?E.disabled="disabled":E.disabled="",U.refresh(),c(),o.style.display="block",e=window.document.activeElement,o.focus({focusVisible:!1})}function u(){null!==e&&e.focus({focusVisible:!1}),o.style.display="none"}return o.addEventListener("touchstart",function(e){e=function(e){return e.touches||e.originalEvent.touches}(e)[0];l=e.clientX,r=e.clientY},!1),o.addEventListener("touchmove",function(e){var t;l&&r&&(t=e.touches[0].clientX,e=e.touches[0].clientY,t=l-t,e=r-e,Math.abs(t)>Math.abs(e)?0<t?V<sgv.graf.cols-1&&c(V+1,k,P):0<V&&c(V-1,k,P):0<e?0<k&&c(V,k-1,P):k<sgv.graf.rows-1&&c(V,k+1,P),r=l=null)},!1),window.addEventListener("load",()=>{window.document.body.appendChild(o)}),{refresh:c,switchDialog:function(){("none"===o.style.display?p:u)()},show:p,hide:u}},DlgCreateGraph=(sgv.dlgCellView=new DlgCellView,function(){var s,a,o,l,r,d,c,i=function(){var e=UI.tag("dialog",{class:"sgvUIwindow sgvModalDialog",id:"sgvDlgCreateGraph"}),t=UI.createTitlebar("Create graph",!1),t=(e.appendChild(t),UI.tag("div",{class:"content",id:"graphSelection"})),n=(t.appendChild(UI.tag("div",{id:"description"})),UI.tag("div",{id:"description"}));n.style["text-align"]="center",(s=UI.tag("select",{id:"graphType"})).appendChild(UI.option("chimera","chimera")),s.appendChild(UI.option("pegasus","pegasus")),s.addEventListener("change",e=>{"chimera"===e.target.value?(l.selectedIndex=0,l.disabled="disabled"):l.disabled=""}),n.appendChild(UI.tag("label",{for:"graphType"},{innerHTML:"graph type: "})),n.appendChild(s),n.appendChild(UI.tag("hr")),a=UI.tag("select",{id:"graphCols"});for(let e=1;e<17;e++)a.appendChild(UI.option(e,e));UI.selectByKey(a,4),n.appendChild(UI.tag("label",{for:"graphCols"},{innerHTML:" columns: "})),n.appendChild(a),o=UI.tag("select",{id:"graphRows"});for(let e=1;e<17;e++)o.appendChild(UI.option(e,e));UI.selectByKey(o,4),n.appendChild(UI.tag("label",{for:"graphRows"},{innerHTML:" rows: "})),n.appendChild(o),l=UI.tag("select",{id:"graphLays"});for(let e=1;e<6;e++)l.appendChild(UI.option(e,e));UI.selectByKey(l,1),l.disabled="disabled",n.appendChild(UI.tag("label",{for:"graphLays"},{innerHTML:" layers: "})),n.appendChild(l),n.appendChild(UI.tag("hr")),(r=UI.tag("select",{id:"graphKL"})).appendChild(UI.option("1","1")),r.appendChild(UI.option("2","2")),r.appendChild(UI.option("3","3")),r.appendChild(UI.option("4","4",!0)),n.appendChild(UI.tag("label",{for:"graphKL"},{innerHTML:"module size: K = "})),n.appendChild(r),(d=UI.tag("select",{id:"graphKR"})).appendChild(UI.option("1","1")),d.appendChild(UI.option("2","2")),d.appendChild(UI.option("3","3")),d.appendChild(UI.option("4","4",!0)),n.appendChild(UI.tag("label",{for:"graphKR"},{innerHTML:", "})),n.appendChild(d),t.appendChild(n);var n=UI.tag("div",{id:"buttons"}),i=UI.tag("input",{type:"button",class:"actionbutton",id:"cplCancelButton",name:"cancelButton",value:"Cancel"}),i=(i.addEventListener("click",()=>{p()}),n.appendChild(i),UI.tag("input",{type:"button",class:"actionbutton",id:"cplCreateButton",name:"createButton",value:"Create"}));return i.addEventListener("click",()=>{{let e=function(){var e=new GraphDescr;return e.setType(s.value),e.setSize(parseInt(a.value,10),parseInt(o.value,10),parseInt(l.value,10),parseInt(r.value,10),parseInt(d.value,10)),e}();showSplashAndRun(()=>{p(),setTimeout(()=>{Graph.create(e,c)},100)},!0)}}),n.appendChild(i),t.appendChild(n),e.appendChild(t),e.style.display="none",e}();function p(){i.close(),i.style.display="none"}return window.addEventListener("load",()=>{window.document.body.appendChild(i)}),{d:c,show:function(e,t){if("load"===e?(i.querySelector("#cplCreateButton").value="Load",i.querySelector(".titleText").textContent="Load graph"):(i.querySelector("#cplCreateButton").value="Create",i.querySelector(".titleText").textContent="New graph"),i.style.display="block",t instanceof TempGraphStructure){c=t;{let t=0,e=(c.nodes.forEach(e=>{t<e.id&&(t=e.id)}),--t>>3);t%8&&e++;var n=new GraphDescr;switch(e){case 4:n.set("chimera",2,2,1,4,4);break;case 9:n.set("chimera",3,3,1,4,4);break;case 16:n.set("chimera",4,4,1,4,4);break;case 64:n.set("chimera",8,8,1,4,4);break;case 144:n.set("chimera",12,12,1,4,4);break;case 256:n.set("chimera",16,16,1,4,4);break;case 12:n.set("pegasus",2,2,3,4,4);break;case 27:n.set("pegasus",3,3,3,4,4);break;case 48:n.set("pegasus",4,4,3,4,4);break;case 192:n.set("pegasus",8,8,3,4,4);break;case 432:n.set("pegasus",12,12,3,4,4);break;case 768:n.set("pegasus",16,16,3,4,4);break;default:n.set("chimera",4,4,1,4,4)}UI.selectByKey(s,n.type),UI.selectByKey(a,n.size.cols),UI.selectByKey(o,n.size.rows),UI.selectByKey(l,n.size.lays),UI.selectByKey(r,n.size.KL),UI.selectByKey(d,n.size.KR),"chimera"===n.type?l.disabled="disabled":l.disabled=""}}else c=null;i.showModal()},hide:p}}),ValuePanel=(sgv.dlgCreateGraph=new DlgCreateGraph,sgv.dlgEdgeProperties=new function(){var s,a,o,l,r,d,c,p,e,t,u=null,g=!0,h=((e=UI.createEmptyWindow("sgvUIwindow","sgvEdgeProperties","Edge properties",!0)).querySelector(".hidebutton").addEventListener("click",function(){i()}),o=UI.newInput("hidden","0","","edgeId"),e.appendChild(o),t=UI.tag("div",{class:"content"}),(l=UI.tag("select",{id:"selectEdgeId"})).appendChild(UI.tag("option",{value:0,selected:!0},{innerHTML:"-- id --"})),l.addEventListener("change",function(){n(event.target.value)}),t.appendChild(UI.tag("label",{for:"selectEdgeId"},{innerHTML:"Edge: "})),t.appendChild(l),e.appendChild(t),s=UI.tag("div",{class:"content"}),e.appendChild(s),s.appendChild((r=new ScopePanel(!1,"scope: ")).ui),t=UI.tag("div",{id:"ValueBlock"}),(d=UI.newInput("checkbox","","","valueCheckE")).addEventListener("click",function(){var e=d.checked,t=r.getScope();if(e){let e=parseFloat(c.value.replace(/,/g,"."));""!==e&&!isNaN(e)||(e=0),sgv.graf.setEdgeValue(o.value,e,t)}else sgv.graf.delEdgeValue(o.value,t);Dispatcher.graphChanged()}),t.appendChild(d),(c=UI.newInput("number","0","","wagaE")).addEventListener("change",function(){v()}),t.appendChild(c),(p=UI.newInput("button","set","setvaluebutton","setE")).addEventListener("click",function(){v()}),t.appendChild(p),s.appendChild(t),e.appendChild(a=UI.tag("div",{class:"content"},{innerHTML:"Select an edge, please."})),e.appendChild(UI.createTransparentBtn1("CLOSE","CloseButton",()=>{i()})),e.appendChild(UI.createTransparentBtn1("DELETE","DeleteButton",()=>{i(),sgv.graf.delEdge(o.value)})),e);function n(e,t,n){if(void 0!==e?(e=e.toString(),o.value=e):e=o.value,"0"===e)s.style.display="none",a.style.display="block";else{a.style.display="none",s.style.display="block",UI.clearSelect(l,!1);for(const i in sgv.graf.edges)l.appendChild(UI.tag("option",{value:i},{innerHTML:"q"+sgv.graf.edges[i].begin+" - q"+sgv.graf.edges[i].end}));UI.selectByKey(l,e),r.refresh();var e=sgv.graf.edgeValue(e);null===e||isNaN(e)?(d.checked="",c.value=null,c.disabled="disabled",p.disabled="disabled"):(d.checked="checked",c.value=e,c.disabled="",p.disabled=""),!isMobile&&g&&(g=!1,void 0!==t)&&void 0!==n&&(e=sgv.canvas.clientLeft,h.style.top=n+"px",h.style.left=e+t+"px"),h.style.display="block",u=window.document.activeElement,h.focus({focusVisible:!1})}}function i(){null!==u&&u.focus({focusVisible:!1}),null!==h&&(h.style.display="none")}function v(){var e=parseFloat(c.value.replace(/,/g,".")),t=r.getScope();""===e||isNaN(e)?sgv.graf.delEdgeValue(o.value,t):sgv.graf.setEdgeValue(o.value,e,t),Dispatcher.graphChanged()}return h.addEventListener("keydown",function(e){e=e.key;"Escape"===e&&i()}),window.addEventListener("load",()=>{window.document.body.appendChild(h),i()}),{show:n,hide:i,refresh:function(){"block"===h.style.display&&n()},isVisible:()=>null!==h&&"block"===h.style.display}},function(){var t,n,i,s,a,e=UI.tag("div",{id:"ValueBlock"});function o(){var e=parseFloat(i.value.replace(/,/g,"."));sgv.graf.setNodeValue(s,e,a),Dispatcher.graphChanged()}function l(){var e=sgv.graf.nodeValue(s,a);null===e||isNaN(e)?(n.checked="",i.value=null,i.disabled="disabled",t.disabled="disabled"):(n.checked="checked",i.value=e,i.disabled="",t.disabled="")}return(n=UI.newInput("checkbox","","","valueCheckN")).addEventListener("click",function(e){if(e.target.checked){i.disabled="",t.disabled="";let e=parseFloat(i.value.replace(/,/g,"."));isNaN(e)&&(e=0,i.value=e),console.log(e),sgv.graf.setNodeValue(s,e,a)}else i.disabled="disabled",t.disabled="disabled",sgv.graf.delNodeValue(s,a);Dispatcher.graphChanged()}),e.appendChild(n),(i=UI.newInput("number","0","","wagaN")).addEventListener("change",function(){o()}),e.appendChild(i),(t=UI.newInput("button","set","setvaluebutton","setN")).addEventListener("click",function(){o()}),e.appendChild(t),{ui:e,setNode:function(e){s=e,l()},setScope:function(e){a=e,l()},show:function(e,t){s=e,a=t,l()}}}),DlgNodeProperties=function(){var l,o,r,d,i,s,c,p,u,g,h=null,v=!0,f=function(){var e=UI.createEmptyWindow("sgvUIwindow","sgvNodeProperties","Node properties",!0);e.querySelector(".hidebutton").addEventListener("click",function(){a()}),l=UI.newInput("hidden","0","","nodeId"),e.appendChild(l);var t=UI.tag("div",{id:"main"}),n=(e.appendChild(t),UI.tag("div",{id:"nodeid",class:"content"}));(o=UI.tag("select",{id:"selectNodeId"})).appendChild(UI.tag("option",{value:0,selected:!0},{innerHTML:"-- id --"})),o.addEventListener("change",function(){b(event.target.value)}),n.appendChild(UI.tag("label",{for:"selectNodeId"},{innerHTML:"Node: "})),n.appendChild(o),t.appendChild(n);n=UI.tag("div",{id:"svg"});g=SVG.createSVG2("svgView",250,250,e=>{"svgView"===e.target.id&&sgv.dlgEdgeProperties.hide()}),n.appendChild(g),t.appendChild(n),p=UI.tag("div",{id:"tools",class:"content"});n=UI.tag("div",{id:"LabelBlock"}),(i=UI.newInput("checkbox","","","checkLabelN")).addEventListener("click",function(e){e=e.target.checked;s.disabled=e?"":"disabled",sgv.graf.nodes[l.value].showLabel(e)}),n.appendChild(UI.tag("label",{for:"checkLabelN"},{innerHTML:"Label: "})),n.appendChild(i),(s=UI.newInput("text","","","editLabelN")).addEventListener("change",function(e){sgv.graf.nodes[l.value].setLabel(e.target.value,!0)}),n.appendChild(s),p.appendChild(n),p.appendChild((r=new ScopePanel(!1,"scope: ")).ui),p.appendChild((c=new ValuePanel).ui),n=UI.tag("div",{id:"ConnectBlock"});return(i=UI.newInput("button","connect to...","","connectN")).addEventListener("click",function(){var e,t;e=f.querySelector("#nodeId").value,t=f.querySelector("#destN").value,null!==sgv.graf&&(sgv.graf.addEdge(e,t),Dispatcher.graphChanged())}),n.appendChild(i),d=UI.tag("select",{id:"destN"}),n.appendChild(d),(i=UI.newInput("button","^","","connectSelectN")).addEventListener("click",function(){sgv.nodeToConnect=parseInt(f.querySelector("#nodeId").value,10),f.style.display="none"}),n.appendChild(i),p.appendChild(n),t.appendChild(p),u=UI.tag("div",{id:"zeroInfo",class:"content"},{innerHTML:"Select a node, please."}),t.appendChild(u),t.appendChild(UI.createTransparentBtn1("DELETE","DeleteButton",()=>{var e;e=l.value,l.value=0,sgv.graf.delNode(e),a()})),t.appendChild(UI.createTransparentBtn1("CLOSE","CloseButton",()=>{a()})),e}();function y(e){if(void 0===e&&(e=l.value),r.selScope(sgv.graf.currentScope),g.innerHTML="",e in sgv.graf.nodes){var t=valueToColor(sgv.graf.nodeValue(e));{var d=e;var n,i,s,a,o,c=sgv.graf.findAllConnected(d),p=new Set;for(n of c.internal)p.add(n);for(i of c.horizontal)p.add(i);for(s of c.vertical)p.add(s);for(a of c.up)p.add(a);for(o of c.down)p.add(o);let l=2*Math.PI/p.size,r=l;p.forEach(e=>{var t,n,i,s=100*Math.sin(r),a=100*Math.cos(r);let o=Edge.calcId(d,e);o in sgv.graf.edges&&(t=valueToColor(n=sgv.graf.edgeValue(o)),n=2+5*valueToEdgeWidth(n),i=valueToColor(sgv.graf.nodeValue(e)),SVG.drawSvgEdge(g,o,125,125,125+s,125+a,t.toHexString(),n,e=>{e=e.target.getBoundingClientRect();sgv.dlgEdgeProperties.show(o,e.x,e.y),sgv.dlgEdgeProperties.ui.style["z-index"]=101}),SVG.drawSvgText(g,e,125+s,125+a,e,"yellow",i.toHexString(),()=>{b(e)})),r+=l})}SVG.drawSvgNode(g,e,125,125,25,t.toHexString(),()=>{}),SVG.drawSvgText(g,e,125,125,e.toString(),"yellow","",()=>{})}}function b(e,t,n){if(void 0!==e?(e=e.toString(),l.value=e):e=l.value,"0"===e)p.style.display="none",u.style.display="block",g.innerHTML="";else{u.style.display="none",p.style.display="block",y(l.value=e),r.refresh(),c.show(e,sgv.graf.currentScope),UI.clearSelect(d,!0),UI.clearSelect(o,!1);for(const a in sgv.graf.nodes){var i=a.toString()!==e.toString();o.appendChild(UI.tag("option",{value:a},{innerHTML:"q"+a})),i&&d.appendChild(UI.tag("option",{value:a},{innerHTML:"q"+a}))}var s;UI.selectByKey(o,e),!isMobile&&v&&(v=!1,void 0!==t)&&void 0!==n&&(s=sgv.canvas.clientLeft,f.style.top=n+"px",f.style.left=s+t+"px"),f.style.display="block",h=window.document.activeElement,f.focus({focusVisible:!1})}}function a(){null!==h&&h.focus({focusVisible:!1}),null!==f&&(f.style.display="none")}return f.addEventListener("keydown",function(e){e=e.key;"Escape"===e&&a()}),window.addEventListener("load",()=>{window.document.body.appendChild(f),a()}),{show:b,hide:a,refresh:function(){"block"===f.style.display&&b()},isVisible:()=>null!==f&&"block"===f.style.display}},DlgAlternateFileSave=(sgv.dlgNodeProperties=new DlgNodeProperties,function(){i=UI.tag("dialog",{class:"sgvUIwindow sgvModalDialog",id:"sgvDlgAltSaveGraph"}),s=UI.createTitlebar("Save graph",!1),i.appendChild(s),(content=UI.tag("div",{class:"content"})).appendChild(UI.tag("div",{},{style:"max-width:400px",textContent:"Your browser does not allow us to open the system window for selecting a file to save. Please select the file format and its name and click Save button. Depending on your browser's settings, the file will be saved in the default location (usually: Downloads) or a selection window will appear."})),content.appendChild(UI.tag("hr")),s=UI.tag("div"),(n=UI.tag("select",{id:"savSelectType"})).appendChild(UI.option(".txt","TXT")),n.appendChild(UI.option(".gexf","GEXF")),n.addEventListener("change",e=>{t.textContent=e.target.value}),s.appendChild(UI.tag("label",{for:"savSelectType"},{innerHTML:"Select format: "})),s.appendChild(n),content.appendChild(s),s=UI.tag("div"),e=UI.tag("input",{type:"text",id:"savSelectName",value:"filename"}),s.appendChild(UI.tag("label",{for:"savSelectname"},{innerHTML:"Select filename: "})),s.appendChild(e),t=UI.tag("span",{},{textContent:".txt"}),s.appendChild(t),content.appendChild(s),(n=UI.newInput("button","cancel","actionbutton","")).addEventListener("click",function(){o()}),content.appendChild(n),(s=UI.newInput("button","save","actionbutton","")).addEventListener("click",function(){FileIO.alternateSave(e.value,t.textContent),o()}),content.appendChild(s),i.appendChild(content),i.style.display="none";var e,t,n,i,s,a=i;function o(){a.close(),a.style.display="none"}return window.addEventListener("load",()=>{window.document.body.appendChild(a)}),{show:function(){a.style.display="block",a.showModal()},hide:o}});sgv.dlgAlternateFileSave=new DlgAlternateFileSave;class DlgMissingNodes{constructor(){this.ui=this.createUI("sgvMissingNodes"),window.addEventListener("load",()=>{window.document.body.appendChild(this.ui)})}createUI(e){var e=UI.createEmptyWindow("sgvUIwindow",e,"removed nodes",!0),t=UI.tag("div",{class:"content"}),n=(this.misN=UI.tag("div",{id:"misN"}),t.appendChild(this.misN),UI.newInput("button","clear history","delbutton",""));return n.addEventListener("click",()=>{this.delAll()}),t.appendChild(n),e.appendChild(t),e}addNode(e){var t=UI.newInput("button"," q"+e+" ","","rest"+e);t.addEventListener("click",()=>{this.restoreNode(e)}),this.misN.appendChild(t),this.ui.style.display="block"}restoreNode(e){return!!sgv.graf.restoreNode(e)&&((e=this.ui.querySelector("#rest"+e)).parentNode.removeChild(e),!0)}delAll(){this.misN.innerHTML="",null!==sgv.graf&&(sgv.graf.missing={}),this.hide()}show(){this.ui.style.display="block"}hide(){this.ui.style.display="none"}}sgv.dlgMissingNodes=new DlgMissingNodes;class DlgAbout{constructor(){this.ui=null}create(){null===this.ui&&(this.ui=UI.tag("dialog",{class:"sgvUIwindow sgvModalDialog",id:"sgvDlgAbout"}));var e=UI.tag("div",{class:"content"}),t=(e.style["text-align"]="center",e.style.width="fit-content",e.innerHTML+='<div><img src="pics/EuroHPC.jpg"></div>',e.innerHTML+="<div>Narodowa Infrastruktura Superkomputerowa dla EuroHPC - EuroHPC PL</div>",e.innerHTML+='<div class="info">simGraphVisualizer v.1.0</div>',e.innerHTML+='<div><img src="pics/Flagi.jpg"></div>',UI.tag("input",{type:"button",value:"Close",class:"actionbutton",id:"closeButton",name:"closeButton"})),t=(e.appendChild(t),t.addEventListener("click",()=>{this.hide()}),UI.createTitlebar("About",!1));this.ui.appendChild(t),this.ui.appendChild(e),this.ui.style.display="none",window.document.body.appendChild(this.ui)}show(){null===this.ui&&this.create(),this.ui.style.display="block",this.ui.showModal()}hide(){this.ui.close(),this.ui.style.display="none"}}sgv.dlgAbout=new DlgAbout;class DlgLoaderSplash{constructor(){this.ui=null,this.info}createDialog(){null===this.ui&&(this.ui=UI.tag("dialog",{class:"sgvModalDialog",id:"loaderSplash"})),this.ui.appendChild(UI.tag("span",{},{textContent:"working hard for you"})),this.ui.appendChild(UI.tag("div",{class:"loader"})),this.ui.appendChild(UI.tag("span",{},{textContent:"... please wait ..."})),this.ui.appendChild(this.info=UI.tag("div",{id:"infoBlock"})),this.ui.style.display="none",window.document.body.appendChild(this.ui)}show(){null===this.ui&&this.createDialog(),this.ui.open&&this.ui.close(),this.info.innerHTML="",this.ui.style.display="block",this.ui.showModal()}hide(){this.ui.close(),this.ui.style.display="none"}setInfo(e,t){this.ui.open&&this.ui.close(),this.ui.style.display="block",this.ui.showModal(),this.info.innerHTML=e,"function"==typeof t&&setTimeout(()=>{t()},100)}}function showSplash(){sgv.dlgLoaderSplash.show()}function hideSplash(){setTimeout(function(){sgv.dlgLoaderSplash.hide()},200)}function showSplashAndRun(e,t){void 0===t&&(t=!1),showSplash(),setTimeout(()=>{e(),t||hideSplash()},100)}sgv.dlgLoaderSplash=new DlgLoaderSplash;const SingleFilePanel=function(e,t,n,i){var s=UI.tag("div",{class:"singleFilePanel"}),t=(s.style.padding="2px",s.style.margin="2px",UI.newInput("text",t,"label","")),n=(s.appendChild(t),UI.newInput("text",n,"path","")),i=(s.appendChild(n),UI.newInput("text",i,"params","")),a=(s.appendChild(i),UI.tag("input",{type:"button",class:"toolButton",value:"x"}));return a.addEventListener("click",e=>{SingleFilePanel.removeByUi(e.target.parentNode)}),s.appendChild(a),{id:e,ui:s,label:t,path:n,params:i,close:()=>{SingleFilePanel.removeByUi(s)}}},DlgEditSettings=(SingleFilePanel.panels=[],SingleFilePanel.removeByUi=function(e){e.parentNode.removeChild(e);for(var t=0;t<SingleFilePanel.panels.length;t++)SingleFilePanel.panels[t].ui===e&&SingleFilePanel.panels.splice(t,1)},SingleFilePanel.removeAll=function(){for(var e=SingleFilePanel.panels.length-1;0<=e;e--){var t=SingleFilePanel.panels[e].ui;t.parentNode.removeChild(t),SingleFilePanel.panels.splice(e,1)}},SingleFilePanel.create=function(e,t,n,i){return(SingleFilePanel.panels[SingleFilePanel.panels.length]=new SingleFilePanel(e,t,n,i)).ui},function(){e=UI.tag("dialog",{class:"sgvUIwindow sgvModalDialog",id:"sgvDlgEditSettings"}),t=UI.createTitlebar("Edit settings",!1),e.appendChild(t),t=UI.tag("div",{id:"switches"}),(n=UI.tag("input",{type:"button",class:"actionbutton",id:"addPanelButton",name:"addPanelButton",value:"External programs"})).style["border-bottom"]="0",n.style["background-color"]="rgba(0,0,0,1.0)",n.style.position="relative",n.style.top="2px",n.style["border-bottom-left-radius"]="0",n.style["border-bottom-right-radius"]="0",t.appendChild(n),e.appendChild(t),(n=UI.tag("div",{id:"switch_content"})).style.border="1px solid #888",n.style["background-color"]="#000",(s=UI.tag("div",{id:"files"})).style["min-width"]="630px",s.style.padding="2px",n.appendChild(s),(t=UI.tag("input",{type:"button",class:"actionbutton",id:"addPanelButton",name:"addPanelButton",value:"add new"})).addEventListener("click",()=>{var e;0===SingleFilePanel.panels.length?s.appendChild(SingleFilePanel.create(0,"label_0","path_0","params_0")):(e=SingleFilePanel.panels[SingleFilePanel.panels.length-1].id+1,s.appendChild(SingleFilePanel.create(e,"label_"+e,"path_"+e,"params_"+e)))}),n.appendChild(t),e.appendChild(n),(t=UI.tag("div",{id:"wd"})).style.color="#ddd",t.style["padding-top"]="15px",t.style["text-align"]="center",t.appendChild(UI.span("Temporary directory: ",{id:"wDirLabel"})),(n=UI.tag("input",{type:"button",class:"actionbutton",id:"wdButton",name:"wdButton",value:"..."})).style.width="auto",n.addEventListener("click",()=>{void 0!==window.api&&window.api.invoke("getDirectoryDlg").then(e=>{a.value=e})}),t.appendChild(n),a=UI.newInput("text","","","workingDir"),t.appendChild(a),e.appendChild(t),n=UI.tag("div",{id:"buttons"}),(t=UI.tag("input",{type:"button",class:"actionbutton",id:"cancelButton",name:"cancelButton",value:"Cancel"})).addEventListener("click",()=>{i()}),n.appendChild(t),(t=UI.tag("input",{type:"button",class:"actionbutton",id:"saveButton",name:"saveButton",value:"Save settings"})).addEventListener("click",()=>{var e={workingDir:a.value,externApps:[]};for(const t of SingleFilePanel.panels)e.externApps.push({label:t.label.value,path:t.path.value,params:t.params.value});Settings.set(e),i()}),n.appendChild(t),e.appendChild(n);var s,a,e,t,n,o=e;function i(){o.close()}return window.addEventListener("load",()=>{window.document.body.appendChild(o)}),{show:function(e,t){o.close(),SingleFilePanel.removeAll();let n=0;for(const i of e)s.appendChild(SingleFilePanel.create(n,i.label,i.path,i.params)),n++;a.value=t,o.showModal()},hide:i}});sgv.dlgEditSettings=new DlgEditSettings,enableMenu=void 0!==window.api?(console.log("desktopApp!"),window.api.on("showLoaderSplash",()=>showSplash()),window.api.on("hideLoaderSplash",()=>hideSplash()),window.api.on("setDisplayMode",e=>{null!==sgv.graf&&(Graph.currentDisplayMode=e,sgv.graf.setDisplayMode())}),window.api.on("externalResult",e=>{sgv.stringToScope(e,"result"),hideSplash()}),window.api.on("clearGraph",()=>Graph.remove()),window.api.on("showAbout",()=>sgv.dlgAbout.show()),window.api.on("showSettings",(e,t)=>sgv.dlgEditSettings.show(e,t)),window.api.on("createDefault",()=>sgv.dlgCreateGraph.show()),window.api.on("switchConsole",()=>sgv.dlgConsole.switchConsole()),window.api.on("switchCellView",()=>sgv.dlgCellView.switchDialog()),window.api.on("loadFile",(e,t)=>{showSplashAndRun(()=>{FileIO.loadGraph2(e,t)})}),window.api.on("clickSaveGraph",t=>{showSplashAndRun(()=>{var e="";t.endsWith("txt")?e=ParserTXT.exportGraph(sgv.graf):t.endsWith("gexf")&&(e=ParserGEXF.exportGraph(sgv.graf)),window.api.invoke("saveStringToFile",e,t)})}),window.api.on("saveEnd",()=>hideSplash()),window.api.on("m2w_getScopeAsTXT_request",(t,...e)=>{console.log('2. (index.js) window.api.on("m2w_getScopeAsTXT_request")');var n=null!==sgv.graf?ParserTXT.exportGraph(sgv.graf):null;window.api.invoke(t,n,...e).then(e=>{console.log("4. (index.js) window.api.invoke("+t+").then()"),console.log("result = ",e)})}),desktopInit=()=>{setTimeout(function(){sgv.dlgCPL.hidePanel()},200)},(e,t)=>{void 0===t&&(t=!0),window.api.invoke("enableMenu",e,t)}):(desktopInit=()=>{},(e,t)=>{});