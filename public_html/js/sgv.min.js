var Label=function(e,t,s){this.id=e,this.createMe=async function(e,t){var s="normal 48px Arial",n=new BABYLON.DynamicTexture("DynamicTexture",64,sgv.scene).getContext(),n=(n.font=s,n.measureText(e).width+8),i=n*(4/72),o=new BABYLON.StandardMaterial("mat",sgv.scene);o.diffuseTexture=new BABYLON.DynamicTexture("DynamicTexture",{width:n,height:72},sgv.scene,!1),o.diffuseTexture.drawText(e,null,null,s,"#000000","#ffff00",!0),this.plane=BABYLON.MeshBuilder.CreatePlane(this.id+"_plane",{width:i,height:4,updatable:!0},sgv.scene),this.plane.material=o,this.plane.position=t.add(new BABYLON.Vector3(0,5,0)),this.plane.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_ALL,this.plane.setEnabled(!1),this.plane.isPickable=!1},this.createMe(t,s),this.setEnabled=function(e){this.plane.setEnabled(e)}},Label2=function(e,t,s){this.id=e;var t=t.length,n=26*t/15;const i=new BABYLON.StandardMaterial("mat");i.diffuseTexture=new BABYLON.Texture("cyferki.png"),i.diffuseTexture.uScale=t/11,i.diffuseTexture.vScale=1,i.diffuseTexture.uOffset=1/11,i.diffuseTexture.vOffset=0,this.plane=BABYLON.MeshBuilder.CreatePlane(e+"_plane",{width:n,height:3.2,updatable:!0},sgv.scene),this.plane.material=i,this.plane.position=s.add(new BABYLON.Vector3(0,5,0)),this.plane.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_ALL,this.plane.setEnabled(!1),this.plane.isPickable=!1,this.setEnabled=function(e){this.plane.setEnabled(e)}};const createLabel=function(e,t,s){return new Label("q"+e,"q"+e,t,s)};var Node=function(e,t,s,n,i,o){var r="node:"+t,a=(this.parentGraph=e,this.id=t,this.active=!0,this._chckedEdges=0,sgv.defaultSphere.clone(t));a.material=sgv.defaultSphere.material.clone(),a.position=new BABYLON.Vector3(s,n,i),a.name=r,a.setEnabled(!0),this.values={},this.label=createLabel(this.id,a.position,sgv.scene),Object.defineProperty(this,"position",{get(){return a.position},set(e){a.position=e}}),this.dispose=function(){a.dispose(),delete a,this.label.plane.dispose(),delete this.label.plane,delete this.label},this.clear=function(){this.dispose()},this.showLabel=function(e){this.label.setEnabled(e)},this.move=function(e){a.position.addInPlace(e)},this.addCheck=function(){this._chckedEdges++,a.material=sgv.grayMat1},this.delCheck=function(){this._chckedEdges--,0===this._chckedEdges&&(a.material=sgv.grayMat0)},this.getValue=function(e){return void 0===e&&(e=this.parentGraph.currentScope),this.values.hasOwnProperty(e)?this.values[e]:Number.NaN},this.exportGEXF=function(){let e='      <node id="'+this.id+'">\n';e+="        <attvalues>\n";for(const t in this.values)e+='          <attvalue for="'+this.parentGraph.getScopeIndex(t)+'" value="'+this.values[t]+'"/>\n';return e=e+"        </attvalues>\n"+"      </node>\n"},this.delValue=function(e){(e=void 0===e?this.parentGraph.currentScope:e)in this.values&&delete this.values[e]},this.setValue=function(e,t){void 0===t&&(t=this.parentGraph.currentScope),this.values[t]=e},this.displayValue=function(e){(e=void 0===e?this.parentGraph.currentScope:e)in this.values?a.material.emissiveColor=valueToColor(this.values[e]):a.material.emissiveColor=new BABYLON.Color4(.2,.2,.2)},this.setValue(o),this.displayValue()},Edge=function(e,t,s,n){this.parentGraph=e,this.values={},this.begin=t,this.end=s,this._checked=!1,this.update=function(){var e={instance:this.instance,path:[this.parentGraph.nodePosition(this.begin),this.parentGraph.nodePosition(this.end)]},t="edge:"+this.begin+","+this.end;this.instance=BABYLON.MeshBuilder.CreateTube(t,e,sgv.scene)},this.switchCheckFlag=function(){this._checked=!this._checked,this.parentGraph.checkNode(this.begin,this._checked),this.parentGraph.checkNode(this.end,this._checked),this.instance.material=this._checked?sgv.grayMat1:sgv.grayMat0},this.delValue=function(e){(e=void 0===e?this.parentGraph.currentScope:e)in this.values&&delete this.values[e]},this.getValue=function(e){return void 0===e&&(e=this.parentGraph.currentScope),this.values.hasOwnProperty(e)?this.values[e]:Number.NaN},this.setValue=function(e,t){this.values[t=void 0===t?"default":t]=e,this.displayValue(t)},this.exportGEXF=function(e){let t='      <edge id="'+e+'" source="'+this.begin+'" target="'+this.end+'">\n';t+="        <attvalues>\n";for(const s in this.values)t+='          <attvalue for="'+this.parentGraph.getScopeIndex(s)+'" value="'+this.values[s]+'"/>\n';return t=t+"        </attvalues>\n"+"      </edge>\n"},this.displayValue=function(e){void 0===e&&(e="default");let t=new BABYLON.Color3(.2,.2,.2),s=.1;e in this.values&&(t=valueToColor(this.values[e]),s=valueToEdgeWidth(this.values[e]));var e={instance:this.instance,path:[this.parentGraph.nodePosition(this.begin),this.parentGraph.nodePosition(this.end)],radius:s},n="edge:"+this.begin+","+this.end;this.instance=BABYLON.MeshBuilder.CreateTube(n,e,sgv.scene),this.instance.material.emissiveColor=t},this.createInstance=function(e){let t=new BABYLON.Color3(.2,.2,.2),s=.1;void 0===e?this.values.default=Number.NaN:(this.values.default=e,t=valueToColor(e),s=valueToEdgeWidth(e));var e={path:[this.parentGraph.nodePosition(this.begin),this.parentGraph.nodePosition(this.end)],radius:s,updatable:!0},n="edge:"+this.begin+","+this.end,n=(this.instance=BABYLON.MeshBuilder.CreateTube(n,e,sgv.scene),new BABYLON.StandardMaterial("mat",sgv.scene));n.diffuseColor=t,n.specularColor=new BABYLON.Color3(0,0,0),n.emissiveColor=new BABYLON.Color3(0,0,0),this.instance.material=n},this.createInstance(this.values.default)},Graph=function(){this.nodes={},this.edges={},this.missing={},this.type="generic",this.scopeOfValues=["default","losowe"],this.currentScope="default",this.greenLimit=1,this.redLimit=-1,this.dispose=function(){for(const e in this.edges)this.edges[e].instance.dispose(),delete this.edges[e];for(const t in this.nodes)this.nodes[t].clear(),delete this.nodes[t]},this.clear=function(){this.dispose()},this.maxNodeId=function(){return Object.keys(this.nodes).length},this.addNode=function(e,t,s){this.nodes[e]=new Node(this,e,t.x,t.y,t.z,s)},this.restoreNode=function(e){this.addNode(e,this.calcPosition(e),this.missing[e].value);for(const s in this.missing[e].edges){var t=parseInt(s,10);t in this.nodes?(console.log("key: ",t,typeof t),e<s?this.addEdge(e,t,this.missing[e].edges[t]):this.addEdge(t,e,this.missing[e].edges[t])):t in this.missing&&(this.missing[t].edges[e]=this.missing[e].edges[t])}delete this.missing[e],0===Object.keys(this.missing).length&&(sgv.ui.missingNodes.style.display="none")},this.getKeyByValue=function(t,s){return Object.keys(t).find(e=>t[e]===s)},this.getScopeIndex=function(t){return Object.keys(this.scopeOfValues).find(e=>this.scopeOfValues[e]===t)},this.exportTXT=function(){var e="# type="+this.type+"\n";e+="# size="+this.cols+","+this.rows+","+this.KL+","+this.KR+"\n";for(const t in this.nodes)e=(e+=t+" "+t+" ")+this.nodes[t].getValue()+"\n";for(const s in this.edges)e=(e+=this.edges[s].begin+" "+this.edges[s].end+" ")+this.edges[s].getValue()+"\n";return e},this.exportGEXF=function(){var t='<?xml version="1.0" encoding="UTF-8"?>\n',t=(t=(t=(t+='<gexf xmlns="http://gexf.net/1.2" version="1.2">\n')+"  <meta>\n"+"    <creator>IITiS.pl</creator>\n")+"    <description>SimGraphVisualizer GEXF export</description>\n"+"  </meta>\n")+'  <graph defaultedgetype="undirected">\n'+'    <attributes class="node">\n';for(const n in this.scopeOfValues){let e=this.scopeOfValues[n];"default"===e&&(e+=";"+this.type+";"+this.cols+","+this.rows+","+this.KL+","+this.KR),t+='      <attribute id="'+n+'" title="'+e+'" type="float"/>\n'}t+="    </attributes>\n    <nodes>\n";for(const i in this.nodes)t+=this.nodes[i].exportGEXF();t+='    </nodes>\n    <attributes class="edge">\n';for(const o in this.scopeOfValues){var e=this.scopeOfValues[o];t+='      <attribute id="'+o+'" title="'+e+'" type="float"/>\n'}t+="    </attributes>\n    <edges>\n";let s=0;for(const r in this.edges)t+=this.edges[r].exportGEXF(++s);return t=(t+="    </edges>\n")+"  </graph>\n"+"</gexf>\n"},this.addEdge=function(e,t,s){e<t?this.edges[e+","+t]=new Edge(this,e,t):this.edges[t+","+e]=new Edge(this,t,e)},this.delEdge=function(e){this.edges[e].instance.dispose(),delete this.edges[e]},this.findAndDeleteEdges=function(e){var t={};console.log("graf.findAndDeleteEdges",e);for(const s in this.edges)this.edges[s].begin.toString()===e?(t[this.edges[s].end]=this.edges[s].value,this.delEdge(s)):this.edges[s].end.toString()===e&&(t[this.edges[s].begin]=this.edges[s].value,this.delEdge(s));return t},this.delNode=function(e){var t=this.findAndDeleteEdges(e);this.missing[e]={value:this.nodes[e].value,edges:{}};for(const s in t)this.missing[e].edges[s]=t[s];this.nodes[e].clear(),delete this.nodes[e],sgv.addToMissing(e)},this.findAndUpdateEdges=function(e){for(const t in this.edges)this.edges[t].begin.toString()!==e&&this.edges[t].end.toString()!==e||this.edges[t].update()},this.stringToStruct=e=>{if(null==e)return null;for(var t,s,n={nodes:{},edges:{}},i=e.split("\n");0<i.length;)"#"!==i[0][0]&&null!==(t=function(e){e=e.split(" ");return 3===e.length?{n1:parseInt(e[0],10),n2:parseInt(e[1],10),val:parseFloat(e[2],10)}:null}(i[0]))&&(t.n1===t.n2?n.nodes[t.n1]=t.val:(s=t.n1<t.n2?t.n1+","+t.n2:t.n2+","+t.n1,n.edges[s]=t.val)),i.shift();return n},this.loadScopeValues=(e,t)=>{let s=!1;void 0===e||this.scopeOfValues.includes(e)||(this.scopeOfValues.push(e),s=!0);var n=this.stringToStruct(t);for(const i in n.nodes)this.nodes[i].setValue(n.nodes[i],e);for(const o in n.edges)this.edges[o].setValue(n.edges[o],e);return this.displayValues(e),{n:s,i:this.scopeOfValues.indexOf(e)}},this.addScopeOfValues=function(e){return void 0===e||this.scopeOfValues.includes(e)?-1:(this.scopeOfValues.push(e),this.scopeOfValues.indexOf(e))},this.delScopeOfValues=function(e){if(void 0!==e&&"default"!==e){var t=this.scopeOfValues.indexOf(e);if(-1!==t){this.scopeOfValues.splice(t,1);for(const s in this.nodes)this.nodes[s].delValue(e);return this.currentScope===e&&(this.currentScope="default",this.displayValues("default")),this.scopeOfValues.indexOf(this.currentScope)}}return-1},this.hasScope=function(e){return void 0!==e&&this.scopeOfValues.includes(e)},this.displayValues=function(e){if(void 0===e||!this.scopeOfValues.includes(e))return!1;this.currentScope=e;for(const t in this.nodes)this.nodes[t].displayValue(e);for(const s in this.edges)this.edges[s].displayValue(e);return!0},this.nodePosition=function(e){return this.nodes[e].position},this.checkNode=function(e,t){t?this.nodes[e].addCheck():this.nodes[e].delCheck()},this.edgeDoubleClicked=function(e){this.edges[e].switchCheckFlag()},this.moveNode=function(e,t){this.nodes[e].move(t),this.findAndUpdateEdges(e)},this.setEdgeValue=function(e,t){this.edges[e].setValue(t),this.edges[e].displayValue()},this.delEdgeValue=function(e){this.edges[e].delValue(),this.edges[e].displayValue()},this.edgeValue=function(e){return this.edges[e].getValue()},this.setNodeValue=function(e,t,s){this.nodes[e].setValue(t,s),this.nodes[e].displayValue()},this.delNodeValue=function(e,t){this.nodes[e].delValue(t),this.nodes[e].displayValue()},this.nodeValue=function(e,t){return this.nodes[e].getValue(t)},this.getMinMaxEdgeVal=function(e){void 0!==e&&this.scopeOfValues.includes(e)||(e=this.currentScope);var t={min:Number.MAX_VALUE,max:Number.MIN_VALUE,com:""};let s=!0;for(const i in this.edges){var n=this.edges[i].getValue(e);n<t.min&&(s=!1,t.min=n),n>t.max&&(s=!1,t.max=n)}return s&&(t.min=Number.NaN,t.max=Number.NaN,t.com="\nWARNING: The graph has no edge that has a weight in the current scope.\n"),t},this.getMinMaxNodeVal=function(e){void 0!==e&&this.scopeOfValues.includes(e)||(e=this.currentScope);var t={min:Number.MAX_VALUE,max:Number.MIN_VALUE,com:""};let s=!0;for(const i in this.nodes){var n=this.nodes[i].getValue(e);n<t.min&&(s=!1,t.min=n),n>t.max&&(s=!1,t.max=n)}return s&&(t.min=Number.NaN,t.max=Number.NaN,t.com="\nWARNING: The graph has no node that has a value in the current scope.\n"),t},this.getMinMaxVal=function(){var e={min:99999.9,max:-99999.9};for(const t in this.edges)this.edges[t].value<e.min&&(e.min=this.edges[t].value),this.edges[t].value>e.max&&(e.max=this.edges[t].value);for(const s in this.nodes)this.nodes[s].value<e.min&&(e.min=this.nodes[s].value),this.nodes[s].value>e.max&&(e.max=this.nodes[s].value);return e},this.calcPosition=function(e){return new BABYLON.Vector3},this.changeDisplayMode=function(){for(const t in this.nodes){var e=this.calcPosition(t);this.nodes[t].position.copyFrom(e),this.nodes[t].label.plane.position.copyFrom(e).addInPlaceFromFloats(0,5,0)}for(const s in this.edges)this.edges[s].update()},this.showLabels=function(e){if(sgv.labelsVisible)for(const t in this.nodes)this.nodes[t].showLabel(e)},this.addScopeOfValues("losowe2")};function valueToColor(e){var t,s,n=sgv.graf.greenLimit,i=sgv.graf.redLimit;return n=0<e?(t=0,1-(s=e<n?e/n:1)):e<0?(s=0,1-(t=i<e?e/i:1)):(s=t=0,1),new BABYLON.Color3(t,s,n)}function valueToEdgeWidth(e){e=Math.abs(e)/2;return.5<e?e=.7:e<.1&&(e=.1),e}var Chimera=function(){Graph.call(this),this.type="chimera",this.modSize,this.nbModules,this.cols,this.rows,this.KL,this.KR,this.mX={"-8":375,"-7":325,"-6":275,"-5":225,"-4":175,"-3":125,"-2":75,"-1":25,0:-25,1:-75,2:-125,3:-175,4:-225,5:-275,6:-325,7:-375},this.mmX=function(e){return-25-50*e},this.mY={"-8":75,"-7":65,"-6":55,"-5":45,"-4":35,"-3":25,"-2":15,"-1":5,0:-5,1:-15,2:-25,3:-35,4:-45,5:-55,6:-65,7:-75},this.mmY=function(e){return-5-10*e},this.mZ={"-8":-375,"-7":-325,"-6":-275,"-5":-225,"-4":-175,"-3":-125,"-2":-75,"-1":-25,0:25,1:75,2:125,3:175,4:225,5:275,6:325,7:375},this.mmZ=function(e){return 25+50*e},this.maxNodeId=function(){return this.cols*this.rows*(this.KL+this.KR)},this.connectRowModules=function(t,s){for(let e=this.KL+1;e<=this.modSize;e++)this.addEdge(this.modSize*t+e,this.modSize*s+e,0)},this.connectColModules=function(t,s){for(let e=1;e<=this.KL;e++)this.addEdge(this.modSize*t+e,this.modSize*s+e,0)},this.createModule=function(e){var s=this.modSize*e;for(let e=1;e<=this.modSize;e++)this.addNode(s+e,this.calcPosition(s+e),0);for(let t=1;t<=this.KL;t++)for(let e=this.KL+1;e<=this.modSize;e++)this.addEdge(s+t,s+e,0)},this.calcPosition=function(e){var t=Math.floor((e-1)/this.modSize),e=Math.floor((e-1)%this.modSize),s=Math.floor(t/this.rows)-this.rows/2,t=Math.floor(t%this.cols)-this.cols/2,s=new BABYLON.Vector3(this.mX[s],this.mY[s],this.mZ[t]),t=this.getNodeOffset(e);return s.addInPlace(t),s},this.getNodeOffset=function(e){var t={classic:[new BABYLON.Vector3(15,-3,-10),new BABYLON.Vector3(5,-1,-10),new BABYLON.Vector3(-5,1,-10),new BABYLON.Vector3(-15,3,-10),new BABYLON.Vector3(15,3,10),new BABYLON.Vector3(5,1,10),new BABYLON.Vector3(-5,-1,10),new BABYLON.Vector3(-15,-3,10)],diamond:[new BABYLON.Vector3(0,-3,9),new BABYLON.Vector3(0,-1,3),new BABYLON.Vector3(0,1,-3),new BABYLON.Vector3(0,3,-9),new BABYLON.Vector3(9,3,0),new BABYLON.Vector3(3,1,0),new BABYLON.Vector3(-3,-1,0),new BABYLON.Vector3(-9,-3,0)],triangle:[new BABYLON.Vector3(-15,-3,9),new BABYLON.Vector3(-15,-1,3),new BABYLON.Vector3(-15,1,-3),new BABYLON.Vector3(-15,3,-9),new BABYLON.Vector3(9,3,15),new BABYLON.Vector3(3,1,15),new BABYLON.Vector3(-3,-1,15),new BABYLON.Vector3(-9,-3,15)]};let s=e;return s>=this.KL&&(s=s-this.KL+4),t[sgv.displayMode][s]},this.createDefaultStructure=function(){for(let e=0;e<this.nbModules;e++)this.createModule(e);for(let t=0;t<this.nbModules;t+=this.rows)for(let e=1;e<this.rows;e++)this.connectRowModules(t+(e-1),t+e);for(let t=0;t<this.rows;t++)for(let e=this.rows;e<this.nbModules;e+=this.rows)this.connectColModules(e-this.rows+t,e+t);this.showLabels(!0)},this.createStructureFromDef=function(t){for(let e=0;e<t.length;e++){var s,n;t[e].n1===t[e].n2?(s=t[e].n1,this.addNode(s,this.calcPosition(s),t[e].val)):(s=t[e].n1,n=t[e].n2,this.addEdge(s,n,t[e].val),this.edges[t[e].n1+","+t[e].n2].setValue(t[e].val,"default"))}},this.createStructureFromDef2=function(t){for(let e=0;e<t.length;e++)if(t[e].n1===t[e].n2){var s=t[e].n1;this.addNode(s,this.calcPosition(s),0);for(const r in t[e].values)this.nodes[s].setValue(t[e].values[r],r);this.nodes[s].displayValue("default")}else{var n=t[e].n1,i=t[e].n2,o=(this.addEdge(n,i),n+","+i);i<n&&(o=i+","+n);for(const a in t[e].values)this.edges[o].setValue(t[e].values[a],a);this.edges[o].displayValue("default")}},this.setSize=function(e,t,s,n){this.cols=e,this.rows=t,this.KL=s,this.KR=n,this.nbModules=this.cols*this.rows,this.modSize=this.KL+this.KR,this.size=this.nbModules*this.modSize}};Chimera.prototype=Object.create(Chimera.prototype),(Chimera.prototype.constructor=Chimera).createNewGraph=function(e){var t=new Chimera;return t.cols=e.cols,t.rows=e.rows,t.KL=e.KL,t.KR=e.KR,t.nbModules=t.cols*t.rows,t.modSize=t.KL+t.KR,t.size=t.nbModules*t.modSize,t};const qD=function(e,t,s,n,i,o){return new QbDescr(e,t,s,n,i,o)},QbDescr=function(e,t,s,n,i,o){this.x=e,this.y=t,this.z=s,this.i=n,this.j=i,this.k=o,this.n0=function(){return((this.i<<1)+this.j<<1)+this.k},this.n1=function(){return((this.i<<1)+this.j<<1)+this.k+1},this.toNodeId=function(e,t){return 8*(this.x+(this.y+this.z*e)*t)+this.n1()}};QbDescr.fromNodeId=function(e,t,s){var e=e-1,n=e%8,i=n%2,o=(n>>1)%2,n=(n>>2)%2,e=e>>3,t=s*t,r=Math.floor(e/t),e=e%t,t=Math.floor(e/s),e=e%s;return new QbDescr(e,t,r,n,o,i)};var Pegasus=function(){Graph.call(this),this.type="pegasus",this.modSize,this.nbModules,this.cols,this.rows,this.KL,this.KR,this.layers,this.setSize=function(e,t,s,n){this.cols=e,this.rows=t,this.KL=s,this.KR=n,this.layers=3,this.nbModules=this.cols*this.rows*this.layers,this.modSize=this.KL+this.KR,this.size=this.nbModules*this.modSize},this.maxNodeId=function(){return this.cols*this.rows*8},this.createDefaultStructure=function(){for(let s=0;s<this.layers;s++)for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++)this.createModule2(e,t,s);for(let s=0;s<this.layers;s++)for(let t=0;t<this.rows-1;t++)for(let e=0;e<this.cols;e++)this.connectRowModules2(e,t,s);for(let s=0;s<this.layers;s++)for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols-1;e++)this.connectColModules2(e,t,s);for(let s=0;s<this.layers;s++)for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++)this.connectEvenMoreIdioticPegasusEdges(e,t,s);this.showLabels(!0)},this.connect=function(e,t,s){e=e.toNodeId(this.rows,this.cols),t=t.toNodeId(this.rows,this.cols);e in this.nodes&&t in this.nodes&&this.addEdge(e,t,s)},this.connectEvenMoreIdioticPegasusEdges=function(n,i,o){for(let s=0;s<2;s++)for(let t=0;t<2;t++)for(let e=0;e<2;e++)o<this.layers-1?(this.connect(new QbDescr(n,i,o,0,0,s),new QbDescr(n,i,o+1,1,t,e),0),this.connect(new QbDescr(n,i,o,1,0,s),new QbDescr(n,i,o+1,0,t,e),0),0<n&&this.connect(new QbDescr(n,i,o,0,1,s),new QbDescr(n-1,i,o+1,1,t,e),0),0<i&&this.connect(new QbDescr(n,i,o,1,1,s),new QbDescr(n,i-1,o+1,0,t,e),0)):(n<this.cols-1&&i<this.rows-1&&(this.connect(new QbDescr(n,i,o,0,0,s),new QbDescr(n+1,i+1,0,1,t,e),0),this.connect(new QbDescr(n,i,o,1,0,s),new QbDescr(n+1,i+1,0,0,t,e),0)),i<this.rows-1&&this.connect(new QbDescr(n,i,o,0,1,s),new QbDescr(n,i+1,0,1,t,e),0),n<this.cols-1&&this.connect(new QbDescr(n,i,o,1,1,s),new QbDescr(n+1,i,0,0,t,e),0))},this.connectRowModules2=function(s,n,i){for(let t=0;t<2;t++)for(let e=0;e<2;e++)this.connect(new QbDescr(s,n,i,1,t,e),new QbDescr(s,n+1,i,1,t,e),getRandom(-.5,.5))},this.connectColModules2=function(s,n,i){for(let t=0;t<2;t++)for(let e=0;e<2;e++)this.connect(new QbDescr(s,n,i,0,t,e),new QbDescr(s+1,n,i,0,t,e),getRandom(-.5,.5))},this.connectInternalPegasusEdges=function(e,t,s){let n=8*(e+(t+s*this.rows)*this.cols);1<this.KL&&(this.addEdge(n+1,n+2,getRandom(-.5,.5)),3<this.KL&&this.addEdge(n+3,n+4,getRandom(-.5,.5))),n+=4,1<this.KR&&(this.addEdge(n+1,n+2,getRandom(-.5,.5)),3<this.KR&&this.addEdge(n+3,n+4,getRandom(-.5,.5)))},this.createModule2=function(t,s,n){var i=8*(t+(s+n*this.rows)*this.cols);for(let e=0;e<this.KL;e++)this.addNode(i+e+1,this.calcPosition2(t,s,n,e),getRandom(-1,1));for(let e=4;e<this.KR+4;e++)this.addNode(i+e+1,this.calcPosition2(t,s,n,e),getRandom(-1,1));for(let t=0;t<this.KL;t++)for(let e=0;e<this.KR;e++)this.addEdge(i+t+1,4+i+e+1,getRandom(-.5,.5));this.connectInternalPegasusEdges(t,s,n)},this.mX={"-8":375,"-7":325,"-6":275,"-5":225,"-4":175,"-3":125,"-2":75,"-1":25,0:-25,1:-75,2:-125,3:-175,4:-225,5:-275,6:-325,7:-375},this.mmX=function(e){return-25-50*e},this.mY={"-8":75,"-7":65,"-6":55,"-5":45,"-4":35,"-3":25,"-2":15,"-1":5,0:-5,1:-15,2:-25,3:-35,4:-45,5:-55,6:-65,7:-75},this.mmY=function(e){return-5-10*e},this.mZ={"-8":-375,"-7":-325,"-6":-275,"-5":-225,"-4":-175,"-3":-125,"-2":-75,"-1":-25,0:25,1:75,2:125,3:175,4:225,5:275,6:325,7:375},this.mmZ=function(e){return 25+50*e},this.getNodeOffset=function(e){var t=[new BABYLON.Vector3(15,-3,-10),new BABYLON.Vector3(5,-1,-10),new BABYLON.Vector3(-5,1,-10),new BABYLON.Vector3(-15,3,-10),new BABYLON.Vector3(15,3,10),new BABYLON.Vector3(5,1,10),new BABYLON.Vector3(-5,-1,10),new BABYLON.Vector3(-15,-3,10)];let s=e;return s<this.KL?t[s]:t[s=s-this.KL+4]},this.getNodeOffset2=function(e){return{classic:[new BABYLON.Vector3(15,-3,-10),new BABYLON.Vector3(5,-1,-10),new BABYLON.Vector3(-5,1,-10),new BABYLON.Vector3(-15,3,-10),new BABYLON.Vector3(15,3,10),new BABYLON.Vector3(5,1,10),new BABYLON.Vector3(-5,-1,10),new BABYLON.Vector3(-15,-3,10)],diamond:[new BABYLON.Vector3(0,-3,9),new BABYLON.Vector3(0,-1,3),new BABYLON.Vector3(0,1,-3),new BABYLON.Vector3(0,3,-9),new BABYLON.Vector3(9,3,0),new BABYLON.Vector3(3,1,0),new BABYLON.Vector3(-3,-1,0),new BABYLON.Vector3(-9,-3,0)],triangle:[new BABYLON.Vector3(-15,-3,9),new BABYLON.Vector3(-15,-1,3),new BABYLON.Vector3(-15,1,-3),new BABYLON.Vector3(-15,3,-9),new BABYLON.Vector3(9,3,15),new BABYLON.Vector3(3,1,15),new BABYLON.Vector3(-3,-1,15),new BABYLON.Vector3(-9,-3,15)]}[sgv.displayMode][e]},this.calcPosition=function(e){let t=QbDescr.fromNodeId(e,this.rows,this.cols);return this.calcPosition2(t.x,t.y,t.z,t.n0())},this.calcPosition2=function(e,t,s,n){e=new BABYLON.Vector3(this.mmX(e),this.mmY(e),this.mmZ(t));return e.addInPlace(new BABYLON.Vector3(0,40*s,0)),e.addInPlace(this.getNodeOffset2(n)),e},this.createStructureFromDef=function(s){for(let t=0;t<s.length;t++)if(s[t].n1===s[t].n2){var n=s[t].n1;let e=QbDescr.fromNodeId(n,this.rows,this.cols);this.addNode(n,this.calcPosition2(e.x,e.y,e.z,e.n0()),s[t].val)}else{var n=s[t].n1,e=s[t].n2;this.addEdge(n,e,s[t].val)}}},UI=(Pegasus.prototype=Object.create(Pegasus.prototype),(Pegasus.prototype.constructor=Pegasus).createNewGraph=function(e){var t=new Pegasus;return t.cols=e.cols,t.rows=e.rows,t.KL=e.KL,t.KR=e.KR,t.layers=3,t.nbModules=t.cols*t.rows*t.layers,t.modSize=t.KL+t.KR,t.size=t.nbModules*t.modSize,t},function(){this.panelSwitch=UI.createPanelSwitch(),this.panelSwitch.addEventListener("click",function(){sgv.controlPanel.switchPanel()}),this.consoleSwitch=UI.createConsoleSwitch(),this.consoleSwitch.addEventListener("click",function(){sgv.console.switchConsole()}),this.dispModeSwitch=UI.createDispModeSwitch(),this.dispModeSwitch.addEventListener("click",function(){sgv.switchDisplayMode()}),this.nodeProperties=UI.createNodeProperties(),this.nodeProperties.querySelector(".hidebutton").addEventListener("click",function(){sgv.cancelN()}),this.nodeProperties.querySelector("#nsSelectN").addEventListener("change",function(){sgv.changeScopeN()}),this.nodeProperties.querySelector("#valueCheckN").addEventListener("click",function(){sgv.activateN()}),this.nodeProperties.querySelector("#setN").addEventListener("click",function(){sgv.edycjaN()}),this.nodeProperties.querySelector("#connectN").addEventListener("click",function(){sgv.connectNodes()}),this.nodeProperties.querySelector("#connectSelectN").addEventListener("click",function(){sgv.connectSelectN()}),this.nodeProperties.querySelector(".delbutton").addEventListener("click",function(){sgv.usunN()}),this.edgeProperties=UI.createEdgeProperties(),this.edgeProperties.querySelector(".hidebutton").addEventListener("click",function(){sgv.cancelE()}),this.edgeProperties.querySelector("#valueCheckE").addEventListener("click",function(){sgv.activateE()}),this.edgeProperties.querySelector("#setE").addEventListener("click",function(){sgv.edycjaE()}),this.edgeProperties.querySelector(".delbutton").addEventListener("click",function(){sgv.usunE()}),this.missingNodes=UI.createMissing("sgvMissingNodes"),this.missingNodes.querySelector(".delbutton").addEventListener("click",function(){sgv.delMissing()}),this.oknoN={show:function(e,t,s){var n=sgv.canvas.clientLeft;sgv.ui.nodeProperties.querySelector(".titleText").textContent="Node q"+e,sgv.ui.nodeProperties.querySelector("#nodeId").value=e;let i=sgv.ui.nodeProperties.querySelector("#nsSelectN");for(let e=i.options.length-1;0<=e;e--)i.options[e]=null;for(const l in sgv.graf.scopeOfValues)(o=document.createElement("option")).value=l,o.innerHTML=sgv.graf.scopeOfValues[l],sgv.graf.currentScope===sgv.graf.scopeOfValues[l]&&(o.selected="selected"),i.appendChild(o);var o,r=sgv.graf.nodeValue(e);null===r||isNaN(r)?(sgv.ui.nodeProperties.querySelector("#valueCheckN").checked="",sgv.ui.nodeProperties.querySelector("#wagaN").value=null,sgv.ui.nodeProperties.querySelector("#wagaN").disabled="disabled",sgv.ui.nodeProperties.querySelector("#setN").disabled="disabled"):(sgv.ui.nodeProperties.querySelector("#valueCheckN").checked="checked",sgv.ui.nodeProperties.querySelector("#wagaN").value=r,sgv.ui.nodeProperties.querySelector("#wagaN").disabled="",sgv.ui.nodeProperties.querySelector("#setN").disabled="");let a=sgv.ui.nodeProperties.querySelector("#destN");for(let e=a.options.length-1;0<=e;e--)a.options[e]=null;for(const d in sgv.graf.nodes)d.toString()!==e.toString()&&((o=document.createElement("option")).value=d,o.innerHTML="q"+d,a.appendChild(o));sgv.ui.nodeProperties.style.top=s+"px",sgv.ui.nodeProperties.style.left=n+t+"px",sgv.ui.nodeProperties.style.display="block"}}}),getRandom=(UI.tag=function(e,t,s){var n=document.createElement(e);for(const i in t)n.setAttribute(i,t[i]);for(const o in s)n[o]=s[o];return n},UI.span=function(e,t){return UI.tag("span",t,{textContent:e})},UI.findOption=function(e,t){for(var s=0;s<e.options.length;s++)if(e.options[s].value===t)return s;return-1},UI.option=function(e,t){var s=document.createElement("option");return s.value=e,s.text=t,s},UI.input=function(e){var t=document.createElement("input");for(const s in e)t.setAttribute(s,e[s]);return t},UI.newInput=function(e,t,s,n){var i=document.createElement("input");return i.setAttribute("type",e),i.value=t,void 0!==s&&""!==s&&i.setAttribute("class",s),void 0!==n&&""!==n&&i.setAttribute("id",n),i},UI.createTitlebar=function(e,t){var s=UI.tag("div",{class:"title"});return t&&s.appendChild(UI.tag("input",{type:"button",value:"x",class:"hidebutton"})),s.appendChild(UI.tag("span",{class:"titleText"},{textContent:e})),s},UI.createEmptyWindow=function(e,t,s,n){var i=document.createElement("div"),e=(void 0!==e&&""!==e&&i.setAttribute("class",e),void 0!==t&&""!==t&&i.setAttribute("id",t),UI.createTitlebar(s,n));return i.appendChild(e),i},UI.createNodeProperties=function(){var e=UI.createEmptyWindow("sgvUIwindow","sgvNodeProperties","Node: q1",!0),t=(e.appendChild(UI.newInput("hidden","0","","nodeId")),document.createElement("div")),s=(t.setAttribute("class","content"),document.createElement("select")),s=(s.setAttribute("id","nsSelectN"),t.innerHTML+="Scope: ",t.appendChild(s),t.appendChild(document.createElement("br")),t.appendChild(UI.newInput("checkbox","","","valueCheckN")),t.appendChild(UI.newInput("number","0","","wagaN")),t.appendChild(UI.newInput("button","set","setvaluebutton","setN")),t.appendChild(document.createElement("br")),t.appendChild(UI.newInput("button","connect to...","","connectN")),document.createElement("select"));return s.setAttribute("id","destN"),t.appendChild(s),t.appendChild(UI.newInput("button","^","","connectSelectN")),t.appendChild(document.createElement("br")),t.appendChild(UI.newInput("button","delete","delbutton","")),e.appendChild(t),document.body.appendChild(e),e},UI.createEdgeProperties=function(){var e=UI.createEmptyWindow("sgvUIwindow","sgvEdgeProperties","Edge: q1 &lt;---&gt; q2",!0);return e.innerHTML+='<input id="edgeId" type="hidden" value="0">         <div class="content">             <input type="checkbox" value="" id="valueCheckE"><input id="wagaE" type="number" value="0"><input class="setvaluebutton" id="setE" type="button" value="set">             <br/><input class="delbutton" type="button" value="delete">         </div>',document.body.appendChild(e),e},UI.createMissing=function(e){e=UI.createEmptyWindow("sgvUIwindow",e,"removed nodes",!1);return e.innerHTML+='<div class="content"><div id="misN"></div>         <input class="delbutton" type="button" value="clear history">         </div>',document.body.appendChild(e),e},UI.createGraphs=function(e){e=UI.createEmptyWindow("sgvUIwindow",e,"graphs",!1);return e.innerHTML+='<div class="content"></div>',document.body.appendChild(e),e},UI.createConsole=function(e){e=UI.createEmptyWindow("sgvUIwindow",e,"console",!0);return e.innerHTML+='<div class="content">             <textarea id="consoleHistory" readonly></textarea>             <input type="text" id="commandline">         </div>         <div style="background-color:blue;height:5px;width:15px;float:right"></div><div style="background-color:green;height:5px;width:15px;float:left"></div><div style="background-color:red;height:5px;width:auto"></div>',document.body.appendChild(e),e},UI.createControlPanel=function(e){divSel=function(){var e=UI.tag("div",{class:"content",id:"graphSelection"});return e.style.display="block",e.innerHTML='<div>graph: <select id="graphType"><option value="chimera">chimera</option><option value="pegasus">pegasus</option></select>             size: <select id="graphCols"><option selected="selected" value="4">4</option><option value="8">8</option><option value="12">12</option><option value="16">16</option></select>             x <select id="graphRows"><option selected="selected" value="4">4</option><option value="8">8</option><option value="12">12</option><option value="16">16</option></select>             K <select id="graphKL"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option selected="selected" value="4">4</option></select>             , <select id="graphKR"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option selected="selected" value="4">4</option></select>             </div><div><input class="" id="cplCreateButton" name="createButton" type="button" value="Create default"></div>             <div>Read from .txt file: <input id="inputfile" type="file"></div>',e},divDesc=function(){var e=UI.tag("div",{class:"content",id:"graphDescription"});e.innerHTML="Current graph type: ",e.appendChild(UI.span("unknown",{id:"dscr_type"})),e.innerHTML+=', size: <span id="dscr_cols">0</span>x<span id="dscr_rows">0</span>xK<sub><span id="dscr_KL">0</span>,<span id="dscr_KR">0</span></sub><br/>                 Number of nodes: <span id="dscr_nbNodes">0</span>, number of edges: <span id="dscr_nbEdges">0</span>';let t=UI.tag("div",{class:"sgvD1",id:"cplDivNS"},{textContent:"add new scope: "}),s=(t.appendChild(UI.tag("input",{type:"button",class:"sgvC",id:"cplSkipAddScope",value:"<"})),t.appendChild(UI.tag("input",{type:"text",id:"cplAddScopeInput",value:"newScope"})),t.appendChild(UI.tag("input",{type:"button",class:"sgvC",id:"cplAcceptAddScope",value:"+"})),t.style.display="none",UI.tag("select",{id:"cplDispValues"})),n=(s.add(UI.option("default","default")),s.add(UI.option("losowe","losowe")),s.add(UI.option("losowe2","losowe2")),UI.tag("div",{class:"sgvD1",id:"cplDivDS"},{textContent:"current scope: "})),i=(n.appendChild(s),n.appendChild(UI.tag("input",{type:"button",class:"sgvC",id:"cplAddScope",value:"+"})),n.appendChild(UI.tag("input",{type:"button",class:"sgvC",id:"cplDelScope",value:"-"})),UI.tag("div",{class:"sgvSelectBox",id:"cplScope"}));return i.appendChild(t),i.appendChild(n),e.appendChild(i),e.appendChild(UI.tag("input",{class:"actionbutton",id:"cplSaveButton",type:"button",value:"save to TXT"})),e.appendChild(UI.tag("input",{class:"actionbutton",id:"cplSaveGEXFButton",type:"button",value:"save to GEXF"})),e.appendChild(UI.tag("input",{class:"delbutton",id:"cplDeleteButton",type:"button",value:"clear workspace"})),e.appendChild(UI.tag("input",{class:"actionbutton",id:"cplElectronTestButton",type:"button",value:">>> TEST <<<"})),e.style.display="none",e};e=UI.createEmptyWindow("sgvUIwindow",e,"control panel",!0);return e.appendChild(divSel()),e.appendChild(divDesc()),document.body.appendChild(e),e},UI.createPanelSwitch=function(){var e=UI.newInput("button","CPL","sgvTransparentButton","sgvPanelSwitch");return document.body.appendChild(e),e},UI.createConsoleSwitch=function(){var e=UI.newInput("button","CON","sgvTransparentButton","sgvConsoleSwitch");return document.body.appendChild(e),e},UI.createDispModeSwitch=function(){var e=UI.tag("input",{type:"button",value:"DIS",class:"sgvTransparentButton",id:"sgvDispModeSwitch"});return document.body.appendChild(e),e},parseGEXF=function(e){var o="unknown",r={cols:0,rows:0,KL:0,KR:0},a={},l={},d=[];return parseNodes=function(e){let t=e.getElementsByTagName("nodes"),n=t[0].getElementsByTagName("node");for(let t=0;t<n.length;t++){let s={};var i=n[t].getAttribute("id");s.n1=s.n2=parseInt(i),s.values={};let e=n[t].getElementsByTagName("attvalues");if(0<e.length){let t=e[0].getElementsByTagName("attvalue");for(let e=0;e<t.length;e++){var o=t[e].getAttribute("value"),r=t[e].getAttribute("for"),r=a[r];s.values[r]=parseFloat(o)}}d.push(s)}},parseEdges=function(e){let t=e.getElementsByTagName("edges"),n=t[0].getElementsByTagName("edge");for(let t=0;t<n.length;t++){let s={};var i=n[t].getAttribute("source"),o=n[t].getAttribute("target");s.n1=parseInt(i),s.n2=parseInt(o),s.values={};let e=n[t].getElementsByTagName("attvalues");if(0<e.length){let t=e[0].getElementsByTagName("attvalue");for(let e=0;e<t.length;e++){var r=t[e].getAttribute("value"),a=t[e].getAttribute("for"),a=l[a];s.values[a]=parseFloat(r)}}d.push(s)}},parseNodeAttribute=function(e){var t,s=e.getAttribute("id");let n=e.getAttribute("title");return n.startsWith("default")?(e=n.split(";"),n=e[0],t=e[1],e=e[2],{id:s,title:n,type:t,size:e}):{id:s,title:n}},parseEdgeAttribute=function(e){return{id:e.getAttribute("id"),title:e.getAttribute("title")}},parseAttributes=function(e){let t=e.getElementsByTagName("attributes");for(let e=0;e<t.length;e++){var s,n=t[e].getAttribute("class"),i=t[e].getElementsByTagName("attribute");for(let t=0;t<i.length;t++)if("node"===n){let e=parseNodeAttribute(i[t]);a[e.id]=e.title,"type"in e&&(o=e.type),"size"in e&&(s=e.size.split(","),r.cols=parseInt(s[0]),r.rows=parseInt(s[1]),r.KL=parseInt(s[2]),r.KR=parseInt(s[3]))}else"edge"===n&&(s=parseEdgeAttribute(i[t]),l[s.id]=s.title)}},window.DOMParser?(parser=new DOMParser,xmlDoc=parser.parseFromString(e,"text/xml")):((xmlDoc=new ActiveXObject("Microsoft.XMLDOM")).async=!1,xmlDoc.loadXML(e)),parseAttributes(xmlDoc),parseNodes(xmlDoc),parseEdges(xmlDoc),"chimera"===o?(sgv.graf=Chimera.createNewGraph(r),sgv.graf.createStructureFromDef2(d),!0):("pegasus"===o&&Pegasus.createNewGraph(r),!1)},function(e,t){return e+Math.random()*(t-e)}),sgv="undefined"==typeof exports?function(){}:exports;"undefined"!=typeof global&&(global.sgv=sgv),sgv.version="0.1.0",sgv.engine=null,sgv.scene=null,sgv.camera=null,sgv.graf=null,sgv.displayMode="classic",sgv.labelsVisible=!1,sgv.createCamera=function(){sgv.camera=new BABYLON.ArcRotateCamera("Camera",0,0,10,new BABYLON.Vector3(0,0,0),sgv.scene),sgv.camera.setPosition(new BABYLON.Vector3(166,150,0)),sgv.camera.attachControl(sgv.canvas,!0),sgv.camera.inputs.attached.pointers.panningSensibility=25,sgv.camera.upperBetaLimit=Math.PI/2*.99,sgv.camera.inertia=.5},sgv.createLights=function(){var e=new BABYLON.SpotLight("Spot0",new BABYLON.Vector3(0,0,0),new BABYLON.Vector3(0,0,1),1.8,.01,sgv.scene);e.intensity=.75,e.parent=sgv.camera,e.position=new BABYLON.Vector3(0,0,0)},sgv.createMaterials=function(){sgv.grayMat0=new BABYLON.StandardMaterial("grayMat0",sgv.scene),sgv.grayMat0.diffuseColor=new BABYLON.Color3(.4,.4,.4),sgv.grayMat0.specularColor=new BABYLON.Color3(.3,.3,.3),sgv.grayMat0.emissiveColor=new BABYLON.Color3(.5,.5,.5),sgv.grayMat1=new BABYLON.StandardMaterial("grayMat1",sgv.scene),sgv.grayMat1.diffuseColor=new BABYLON.Color3(.4,.4,.4),sgv.grayMat1.specularColor=new BABYLON.Color3(.4,.4,.4),sgv.grayMat1.emissiveColor=new BABYLON.Color3(0,0,0),sgv.redMat=new BABYLON.StandardMaterial("redMat",sgv.scene),sgv.redMat.diffuseColor=new BABYLON.Color3(.4,.4,.4),sgv.redMat.specularColor=new BABYLON.Color3(.4,.4,.4),sgv.redMat.emissiveColor=BABYLON.Color3.Red(),sgv.greenMat=new BABYLON.StandardMaterial("greenMat",sgv.scene),sgv.greenMat.diffuseColor=new BABYLON.Color3(.4,.4,.4),sgv.greenMat.specularColor=new BABYLON.Color3(.4,.4,.4),sgv.greenMat.emissiveColor=new BABYLON.Color3(0,.3,0),sgv.blueMat=new BABYLON.StandardMaterial("blueMat",sgv.scene),sgv.blueMat.diffuseColor=new BABYLON.Color3(.4,.4,.4),sgv.blueMat.specularColor=new BABYLON.Color3(.4,.4,.4),sgv.blueMat.emissiveColor=BABYLON.Color3.Blue(),sgv.purpleMat=new BABYLON.StandardMaterial("purpleMat",sgv.scene),sgv.purpleMat.diffuseColor=new BABYLON.Color3(.4,.4,.4),sgv.purpleMat.specularColor=new BABYLON.Color3(.4,.4,.4),sgv.purpleMat.emissiveColor=BABYLON.Color3.Purple(),sgv.groundMaterial=new BABYLON.StandardMaterial("ground",sgv.scene),sgv.groundMaterial.specularColor=BABYLON.Color3.Black()},sgv.createDefaultObjects=()=>{sgv.createMaterials(),sgv.defaultSphere=BABYLON.MeshBuilder.CreateSphere("defaultSphere",{diameter:3,segments:8,updatable:!0},sgv.scene),sgv.defaultSphere.material=new BABYLON.StandardMaterial("mat",sgv.scene),sgv.defaultSphere.material.diffuseColor=new BABYLON.Color3(.4,.4,.4),sgv.defaultSphere.material.specularColor=new BABYLON.Color3(.4,.4,.4),sgv.defaultSphere.material.emissiveColor=new BABYLON.Color4(.2,.2,.2),sgv.defaultSphere.setEnabled(!1)},sgv.createScene=function(){sgv.scene=new BABYLON.Scene(sgv.engine),sgv.createCamera(),sgv.createLights(),sgv.createDefaultObjects(),sgv.advancedTexture=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),sgv.nodeToConnect=0,sgv.addEventsListeners(),sgv.scene.clearColor=new BABYLON.Color3(.7,.7,.7)},sgv.switchDisplayMode=function(){"classic"===sgv.displayMode?sgv.displayMode="triangle":"triangle"===sgv.displayMode?sgv.displayMode="diamond":sgv.displayMode="classic",null!==sgv.graf&&sgv.graf.changeDisplayMode()},sgv.addEventsListeners=function(){var o,r,a=null;function l(){var e=sgv.scene.pick(sgv.scene.pointerX,sgv.scene.pointerY,function(e){return e===a});return e.hit?e.pickedPoint:null}function d(e){function t(e){var t,s,n;console.log("LEFT"),0!==sgv.nodeToConnect?(e.pickInfo.hit&&"node"===(t=e.pickInfo.pickedMesh.name.split(":"))[0]&&(n=sgv.nodeToConnect+","+parseInt(t[1],10),s=parseInt(t[1],10)+","+sgv.nodeToConnect,n in sgv.graf.edges||s in sgv.graf.edges?console.log("edge already exists"):sgv.graf.addEdge(sgv.nodeToConnect,parseInt(t[1],10),.5)),sgv.nodeToConnect=0):e.pickInfo.hit?(n=e.pickInfo.pickedMesh,console.log("mesh picked: "+n.name),"edge"===(n=n.name.split(":"))[0]?sgv.pokazOkienkoE(n[1],sgv.scene.pointerX,sgv.scene.pointerY):"node"===n[0]?sgv.pokazOkienkoN(parseInt(n[1],10),sgv.scene.pointerX,sgv.scene.pointerY):(sgv.cancelE(),sgv.cancelN())):(sgv.cancelE(),sgv.cancelN())}switch(e.event.button){case 0:t(e);break;case 1:s=e,console.log("MIDDLE"),s.pickInfo.hit&&"node"===(s=s.pickInfo.pickedMesh.name.split(":"))[0]&&(0===sgv.nodeToConnect?sgv.nodeToConnect=parseInt(s[1],10):(n=sgv.nodeToConnect+","+parseInt(s[1],10),i=parseInt(s[1],10)+","+sgv.nodeToConnect,n in sgv.graf.edges||i in sgv.graf.edges?console.log("edge already exists"):sgv.graf.addEdge(sgv.nodeToConnect,parseInt(s[1],10),.5),sgv.nodeToConnect=0));break;case 2:console.log("RIGHT")}var s,n,i}sgv.scene.onPointerObservable.add(function(e){switch(e.type){case BABYLON.PointerEventTypes.POINTERTAP:d(e);break;case BABYLON.PointerEventTypes.POINTERDOUBLETAP:e.pickInfo.hit&&e.pickInfo.pickedMesh!==a&&"edge"===(i=(i=e.pickInfo.pickedMesh).name.split(":"))[0]&&sgv.graf.edgeDoubleClicked(i[1]);break;case BABYLON.PointerEventTypes.POINTERDOWN:e.pickInfo.hit&&e.pickInfo.pickedMesh!==a&&(i=e,console.log("POINTER.DOWN"),r=i.pickInfo.pickedMesh,(o=l())&&setTimeout(function(){sgv.camera.detachControl(sgv.canvas)},0)),null!==sgv.graf&&sgv.graf.showLabels(!1);break;case BABYLON.PointerEventTypes.POINTERUP:null!==sgv.graf&&sgv.graf.showLabels(!0),o&&(sgv.camera.attachControl(sgv.canvas,!0),o=null);break;case BABYLON.PointerEventTypes.POINTERMOVE:null!==sgv.graf&&o&&(t=l())&&(s=t.subtract(o),"node"===(n=r.name.split(":"))[0]&&(sgv.graf.moveNode(parseInt(n[1],10),s),o=t))}var t,s,n,i})},sgv.connectSelectN=function(){sgv.nodeToConnect=parseInt(sgv.ui.nodeProperties.querySelector("#nodeId").value,10),sgv.ui.nodeProperties.style.display="none"},sgv.connectNodes=function(){var e=sgv.ui.nodeProperties.querySelector("#nodeId").value,t=sgv.ui.nodeProperties.querySelector("#destN").value;null!==sgv.graf&&sgv.graf.addEdge(e,t)},sgv.addToMissing=function(e){let t=sgv.ui.missingNodes.querySelector("#misN"),s=UI.newInput("button"," q"+e+" ","","rest"+e);s.addEventListener("click",function(){sgv.restoreNode(e)}),t.appendChild(s),this.ui.missingNodes.style.display="block"},sgv.restoreNode=function(e){sgv.graf.restoreNode(e);e=sgv.ui.missingNodes.querySelector("#rest"+e);e.parentNode.removeChild(e)},sgv.delMissing=function(){sgv.ui.missingNodes.querySelector("#misN").innerHTML="",null!==sgv.graf&&(sgv.graf.missing={}),this.ui.missingNodes.style.display="none"},sgv.pokazOkienkoE=function(e,t,s){var n=this.canvas.clientLeft,e=(sgv.ui.edgeProperties.querySelector(".titleText").innerHTML="Edge q"+sgv.graf.edges[e].begin+" &lt;---&gt; q"+sgv.graf.edges[e].end,sgv.ui.edgeProperties.querySelector("#edgeId").value=e,sgv.graf.edgeValue(e));null===e?(sgv.ui.edgeProperties.querySelector("#valueCheckE").checked="",sgv.ui.edgeProperties.querySelector("#wagaE").value=null,sgv.ui.edgeProperties.querySelector("#wagaE").disabled="disabled",sgv.ui.edgeProperties.querySelector("#setE").disabled="disabled"):(sgv.ui.edgeProperties.querySelector("#valueCheckE").checked="checked",sgv.ui.edgeProperties.querySelector("#wagaE").value=e,sgv.ui.edgeProperties.querySelector("#wagaE").disabled="",sgv.ui.edgeProperties.querySelector("#setE").disabled=""),sgv.ui.edgeProperties.style.top=s+"px",sgv.ui.edgeProperties.style.left=n+t+"px",sgv.ui.edgeProperties.style.display="block"},sgv.pokazOkienkoN=function(e,t,s){var n=this.canvas.clientLeft;sgv.ui.nodeProperties.querySelector(".titleText").textContent="Node q"+e,sgv.ui.nodeProperties.querySelector("#nodeId").value=e;let i=sgv.ui.nodeProperties.querySelector("#nsSelectN");for(let e=i.options.length-1;0<=e;e--)i.options[e]=null;for(const l in sgv.graf.scopeOfValues)(o=document.createElement("option")).value=l,o.innerHTML=sgv.graf.scopeOfValues[l],sgv.graf.currentScope===sgv.graf.scopeOfValues[l]&&(o.selected="selected"),i.appendChild(o);var o,r=sgv.graf.nodeValue(e);null===r||isNaN(r)?(sgv.ui.nodeProperties.querySelector("#valueCheckN").checked="",sgv.ui.nodeProperties.querySelector("#wagaN").value=null,sgv.ui.nodeProperties.querySelector("#wagaN").disabled="disabled",sgv.ui.nodeProperties.querySelector("#setN").disabled="disabled"):(sgv.ui.nodeProperties.querySelector("#valueCheckN").checked="checked",sgv.ui.nodeProperties.querySelector("#wagaN").value=r,sgv.ui.nodeProperties.querySelector("#wagaN").disabled="",sgv.ui.nodeProperties.querySelector("#setN").disabled="");let a=sgv.ui.nodeProperties.querySelector("#destN");for(let e=a.options.length-1;0<=e;e--)a.options[e]=null;for(const d in sgv.graf.nodes)d.toString()!==e.toString()&&((o=document.createElement("option")).value=d,o.innerHTML="q"+d,a.appendChild(o));sgv.ui.nodeProperties.style.top=s+"px",sgv.ui.nodeProperties.style.left=n+t+"px",sgv.ui.nodeProperties.style.display="block"},sgv.usunE=function(){sgv.graf.delEdge(sgv.ui.edgeProperties.querySelector("#edgeId").value),sgv.ui.edgeProperties.style.display="none"},sgv.usunN=function(){sgv.graf.delNode(sgv.ui.nodeProperties.querySelector("#nodeId").value),sgv.ui.nodeProperties.style.display="none"},sgv.cancelE=function(){sgv.ui.edgeProperties.style.display="none"},sgv.cancelN=function(){sgv.ui.nodeProperties.style.display="none"},sgv.changeScopeN=function(){console.log("changeScopeN: "+event.target.value);var e=sgv.ui.nodeProperties.querySelector("#nodeId").value,e=sgv.graf.nodeValue(e,sgv.graf.scopeOfValues[event.target.value]);null===e||isNaN(e)?(console.log("NULL"),sgv.ui.nodeProperties.querySelector("#valueCheckN").checked="",sgv.ui.nodeProperties.querySelector("#wagaN").value=null,sgv.ui.nodeProperties.querySelector("#wagaN").disabled="disabled",sgv.ui.nodeProperties.querySelector("#setN").disabled="disabled"):(console.log("NOT NULL"),sgv.ui.nodeProperties.querySelector("#valueCheckN").checked="checked",sgv.ui.nodeProperties.querySelector("#wagaN").value=e,sgv.ui.nodeProperties.querySelector("#wagaN").disabled="",sgv.ui.nodeProperties.querySelector("#setN").disabled="")},sgv.edycjaE=function(){var e=sgv.ui.edgeProperties.querySelector("#edgeId").value,t=parseFloat(sgv.ui.edgeProperties.querySelector("#wagaE").value.replace(/,/g,"."));sgv.graf.setEdgeValue(e,t),sgv.ui.edgeProperties.style.display="none"},sgv.edycjaN=function(){var e=sgv.ui.nodeProperties.querySelector("#nodeId").value,t=parseFloat(sgv.ui.nodeProperties.querySelector("#wagaN").value.replace(/,/g,".")),s=sgv.graf.scopeOfValues[sgv.ui.nodeProperties.querySelector("#nsSelectN").value];sgv.graf.setNodeValue(e,t,s),sgv.ui.nodeProperties.style.display="none"},sgv.activateN=function(){var t=sgv.graf.scopeOfValues[sgv.ui.nodeProperties.querySelector("#nsSelectN").value];if(sgv.ui.nodeProperties.querySelector("#valueCheckN").checked){sgv.ui.nodeProperties.querySelector("#wagaN").disabled="",sgv.ui.nodeProperties.querySelector("#setN").disabled="";let e=parseFloat(sgv.ui.nodeProperties.querySelector("#wagaN").value.replace(/,/g,"."));""===e&&(e=0,sgv.ui.nodeProperties.querySelector("#wagaN").value=e),sgv.graf.setNodeValue(sgv.ui.nodeProperties.querySelector("#nodeId").value,e,t)}else sgv.ui.nodeProperties.querySelector("#wagaN").disabled="disabled",sgv.ui.nodeProperties.querySelector("#setN").disabled="disabled",sgv.graf.delNodeValue(sgv.ui.nodeProperties.querySelector("#nodeId").value,t)},sgv.activateE=function(){if(sgv.ui.edgeProperties.querySelector("#valueCheckE").checked){sgv.ui.edgeProperties.querySelector("#wagaE").disabled="",sgv.ui.edgeProperties.querySelector("#setE").disabled="";let e=parseFloat(sgv.ui.edgeProperties.querySelector("#wagaE").value.replace(/,/g,"."));""===e&&(e=0,sgv.ui.edgeProperties.querySelector("#wagaE").value=e),sgv.graf.setEdgeValue(sgv.ui.edgeProperties.querySelector("#edgeId").value,e)}else sgv.ui.edgeProperties.querySelector("#wagaE").disabled="disabled",sgv.ui.edgeProperties.querySelector("#setE").disabled="disabled",sgv.graf.delEdgeValue(sgv.ui.edgeProperties.querySelector("#edgeId").value)},sgv.stringToScope=(e,t)=>{e=sgv.graf.loadScopeValues(t,e);e.n&&sgv.controlPanel.ui().querySelector("#cplDispValues").add(UI.option(t,t)),sgv.controlPanel.ui().querySelector("#cplDispValues").selectedIndex=e.i},sgv.toGEXF=function(){var t=sgv.graf.exportGEXF();{var s="graphDefinition.gexf",n="text/xml";let e=document.createElement("a");return t=new Blob([t],{type:n}),e.href=URL.createObjectURL(t),e.download=s,void e.click()}},sgv.toTXT=function(){var t=sgv.graf.exportTXT();{var s="graphDefinition.txt",n="text/plain";let e=document.createElement("a");return t=new Blob([t],{type:n}),e.href=URL.createObjectURL(t),e.download=s,void e.click()}},sgv.fromTXT=function(e){for(var t,s,n=[],i=e.split("\n"),o=sgv.controlPanel.getGraphTypeAndSize();0<i.length;)"#"!==i[0][0]?null!==(t=function(e){e=e.split(" ");return 3===e.length?{n1:parseInt(e[0],10),n2:parseInt(e[1],10),val:parseFloat(e[2],10)}:null}(i[0]))&&n.push(t):(t=i[0].split(" "),"type"===(s=(s=t[1]).split("="))[0]?o.type=s[1]:"size"===s[0]&&(s=s[1].split(","),o.size={cols:parseInt(s[0],10),rows:parseInt(s[1],10),KL:parseInt(s[2],10),KR:parseInt(s[3],10)})),i.shift();switch(o.type){case"chimera":sgv.graf=Chimera.createNewGraph(o.size);break;case"pegasus":sgv.graf=Pegasus.createNewGraph(o.size)}sgv.graf.createStructureFromDef(n)},sgv.display=function(e){void 0!==e&&"object"==typeof e||(e={}),sgv.ui=new UI;let t=null;function s(){return new BABYLON.Engine(sgv.canvas,!0,{doNotHandleContextLost:!0,preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!1})}null===(t="target"in e?document.getElementById(e.target):t)&&((t=document.createElement("div")).setAttribute("id","sgvWorkspaceArea"),document.body.appendChild(t)),sgv.canvas=document.createElement("canvas"),sgv.canvas.setAttribute("id","sgvRenderCanvas"),t.appendChild(sgv.canvas),sgv.console.initConsole("sgvConsole"),sgv.controlPanel.init("sgvControlPanel"),sgv.advancedTexture=null,sgv.sceneToRender=null,window.initFunction=async function(){if(sgv.engine=await async function(){try{return s()}catch(e){return console.log("the available createEngine function failed. Creating the default engine instead"),s()}}(),!sgv.engine)throw"engine should not be null.";sgv.engine.enableOfflineSupport=!1,sgv.createScene()},initFunction().then(function(){sgv.sceneToRender=sgv.scene,sgv.engine.runRenderLoop(function(){sgv.sceneToRender&&sgv.sceneToRender.activeCamera&&sgv.sceneToRender.render()})}),window.addEventListener("resize",function(){sgv.engine.resize()})},sgv.controlPanel=new function(){var s=null;return{init:function(e){(s=UI.createControlPanel(e)).querySelector("#cplElectronTestButton").addEventListener("click",function(){var e=sgv.graf.exportTXT();electronTestButtonClicked(e)}),s.querySelector("#cplCreateButton").addEventListener("click",function(){sgv.controlPanel.createGraph()}),s.querySelector("#cplDeleteButton").addEventListener("click",function(){sgv.controlPanel.removeGraph()}),s.querySelector("#cplDispValues").addEventListener("change",function(){sgv.graf.displayValues(this.value)}),s.querySelector("#cplSkipAddScope").addEventListener("click",function(){s.querySelector("#cplDivNS").style.display="none",s.querySelector("#cplDivDS").style.display="block"}),s.querySelector("#cplAcceptAddScope").addEventListener("click",function(){var e=s.querySelector("#cplAddScopeInput").value,t=sgv.graf.addScopeOfValues(e);0<=t&&(s.querySelector("#cplDispValues").add(UI.option(e,e)),s.querySelector("#cplDispValues").selectedIndex=t,sgv.graf.displayValues(e)),s.querySelector("#cplDivNS").style.display="none",s.querySelector("#cplDivDS").style.display="inline"}),s.querySelector("#cplAddScope").addEventListener("click",function(){s.querySelector("#cplDivNS").style.display="inline",s.querySelector("#cplDivDS").style.display="none"}),s.querySelector("#cplDelScope").addEventListener("click",function(){const e=s.querySelector("#cplDispValues");var t=sgv.graf.delScopeOfValues(e.value);0<=t&&(e.remove(e.selectedIndex),e.selectedIndex=t)}),s.querySelector("#cplSaveButton").addEventListener("click",function(){sgv.toTXT()}),s.querySelector("#cplSaveGEXFButton").addEventListener("click",function(){sgv.toGEXF()}),s.querySelector("#inputfile").addEventListener("change",function(){sgv.controlPanel.loadGraph(this.files[0])})},show:function(e){s.style.display=isUndefined(e)||0!==e?"block":"none"},hide:function(e){s.style.display=isUndefined(e)||0!==e?"none":"block"},ui:function(){return s},switchPanel:function(){s.style.display="none"===s.style.display?"block":"none"},setModeSelection:function(){document.getElementById("graphSelection").style.display="block",document.getElementById("graphDescription").style.display="none"},setModeDescription:function(){document.getElementById("graphSelection").style.display="none",document.getElementById("graphDescription").style.display="block",this.updateDescription()},updateDescription:function(){document.getElementById("dscr_type").textContent=sgv.graf.type,document.getElementById("dscr_cols").textContent=sgv.graf.cols,document.getElementById("dscr_rows").textContent=sgv.graf.rows,document.getElementById("dscr_KL").textContent=sgv.graf.KL,document.getElementById("dscr_KR").textContent=sgv.graf.KR,document.getElementById("dscr_nbNodes").textContent=Object.keys(sgv.graf.nodes).length,document.getElementById("dscr_nbEdges").textContent=Object.keys(sgv.graf.edges).length},getGraphTypeAndSize(){return{type:document.getElementById("graphType").value,size:{cols:parseInt(document.getElementById("graphCols").value,10),rows:parseInt(document.getElementById("graphRows").value,10),KL:parseInt(document.getElementById("graphKL").value,10),KR:parseInt(document.getElementById("graphKR").value,10)}}},createGraph:function(){showSplash(),null!==sgv.graf&&this.removeGraph();var e=this.getGraphTypeAndSize();switch(e.type){case"chimera":sgv.graf=Chimera.createNewGraph(e.size),sgv.graf.createDefaultStructure(),this.setModeDescription();break;case"pegasus":sgv.graf=Pegasus.createNewGraph(e.size),sgv.graf.createDefaultStructure(),this.setModeDescription()}hideSplash()},removeGraph:function(){null!==sgv.graf&&(sgv.graf.dispose(),sgv.graf=null),sgv.delMissing(),this.setModeSelection()},loadGraph:function(e){const t=e.name,s=new FileReader;e&&(s.addEventListener("error",()=>{console.error("Error occurred reading file: "+e.name)}),s.addEventListener("load",()=>{console.info(`File: ${e.name} read successfully`),t.endsWith("txt")?(null!==sgv.graf&&this.removeGraph(),sgv.fromTXT(s.result),console.log(sgv.graf),sgv.controlPanel.setModeDescription()):t.endsWith("gexf")?parseGEXF(s.result)&&sgv.controlPanel.setModeDescription():console.error("Incorrect file format...")}),t.endsWith("txt")||t.endsWith("gexf")?s.readAsText(e):console.error("Incorrect file extension..."))},loadGraph2:function(e,t){e.endsWith("txt")?(null!==sgv.graf&&this.removeGraph(),sgv.fromTXT(t),sgv.controlPanel.setModeDescription()):e.endsWith("gexf")&&(null!==sgv.graf&&this.removeGraph(),parseGEXF(t)&&sgv.controlPanel.setModeDescription())}}},sgv.console=new function(){var i,o=[],r=-1,a=!1;let l;function d(e){function t(t){if(null===sgv.graf)return"no graph defined";let e=t.split("=");if(console.log(e),e.length<2)return"too few arguments";var t=parseFloat(e[1].replace(/,/g,".")),s=e[0].split("+");if(1===s.length){var n=s,i=t;if("q"!==n[0][0])return;{let t=parseInt(n[0].slice(1),10);if(isNaN(t)||0===t||t>sgv.graf.maxNodeId())return"bad node Id";if(isNaN(i))return t in sgv.graf.nodes?(sgv.graf.delNode(t.toString()),"deleted node q"+t):"node q"+t+" already deleted";if(t in sgv.graf.nodes)return sgv.graf.setNodeValue(t,i),"modified node q"+t+" = "+i;if(t in sgv.graf.missing){sgv.graf.restoreNode(t);let e=document.getElementById("rest"+t);return e.parentNode.removeChild(e),sgv.graf.setNodeValue(t,i),"restored and modified node q"+t+" = "+i}return sgv.graf.addNode(t,i),"added node q"+t+" = "+i}}if(2!==s.length)return"bad arguments";n=s,i=t;if("q"===n[0][0]&&"q"===n[1][0]){s=parseInt(n[0].slice(1),10),t=parseInt(n[1].slice(1),10);if(isNaN(s)||0===s)return"bad node Id: "+n[0];if(isNaN(t)||0===t)return"bad node Id: "+n[1];let e=t<s?t+","+s:s+","+t;return isNaN(i)?e in sgv.graf.edges?(sgv.graf.delEdge(e),"deleted edge "+e):"edge "+e+" not exists":e in sgv.graf.edges?(sgv.graf.setEdgeValue(e,i),"modified edge "+e):s in sgv.graf.nodes&&t in sgv.graf.nodes?(sgv.graf.addEdge(s,t,i),"added edge "+e):"NOT DONE: both connected nodes must exist in the graph"}}function s(e){switch(e){case"set":return"Set or remove value of node or edge\n\nset [nodeId](=value)\nset [nodeId]+[nodeId](=value)";case"create":return"Create new default graph\n\ncreate [chimera|pegasus] [4|8|12|16],[4|8|12|16],[1..4],[1..4]";case"clear":return"Remove current graph if exists\n\nclear";case"display":return"Switch between sets of displayed values\n\ndisplay [valueId]";case"displaymode":return"Set style of graph display.\n\ndisplaymode [classic|triangle|diamond]";default:return"For more information on a specific command, type: help command-name\n\nset\t\tSet or remove value of node or edge\ncreate\t\tCreate new default graph\nclear\t\tRemove current graph if exists\ndisplay\t\tSwitch between sets of displayed values\ndisplaymode\tSet style of graph display"}}var n,i=(e=e.trim().toLowerCase().replace(/\s+/g," ")).split(" "),o=e.indexOf(" "),r=e.substring(o+1).replace(/\s+/g,""),a="";switch(i[0].trim()){case"help":case"?":a=s(i[1]);break;case"limits":a=function(e){if(null===sgv.graf)return"no graph defined";let t="";if(1===e.length)return t="Current display limits [red, green] are set to ["+sgv.graf.redLimit+", "+sgv.graf.greenLimit+"]\n",s=sgv.graf.getMinMaxNodeVal(),t+="\nnode values range in current scope is: ["+s.min+", "+s.max+"] "+s.com,s=sgv.graf.getMinMaxEdgeVal(),t+="\nedge weights range in current scope is: ["+s.min+", "+s.max+"] "+s.com;if("set"!==e[1])return"bad arguments";if(e.length<4)return"too few arguments\nUse: limits set <min> <max>";var s=parseFloat(e[2].replace(/,/g,".")),e=parseFloat(e[3].replace(/,/g,"."));return isNaN(s)||isNaN(e)?"Bad arguments: <min> and <max> should be numbers.":0<s||e<0||s===e?"Bad arguments: <min> cannot be greater than zero, <max> cannot be less than zero and both values cannot be zero at the same time.":(sgv.graf.redLimit=s,sgv.graf.greenLimit=e,t="Display limits [red, green] are set to ["+sgv.graf.redLimit+", "+sgv.graf.greenLimit+"]",sgv.graf.displayValues(sgv.graf.currentScope),t)}(i);break;case"create":a=function(e,t){if(null!==sgv.graf)return"graf exists, type: clear <Enter> to delete it";switch(t=t.split(","),size={cols:parseInt(t[0],10),rows:parseInt(t[1],10),KL:parseInt(t[2],10),KR:parseInt(t[3],10)},e){case"chimera":sgv.graf=Chimera.createNewGraph(size),sgv.graf.createDefaultStructure();break;case"pegasus":sgv.graf=Pegasus.createNewGraph(size),sgv.graf.createDefaultStructure();break;default:return"unknown graph type"}return sgv.controlPanel.setModeDescription(),"graph created"}(i[1],i[2]);break;case"clear":sgv.controlPanel.removeGraph(),a="graph removed";break;case"set":a=t(r);break;case"scope":a=function(e,t){if(null===sgv.graf)return"no graph defined";switch(e){case"list":return sgv.graf.scopeOfValues.toString();case"add":var s=sgv.graf.addScopeOfValues(t);return 0<=s&&(sgv.controlPanel.ui().querySelector("#cplDispValues").add(UI.option(t,t)),sgv.controlPanel.ui().querySelector("#cplDispValues").selectedIndex=s,sgv.graf.displayValues(t)),"Added scope "+t;case"delete":const i=sgv.controlPanel.ui().querySelector("#cplDispValues");s=sgv.graf.delScopeOfValues(t);return 0<=s?(-1<(n=UI.findOption(i,t))&&i.remove(n),i.selectedIndex=s,"Deleted scope "+t+", current scope: "+sgv.graf.currentScope):"Scope "+t+" could not to be deleted... Current scope: "+sgv.graf.currentScope;case"set":if(sgv.graf.hasScope(t)){if(sgv.graf.displayValues(t)){const o=sgv.controlPanel.ui().querySelector("#cplDispValues");var n=UI.findOption(o,t);-1<n&&(o.selectedIndex=n)}return"Current scope: "+sgv.graf.currentScope}return"Bad scope name: "+t+"... Current scope: "+sgv.graf.currentScope;default:return"Current scope: "+sgv.graf.currentScope}}(i[1],i[2]);break;case"display":n=i[1],a="displayed value: "+sgv.graf.displayValues(n);break;case"displaymode":a="classic"===i[1]||"diamond"===i[1]||"triangle"===i[1]?(sgv.displayMode=i[1],sgv.graf.changeDisplayMode(),"current displayMode = "+i[1]):"unknown mode\n\n"+s("displaymode");break;default:a="unknown command\n\n"+s()}return a}return{switchConsole:function(){"block"!==l.style.display?l.style.display="block":l.style.display="none"},showConsole:function(){l.style.display="block"},hideConsole:function(){l.style.display="none"},initConsole:function(e){let t=(l=UI.createConsole(e)).querySelector("#commandline"),s=(t.addEventListener("keydown",function(e){if("Enter"===e.key){let e=document.getElementById("consoleHistory");e.textContent+="> "+t.value+"\n",e.textContent+=d(t.value)+"\n",e.scrollTop=e.scrollHeight,10<o.length&&o.shift(),o.push(t.value),r=o.length,t.value=""}else 38===e.keyCode?0<r&&(r--,t.value=o[r]):40===e.keyCode&&(r<o.length?(t.value=o[r],r++):t.value="")}),l.querySelector(".hidebutton").addEventListener("click",function(){sgv.console.hideConsole()}),l.querySelector(".title"));var n;s.addEventListener("mouseover",function(){l.querySelector(".title").style.cursor="pointer",a=!0}),s.addEventListener("mouseout",function(){a=!1}),s.addEventListener("mousedown",function(e){i=a,n={x:l.offsetLeft-e.clientX,y:l.offsetTop-e.clientY}},!0),s.addEventListener("mouseup",function(){i=!1},!0),document.addEventListener("mousemove",function(s){if(s.preventDefault(),i){let e=s.clientX,t=s.clientY;l.style.left=e+n.x+"px",l.style.top=t+n.y+"px"}},!0)}}};