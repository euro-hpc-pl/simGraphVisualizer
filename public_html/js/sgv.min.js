var Cookie={set:(e,t,n)=>{const i={path:"/",...n};if(navigator.cookieEnabled){let n=encodeURIComponent(e)+"="+encodeURIComponent(t);if(i.days&&"number"==typeof i.days){const e=new Date;e.setTime(e.getTime()+24*i.days*60*60*1e3),n+="; expires="+e.toUTCString()}i.path&&(n+="; path="+i.path),i.domain&&(n+="; domain="+i.domain),i.secure&&(n+="; secure"),window.document.cookie=n}},get:e=>{if(""!==window.document.cookie){const t=window.document.cookie.split(/; */);for(let n of t){const[t,i]=n.split("=");if(t===decodeURIComponent(e))return decodeURIComponent(i)}}},delete:(e,t)=>{const n={path:"/",...t};let i=encodeURIComponent(e)+"=";n.path&&(i+="; path="+n.path),i+="; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie=i}},Settings={};void 0===window.api?(Settings.get=e=>Cookie.get(e),Settings.set=e=>{for(let t in e)Cookie.set(t,e[t])}):(console.log("Settings in desktopApp!"),Settings.get=e=>window.api.invoke("getSetting",e),Settings.set=e=>{window.api.invoke("setSettings",e)});const DEMO_MODE=!1;function getRandom(e,t){return e+Math.random()*(t-e)}function valueToColor(e){if(null==e||isNaN(e))return new BABYLON.Color3(.9,.9,.9);let t=sgv.graf.greenLimit,n=sgv.graf.redLimit;if(e>0)var i=0,s=1-(a=e<t?e/t:1);else if(e<0){var a=0;s=1-(i=e>n?e/n:1)}else i=0,a=0,s=1;return new BABYLON.Color3(i,a,s)}function valueToColorBAK(e){if(null==e||isNaN(e))return new BABYLON.Color3(.9,.9,.9);let t=sgv.graf.greenLimit,n=sgv.graf.redLimit;if(e>0)var i=0,s=e<t?e/t:1,a=0;else if(e<0)i=e>n?e/n:1,s=0,a=0;else i=0,s=0,a=0;return new BABYLON.Color3(i,s,a)}function valueToEdgeWidth(e){if(null==e||isNaN(e))return.2;let t=Math.abs(sgv.graf.greenLimit),n=Math.abs(sgv.graf.redLimit);return t=t>n?t:n,0===e||0===t?.2:(e=Math.abs(e))>t?1.2:.2+e/t}var isMobile=!1;function detectClient(){let e=navigator.userAgent.toLowerCase();isMobile=e.indexOf("android")>-1||e.indexOf("blackberry")>-1||e.indexOf("iemobile")>-1||e.indexOf("opera mini")>-1||e.indexOf("iphone")>-1||e.indexOf("ipod")>-1||e.indexOf("ipad")>-1}detectClient(),window.addEventListener("load",(()=>{var e=document.querySelector(":root"),t=this.document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),isMobile?(t.setAttribute("href","css/mobile.css"),e.style.setProperty("--isMobile",1),e.style.setProperty("@mobile",1)):(t.setAttribute("href","css/desktop.css"),e.style.setProperty("--isMobile",0)),document.head.appendChild(t)}));const SVG={NS:"http://www.w3.org/2000/svg",createSVG:(e,t,n,i)=>{let s=document.createElementNS(SVG.NS,"svg");return s.setAttributeNS(null,"id",e),s.setAttributeNS(null,"height",n),s.setAttributeNS(null,"width",t),"function"==typeof i&&s.addEventListener("click",i),s.style.display="block",s},createSVG2:(e,t,n,i)=>{let s=document.createElementNS(SVG.NS,"svg");return s.setAttributeNS(null,"id",e),s.setAttributeNS(null,"viewBox","0 0 "+t+" "+n),"function"==typeof i&&s.addEventListener("click",i),s.style.display="block",s},drawSvgText:(e,t,n,i,s,a,l,o)=>{var r=document.createElementNS(SVG.NS,"text");if(r.setAttributeNS(null,"id","text_"+t),r.setAttributeNS(null,"x",n),r.setAttributeNS(null,"y",i),r.setAttributeNS(null,"text-anchor","middle"),r.setAttributeNS(null,"alignment-baseline","middle"),r.setAttributeNS(null,"font-size","12px"),r.setAttributeNS(null,"font-family","Arial, Helvetica, sans-serif"),r.setAttributeNS(null,"fill",a),r.textContent=s,e.appendChild(r),r.addEventListener("click",o),""!==l){let s=24,a=12;var d=document.createElementNS(SVG.NS,"rect");d.setAttributeNS(null,"id","textBG_"+t),d.setAttributeNS(null,"x",n-s/2),d.setAttributeNS(null,"y",i-(1+a/2)),d.setAttributeNS(null,"width",s),d.setAttributeNS(null,"height",a),d.setAttributeNS(null,"fill",l),e.insertBefore(d,r),d.addEventListener("click",o)}},drawSvgNode:(e,t,n,i,s,a,l)=>{var o=document.createElementNS(SVG.NS,"circle");o.setAttributeNS(null,"id","node_"+t),o.setAttributeNS(null,"cx",n),o.setAttributeNS(null,"cy",i),o.setAttributeNS(null,"r",s),o.setAttributeNS(null,"fill",a),o.setAttributeNS(null,"stroke","black"),o.setAttributeNS(null,"stroke-width","1"),e.appendChild(o),o.addEventListener("click",l)},drawSvgEdge:(e,t,n,i,s,a,l,o,r)=>{var d=document.createElementNS(SVG.NS,"line");d.setAttributeNS(null,"id","edge_"+t),d.setAttributeNS(null,"x1",n),d.setAttributeNS(null,"y1",i),d.setAttributeNS(null,"x2",s),d.setAttributeNS(null,"y2",a),d.setAttributeNS(null,"stroke",l),d.setAttributeNS(null,"stroke-width",o),e.appendChild(d),d.addEventListener("click",r)}};var Dispatcher={graphDeleted:()=>{sgv.SPS.reset(),sgv.SPS.refresh(),sgv.dlgMissingNodes.delAll(),sgv.dlgCPL.setModeSelection(),sgv.dlgCellView.hide(),enableMenu("menuGraphSave",!1),enableMenu("menuGraphClear",!1),enableMenu("menuViewDisplayMode",!1),enableMenu("menuViewCellView",!1)},graphCreated:()=>{sgv.dlgCellView.hide(),sgv.dlgCPL.setModeDescription(),sgv.graf.displayValues(),hideSplash(),enableMenu("menuGraphSave",!0),enableMenu("menuGraphClear",!0),enableMenu("menuViewDisplayMode",!0),enableMenu("menuViewCellView",!0)},graphChanged:()=>{sgv.dlgCPL.refresh(),sgv.dlgCellView.refresh(),sgv.dlgNodeProperties.refresh(),sgv.dlgEdgeProperties.refresh(),sgv.SPS.refresh()},currentScopeChanged:()=>{sgv.dlgCPL.refresh(),sgv.dlgCellView.refresh(),sgv.dlgNodeProperties.refresh(),sgv.dlgEdgeProperties.refresh(),sgv.SPS.refresh()},viewModeChanged:()=>{sgv.dlgCellView.refresh(),sgv.dlgNodeProperties.refresh(),sgv.dlgEdgeProperties.refresh(),sgv.SPS.refresh()}};const SolidPS=function(e){var t=new BABYLON.SolidParticleSystem("NodeSPS",e,{isPickable:!0,expandable:!0,enableDepthSort:!0}),n=new BABYLON.SolidParticleSystem("EdgeSPS",e,{isPickable:!0,expandable:!0,enableDepthSort:!0}),i=0,s=0,a=[],l=[],o=BABYLON.MeshBuilder.CreateSphere("defaultSphere",{diameter:3,segments:8,updatable:!1}),r=BABYLON.MeshBuilder.CreateCylinder("cylinder",{height:1,diameter:1,tessellation:6,updatable:!1});function d(){t.setParticles(),t.refreshVisibleSize()}function c(){n.setParticles(),n.refreshVisibleSize()}function p(){d(),c()}function u(){let e=s++;return e>=t.nbParticles&&function(e){"number"!=typeof e&&(e=100);let n=t.nbParticles;t.addShape(o,e),t.buildMesh();for(let i=n;i<n+e;i++)t.particles[i].isVisible=!1}(100),e}function g(){let e=i++;return e>=n.nbParticles&&function(e){"number"!=typeof e&&(e=500);let t=n.nbParticles;n.addShape(r,e),n.buildMesh();for(let i=t;i<t+e;i++)n.particles[i].isVisible=!1}(500),e}return o.setEnabled(!1),r.setEnabled(!1),{init:function(e,i){"number"!=typeof e&&(e=100),"number"!=typeof i&&(i=500),t.addShape(o,e),t.buildMesh();for(let n=0;n<e;n++)t.particles[n].isVisible=!1;n.addShape(r,i),n.buildMesh();for(let e=0;e<i;e++)n.particles[e].isVisible=!1;p()},reset:function(){s=0,i=0},onPick:function(e){let i=e.pickedMesh.name;if(i===t.name){return{type:"node",id:t.particles[t.pickedParticle(e).idx].nodeId}}if(i===n.name){return{type:"edge",id:n.particles[n.pickedParticle(e).idx].edgeId}}return{type:"unknown",id:-1}},refresh:p,refreshNodes:d,refreshEdges:c,bindNode:function(e,n,i){let s=u(),a=t.particles[s];return void 0!==a?(a.position=n,a.color=i,a.isVisible=!0,a.nodeId=e.id,a):null},updateNodeValue:function(e,n){let i=e.meshId(),s=t.particles[i];s.color=n,s.isVisible=!0},unbindNode:function(e){let n=e.meshId();t.particles[n].isVisible=!1,t.particles[n].nodeId=null,a.push(n)},bindEdge:function(e){let t=g(),i=n.particles[t];return void 0!==i?(i.edgeId=e.id,i):null},setEdge:function(e,t,i,s,a){let l=e.meshId(),o=n.particles[l],r=BABYLON.Vector3.Distance(s,a),d=a.subtract(s);d.normalize();let c=new BABYLON.Vector3;c.copyFrom(s),c.addInPlace(d.scale(r/2)),o.rotation=BABYLON.Vector3.PitchYawRollToMoveBetweenPoints(s,a),o.position=c,o.color=t,o.scaling=new BABYLON.Vector3(i,r,i),o.isVisible=!0},updateEdgeGeometry:function(e,t,i){let s=e.meshId(),a=n.particles[s],l=BABYLON.Vector3.Distance(t,i),o=i.subtract(t);o.normalize();let r=new BABYLON.Vector3;r.copyFrom(t),r.addInPlace(o.scale(l/2)),a.rotation=PitchYawRollToMoveBetweenPoints(t,i),a.position=r,a.isVisible=!0},updateEdgeValue:function(e,t,i){let s=e.meshId(),a=n.particles[s];a.color=t,a.scaling.x=i,a.scaling.z=i,a.isVisible=!0},unbindEdge:function(e){let t=e.meshId();n.particles[t].isVisible=!1,n.particles[t].edgeId=null,l.push(t)}}};var GraphSize=function(e,t,n,i,s){this.cols=e,this.rows=t,this.lays=n,this.KL=i,this.KR=s},GraphDescr=function(){this.size=new GraphSize(0,0,0,0,0),this.set=function(e,t,n,i,s,a){this.setType(e),this.setSize(t,n,i,s,a)},this.setType=function(e){this.type=e},this.setSize=function(e,t,n,i,s){this.size=new GraphSize(e,t,n,i,s)}},TempGraphStructure=function(){this.nodes=[],this.edges=[],this.addEdge1=function(e,t,n){this.edges.push({n1:e,n2:t,values:{default:n}})},this.addEdge2=function(e,t,n){this.edges.push({n1:e,n2:t,values:n})},this.addNode1=function(e,t,n){let i={id:e,values:{default:t},label:null};void 0!==n&&(i.label={text:n,enabled:!0}),this.nodes.push(i)},this.addNode2=function(e,t,n){let i={id:e,values:t,label:null};void 0!==n&&(i.label={text:n,enabled:!0}),this.nodes.push(i)}},Label=function(e,t,n){this.createMe=async function(e,t){this.plane=this.createPlane(),this.plane.position=e.add(this.planeOffset),this.plane.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_ALL,this.plane.setEnabled(t),this.plane.isPickable=!1},this.setText=async function(e,t){this.text=e,null!==this.plane&&this.plane.dispose(),this.createMe(this.position,t)},this.setColors=function(e,t){"&"===this.text.charAt(0)?this.bgcolor=e:this.bgcolor=this.defbgcolor,null!==this.plane&&this.plane.dispose(),this.createMe(this.position,t)},this.getText=function(){return this.text},this.setPosition=function(e){this.position=e,null!==this.plane&&(this.plane.position=e.add(this.planeOffset))},this.createPlane=function(){let e=this.text;"&"===e.charAt(0)&&(e=e.substring(1));let t="normal 64px Arial,Helvetica,sans-serif",n="rgba("+String(this.bgcolor.r)+","+String(this.bgcolor.g)+","+String(this.bgcolor.b)+","+String(this.bgcolor.a)+")",i=new BABYLON.DynamicTexture("DynamicTexture",64,sgv.scene).getContext();i.font=t;let s=i.measureText(e).width+8;var a=.05*s,l=BABYLON.MeshBuilder.CreatePlane(this.id+"_plane",{width:a,height:3.6,updatable:!0},sgv.scene);return l.material=new BABYLON.StandardMaterial(this.id+"_plane_material",sgv.scene),l.material.diffuseTexture=new BABYLON.DynamicTexture(this.id+"_plane_texture",{width:s,height:72},sgv.scene,!1),l.material.diffuseTexture.hasAlpha=!0,l.material.opacityTexture=l.material.diffuseTexture,l.material.transparencyMode=BABYLON.Material.MATERIAL_ALPHABLEND,l.material.alpha=1,l.material.diffuseTexture.drawText(e,null,null,t,"#ffff00",n,!0),l.material.emissiveColor=new BABYLON.Color3(1,1,0),l},this.setEnabled=function(e){null!==this.plane?this.plane.setEnabled(e):e&&this.createMe(this.position,!0)},this.defbgcolor={r:40,g:40,b:40,a:.5},this.bgcolor=this.defbgcolor,this.text=t,this.planeOffset=new BABYLON.Vector3(0,5,0),this.position=n,this.id=e,this.plane=null};const createLabel=function(e,t){return new Label("q"+e,"q"+e,t)};var Node=function(e,t,n,i,s,a){this.parentGraph=e,"string"==typeof t&&(t=parseInt(t,10)),"number"!=typeof t&&console.warning("Node id should be a number, but is: "+t),this.id=t,this.active=!0,this._chckedEdges=0,this.labelIsVisible=!1,this.values={default:Number.NaN};for(const e in a)this.values[e]=a[e];if(Object.defineProperty(this,"position",{get(){return this.mesh.position},set(e){this.mesh.position.copyFrom(e),null!==l.plane&&l.plane.position.copyFrom(e)}}),this.dispose=function(){sgv.SPS.unbindNode(this),null!==l&&null!==l.plane&&l.plane.dispose(),delete l},this.clear=function(){this.dispose()},this.showLabel=function(e){void 0!==e&&(this.labelIsVisible=e),l.setEnabled(this.labelIsVisible&&this.parentGraph.labelsVisible)},this.setLabel=function(e,t){void 0!==t&&(this.labelIsVisible=t),l.setText(e,this.labelIsVisible&&this.parentGraph.labelsVisible)},this.isLabelVisible=function(){return this.labelIsVisible},this.getLabel=function(){return l.getText()},this.move=function(e){this.mesh.position.addInPlace(e)},this.addCheck=function(){this._chckedEdges++},this.delCheck=function(){this._chckedEdges--},this.getValue=function(e){return void 0===e&&(e=this.parentGraph.currentScope),this.values.hasOwnProperty(e)?this.values[e]:Number.NaN},this.delValue=function(e){void 0===e&&(e=this.parentGraph.currentScope),e in this.values&&delete this.values[e]},this.setValue=function(e,t){void 0===t&&(t=this.parentGraph.currentScope),this.values[t]=e},this.displayValue=function(e){void 0===e&&(e=this.parentGraph.currentScope);let t=valueToColor(e in this.values?this.values[e]:Number.NaN);e in this.values?this.values[e]<0?l.setColors({r:255,g:0,b:0,a:.8},this.isLabelVisible()):this.values[e]>0?l.setColors({r:0,g:128,b:0,a:.8},this.isLabelVisible()):l.setColors({r:0,g:0,b:255,a:.8},this.isLabelVisible()):l.setColors({r:40,g:40,b:40,a:.5},this.isLabelVisible()),sgv.SPS.updateNodeValue(this,t)},this.currentColor=function(e){return void 0===e&&(e=this.parentGraph.currentScope),e in this.values?valueToColor(this.values[e]):new BABYLON.Color4(.2,.2,.2)},this.meshId=()=>this.mesh.idx,this.mesh=sgv.SPS.bindNode(this,new BABYLON.Vector3(n,i,s),this.currentColor()),null===this.mesh)console.error("Can't bind NodeSPS");else var l=createLabel(this.id,this.mesh.position)};Node.fromQDescr=(e,t)=>{let n=e.calcPosition2(t.x,t.y,t.z,t.n0());return new Node(e,t.toNodeId(e.rows,e.cols),n.x,n.y,n.z)},Node.fromXYZIJK=(e,t,n,i,s,a,l)=>Node.fromQDescr(e,qD(t,n,i,s,a,l));var Edge=function(e,t,n){this.parentGraph=e,this.values={default:Number.NaN},"string"==typeof t&&(t=parseInt(t,10)),"string"==typeof n&&(n=parseInt(n,10)),"number"==typeof t&&"number"==typeof n||console.warning("Edge begin and end ids should be both a numbers, but are: "+t+" and "+n),t in this.parentGraph.nodes||console.warning("First node not exists in graph: "+t),n in this.parentGraph.nodes||console.warning("Second node not exists in graph: "+n),t<n?(this.begin=t,this.end=n):(this.begin=n,this.end=t),this.id=Edge.calcId(this.begin,this.end),this._checked=!1,this.meshId=()=>i.idx,this.clear=function(){sgv.SPS.unbindEdge(this)},this.switchCheckFlag=function(){this._checked=!this._checked,this.parentGraph.checkNode(this.begin,this._checked),this.parentGraph.checkNode(this.end,this._checked)},this.delValue=function(e){void 0===e&&(e=this.parentGraph.currentScope),e in this.values&&delete this.values[e]},this.getValue=function(e){return void 0===e&&(e=this.parentGraph.currentScope),this.values.hasOwnProperty(e)?this.values[e]:Number.NaN},this.setValue=function(e,t){void 0===t&&(t="default"),this.values[t]=e,this.displayValue(t)},this.displayValue=function(e){void 0===e&&(e="default");let t=new BABYLON.Color3(.2,.2,.2),n=.1;e in this.values&&(t=valueToColor(this.values[e]),n=valueToEdgeWidth(this.values[e])),sgv.SPS.updateEdgeValue(this,t,n)},this.update=()=>{let e=this.values[this.parentGraph.currentScope],t=valueToColor(e),n=valueToEdgeWidth(e),i=this.parentGraph.nodePosition(this.begin),s=this.parentGraph.nodePosition(this.end);sgv.SPS.setEdge(this,t,n,i,s)};var i=sgv.SPS.bindEdge(this);null===i?console.error("Can't bind EdgeSPS"):this.update()};Edge.calcId=(e,t)=>("string"==typeof e&&(e=parseInt(e,10)),"string"==typeof t&&(t=parseInt(t,10)),"number"==typeof e&&"number"==typeof t||console.error("Edge begin and end must be a numbers"),e<t?e+","+t:t+","+e);const qD=function(e,t,n,i,s,a){return new QbDescr(e,t,n,i,s,a)},QbDescr=function(e,t,n,i,s,a){this.x=e,this.y=t,this.z=n,this.i=i,this.j=s,this.k=a,this.n0=function(){return((this.i<<1)+this.j<<1)+this.k},this.n1=function(){return((this.i<<1)+this.j<<1)+this.k+1},this.toNodeId=function(e,t){return 8*(this.x+(this.y+this.z*e)*t)+this.n1()}};QbDescr.fromNodeId=function(e,t,n){let i=e-1,s=i%8,a=s%2,l=(s>>1)%2,o=(s>>2)%2,r=i>>3,d=n*t,c=Math.floor(r/d),p=r%d,u=Math.floor(p/n);return new QbDescr(p%n,u,c,o,l,a)};const Graph=function(){this.nodes={},this.edges={},this.missing={},this.type="generic",this.scopeOfValues=["default"],this.currentScope="default",this.greenLimit=1,this.redLimit=-1,this.labelsVisible=!1,this.dispose=function(){for(const e in this.edges)this.edges[e].clear(),delete this.edges[e];for(const e in this.nodes)this.nodes[e].clear(),delete this.nodes[e];Dispatcher.graphDeleted()},this.clear=function(){this.dispose()},this.maxNodeId=function(){return Object.keys(this.nodes).length},this.addNode=function(e,t){values={},"number"==typeof t&&(values.default=t);let n=this.calcPosition(e),i=new Node(this,e,n.x,n.y,n.z,values);return i.showLabel(!1),this.nodes[i.id]=i,i},this.getKeyByValue=function(e,t){return Object.keys(e).find((n=>e[n]===t))},this.getScopeIndex=function(e){return Object.keys(this.scopeOfValues).find((t=>this.scopeOfValues[t]===e))},this.addEdge=function(e,t){let n=Edge.calcId(e,t);if(n in this.edges)return console.log("edge already exists",n),this.edges[n];{let i=new Edge(this,e,t);return this.edges[n]=i,i}},this.delEdge=function(e){this.edges[e].clear(),delete this.edges[e],Dispatcher.graphChanged()},this.findAllConnected=e=>{var t={internal:[],horizontal:[],vertical:[],up:[],down:[],other:[]};function n(n){let i=QbDescr.fromNodeId(e,sgv.graf.rows,sgv.graf.cols),s=QbDescr.fromNodeId(n,sgv.graf.rows,sgv.graf.cols);i.x===s.x&&i.y===s.y&&i.z===s.z?t.internal.push(n):i.x!==s.x&&i.y===s.y&&i.z===s.z?t.horizontal.push(n):i.x===s.x&&i.y!==s.y&&i.z===s.z?t.vertical.push(n):i.z<s.z?t.up.push(n):i.z>s.z?t.down.push(n):t.other.push(n)}for(const t in this.edges)this.edges[t].begin==e?n(this.edges[t].end):this.edges[t].end==e&&n(this.edges[t].begin);return t},this.findAndDeleteEdges=function(e){var t={};console.log("graf.findAndDeleteEdges",e);for(const n in this.edges)this.edges[n].begin.toString()===e?(t[this.edges[n].end]={values:this.edges[n].values},this.delEdge(n)):this.edges[n].end.toString()===e&&(t[this.edges[n].begin]={values:this.edges[n].values},this.delEdge(n));return t},this.delNode=function(e){var t=this.findAndDeleteEdges(e);this.missing[e]={label:{text:this.nodes[e].getLabel(),enabled:this.nodes[e].isLabelVisible()},values:this.nodes[e].values,edges:{}};for(const n in t)this.missing[e].edges[n]=t[n];this.nodes[e].clear(),delete this.nodes[e],sgv.dlgMissingNodes.addNode(e),Dispatcher.graphChanged()},this.restoreNode=function(e){if(e in this.nodes)return!1;if(!(e in this.missing))return!1;let t=this.calcPosition(e);this.nodes[e]=new Node(this,e,t.x,t.y,t.z,this.missing[e].values),this.nodes[e].setLabel(this.missing[e].label.text,this.missing[e].label.enabled);for(const t in this.missing[e].edges){var n=parseInt(t,10);if(n in this.nodes){let i=new Edge(this,e,t);console.log(i);for(const t in this.missing[e].edges[n].values)i.setValue(this.missing[e].edges[n].values[t],t);this.edges[i.id]=i,console.log(i.id)}else n in this.missing&&(this.missing[n].edges[e]=this.missing[e].edges[n])}return delete this.missing[e],0===Object.keys(this.missing).length&&sgv.dlgMissingNodes.hide(),Dispatcher.graphChanged(),!0},this.findAndUpdateEdges=function(e){for(const t in this.edges)this.edges[t].begin.toString()!==e&&this.edges[t].end.toString()!==e||this.edges[t].update()},this.stringToStruct=e=>{if(null==e)return null;for(var t={nodes:{},edges:{}},n=e.split("\n"),i=function(e){var t=e.split(" ");return 3===t.length?{n1:parseInt(t[0],10),n2:parseInt(t[1],10),val:parseFloat(t[2],10)}:null};n.length>0;){if("#"!==n[0][0]){var s=i(n[0]);null!==s&&(s.n1===s.n2?t.nodes[s.n1]=s.val:t.edges[Edge.calcId(s.n1,s.n2)]=s.val)}n.shift()}return t},this.loadScopeValues=(e,t)=>{let n=!1;void 0===e||this.scopeOfValues.includes(e)||(this.scopeOfValues.push(e),n=!0);var i=this.stringToStruct(t);for(const t in i.nodes)this.nodes[t].setValue(i.nodes[t],e);for(const t in i.edges)this.edges[t].setValue(i.edges[t],e);return this.displayValues(e),{n:n,i:this.scopeOfValues.indexOf(e)}},this.addScopeOfValues=function(e){return void 0===e||this.scopeOfValues.includes(e)?-1:(this.scopeOfValues.push(e),this.scopeOfValues.indexOf(e))},this.delScopeOfValues=function(e){if(void 0!==e&&"default"!==e){let t=this.scopeOfValues.indexOf(e);if(-1!==t){this.scopeOfValues.splice(t,1);for(const t in this.nodes)this.nodes[t].delValue(e);return this.currentScope===e&&(this.currentScope="default",this.displayValues("default")),this.scopeOfValues.indexOf(this.currentScope)}}return-1},this.hasScope=function(e){return void 0!==e&&this.scopeOfValues.includes(e)},this.displayValues=async function(e){void 0!==e&&this.scopeOfValues.includes(e)?this.currentScope=e:e=this.currentScope;for(const t in this.nodes)this.nodes[t].displayValue(e);for(const t in this.edges)this.edges[t].displayValue(e);return Dispatcher.currentScopeChanged(),!0},this.isNodeLabelVisible=function(e){return this.nodes[e].isLabelVisible()},this.nodeLabel=function(e){return this.nodes[e].getLabel()},this.nodePosition=function(e){return this.nodes[e].position},this.checkNode=function(e,t){t?this.nodes[e].addCheck():this.nodes[e].delCheck()},this.edgeDoubleClicked=function(e){this.edges[e].switchCheckFlag()},this.moveNode=function(e,t){this.nodes[e].move(t),this.findAndUpdateEdges(e)},this.setEdgeValue=function(e,t,n){this.edges[e].setValue(t,n),this.edges[e].displayValue()},this.delEdgeValue=function(e,t){this.edges[e].delValue(t),this.edges[e].displayValue()},this.edgeValue=function(e,t){return this.edges[e].getValue(t)},this.setNodeValue=function(e,t,n){this.nodes[e].setValue(t,n),this.nodes[e].displayValue()},this.delNodeValue=function(e,t){this.nodes[e].delValue(t),this.nodes[e].displayValue()},this.nodeValue=function(e,t){return this.nodes[e].getValue(t)},this.getMinMaxEdgeVal=function(e){void 0!==e&&this.scopeOfValues.includes(e)||(e=this.currentScope);var t={min:Number.MAX_VALUE,max:-Number.MAX_VALUE,com:""};let n=!0;for(const i in this.edges){let s=this.edges[i].getValue(e);isNaN(s)||(n=!1,s<t.min&&(t.min=s),t.max<s&&(t.max=s))}return n&&(t.min=Number.NaN,t.max=Number.NaN,t.com="\nWARNING: The graph has no edge that has a weight in the current scope.\n"),t},this.getMinMaxNodeVal=function(e){void 0!==e&&this.scopeOfValues.includes(e)||(e=this.currentScope);var t={min:Number.MAX_VALUE,max:-Number.MAX_VALUE,com:""};let n=!0;for(const i in this.nodes){let s=this.nodes[i].getValue(e);isNaN(s)||(n=!1,s<t.min&&(t.min=s),t.max<s&&(t.max=s))}return n&&(t.min=Number.NaN,t.max=Number.NaN,t.com="\nWARNING: The graph has no node that has a value in the current scope.\n"),t},this.getMinMaxVal=function(e){void 0!==e&&this.scopeOfValues.includes(e)||(e=this.currentScope);let t=this.getMinMaxNodeVal(e),n=this.getMinMaxEdgeVal(e);return isNaN(t.min)?{min:n.min,max:n.max}:isNaN(n.min)?{min:t.min,max:t.max}:{min:t.min<n.min?t.min:n.min,max:t.max>n.max?t.max:n.max}},this.calcPosition=e=>new BABYLON.Vector3,this.setDisplayMode=function(){for(const e in this.nodes)this.nodes[e].position=this.calcPosition(e);for(const e in this.edges)this.edges[e].update();Dispatcher.viewModeChanged()},this.showLabels=function(e){this.labelsVisible=e;for(const e in this.nodes)this.nodes[e].showLabel()},this.createStructureFromTempStruct=function(e){return new Promise((t=>{for(let t of e.nodes){let e=this.addNode(t.id);e.values=t.values,null!==t.label?e.setLabel(t.label.text,t.label.enabled):e.showLabel(!1)}for(let t of e.edges){this.addEdge(t.n1,t.n2).values=t.values}this.showLabels(!0),t("ok")}))},this.scale=function(e,t,n){return t===n?.5:(e-t)/(n-t)}};Graph.displayModes=["classic","triangle","diamond"],Graph.currentDisplayMode="classic",Graph.switchDisplayMode=()=>{if(null===sgv.graf)return void console.warning("graf not defined");let e=Graph.displayModes.indexOf(Graph.currentDisplayMode)+1;e===Graph.displayModes.length&&(e=0),Graph.currentDisplayMode=Graph.displayModes[e],sgv.graf.setDisplayMode()},Graph.knownGraphTypes={},Graph.registerType=(e,t)=>{Graph.knownGraphTypes[e]=t},Graph.knowType=e=>e in Graph.knownGraphTypes,Graph.create=(e,t)=>{Graph.remove(),e instanceof GraphDescr&&e.type in Graph.knownGraphTypes?(sgv.graf=new Graph.knownGraphTypes[e.type](e.size),t instanceof TempGraphStructure?sgv.graf.createStructureFromTempStruct(t).then((()=>Dispatcher.graphCreated())):sgv.graf.createDefaultStructure((()=>Dispatcher.graphCreated()))):console.error("unknown graph type")},Graph.remove=()=>{null!==sgv.graf&&(sgv.graf.dispose(),sgv.graf=null,Dispatcher.graphDeleted())};const Chimera=function(e){Graph.call(this),this.type="chimera",this.setSize=function(e){e instanceof GraphSize?(this.cols=e.cols,this.rows=e.rows,this.layers=e.lays,this.KL=e.KL,this.KR=e.KR):(this.cols=2,this.rows=2,this.layers=1,this.KL=4,this.KR=4)},this.setSize(e),this.maxNodeId=function(){return this.cols*this.rows*8},this.connect=function(e,t,n){let i=e.toNodeId(this.rows,this.cols),s=t.toNodeId(this.rows,this.cols);if(i in this.nodes&&s in this.nodes){let e=this.addEdge(i,s);"number"==typeof n&&e.setValue(n)}},this.connectVertical=function(e,t,n){for(let i of[0,1])for(let s of[0,1])this.connect(new QbDescr(e,t,n,0,i,s),new QbDescr(e,t+1,n,0,i,s))},this.connectHorizontal=function(e,t,n){for(let i of[0,1])for(let s of[0,1])this.connect(new QbDescr(e,t,n,1,i,s),new QbDescr(e+1,t,n,1,i,s))},this.connectInternalChimeraEdges=function(e,t,n){let i;i=Number.NaN;for(let s of[0,1])for(let a of[0,1])for(let l of[0,1])for(let o of[0,1])this.connect(new QbDescr(e,t,n,0,s,a),new QbDescr(e,t,n,1,l,o),i)},this.modulePositionTEST=function(e,t,n){let i=50,s=i*((this.rows-1)/2)-i*e,a=i*t-i*((this.cols-1)/2),l=i*n-i*((this.layers-1)/2);return new BABYLON.Vector3(s,l,a)},this.modulePosition=function(e,t,n){let i=50,s=i*((this.cols-1)/2)-i*t,a=i*e-i*((this.rows-1)/2),l=i*n-i*((this.layers-1)/2);return new BABYLON.Vector3(s,l,a)},this.calcPosition2=function(e,t,n,i){let s=this.modulePosition(e,t,n);return s.addInPlace(this.getNodeOffset2(i)),s},this.calcPosition=function(e){let t=QbDescr.fromNodeId(e,this.rows,this.cols);return this.calcPosition2(t.x,t.y,t.z,t.n0())},this.addNodeXYZIJK=function(e,t,n,i,s,a){return this.addNode(qD(e,t,n,i,s,a).toNodeId(this.rows,this.cols))},this.addNodeXYZn=function(e,t,n,i){return this.addNode(qD(e,t,n,i>>2&1,i>>1&1,1&i).toNodeId(this.rows,this.cols))},this.createModuleNodes=function(e,t,n){for(let i=0;i<this.KL;i++)this.addNodeXYZn(e,t,n,i);for(let i=0;i<this.KR;i++)this.addNodeXYZn(e,t,n,i+4)},this.getNodeOffset2=function(e){return{classic:[new BABYLON.Vector3(15,-3,-10),new BABYLON.Vector3(5,-1,-10),new BABYLON.Vector3(-5,1,-10),new BABYLON.Vector3(-15,3,-10),new BABYLON.Vector3(15,3,10),new BABYLON.Vector3(5,1,10),new BABYLON.Vector3(-5,-1,10),new BABYLON.Vector3(-15,-3,10)],diamond:[new BABYLON.Vector3(0,-5,15),new BABYLON.Vector3(0,-1,5),new BABYLON.Vector3(0,1,-5),new BABYLON.Vector3(0,5,-15),new BABYLON.Vector3(15,5,0),new BABYLON.Vector3(5,1,0),new BABYLON.Vector3(-5,-1,0),new BABYLON.Vector3(-15,-5,0)],triangle:[new BABYLON.Vector3(-15,-3,9),new BABYLON.Vector3(-15,-1,3),new BABYLON.Vector3(-15,1,-3),new BABYLON.Vector3(-15,3,-9),new BABYLON.Vector3(9,3,15),new BABYLON.Vector3(3,1,15),new BABYLON.Vector3(-3,-1,15),new BABYLON.Vector3(-9,-3,15)]}[Graph.currentDisplayMode][e]},this.verticalConnections=()=>{for(let e=0;e<this.layers;e++)for(let t=0;t<this.rows-1;t++)for(let n=0;n<this.cols;n++)this.connectVertical(n,t,e)},this.horizontalConnections=()=>{for(let e=0;e<this.layers;e++)for(let t=0;t<this.rows;t++)for(let n=0;n<this.cols-1;n++)this.connectHorizontal(n,t,e)},this.createModules=()=>{for(let e=0;e<this.layers;e++)for(let t=0;t<this.rows;t++)for(let n=0;n<this.cols;n++)this.createModuleNodes(n,t,e),this.connectInternalChimeraEdges(n,t,e)},this.createDefaultStructure=function(e){this.layers>1&&(this.layers=1),sgv.dlgLoaderSplash.setInfo("creating modules",(()=>{this.createModules(),sgv.dlgLoaderSplash.setInfo("creating vertical connections",(()=>{this.verticalConnections(),sgv.dlgLoaderSplash.setInfo("creating horizontal connections",(()=>{this.horizontalConnections(),"function"==typeof e&&e()}))}))}))}};(Chimera.prototype=Object.create(Graph.prototype)).constructor=Chimera,Graph.registerType("chimera",Chimera);var Pegasus=function(e){Chimera.call(this,e),this.type="pegasus",this.pegasusConnections=()=>{for(let e=0;e<this.layers;e++)for(let t=0;t<this.rows;t++)for(let n=0;n<this.cols;n++)this.connectInternalPegasusEdges(n,t,e),this.connectExternalPegasusEdges(n,t,e)},this.createDefaultStructure=function(e){sgv.dlgLoaderSplash.setInfo("creating modules",(()=>{this.createModules(),sgv.dlgLoaderSplash.setInfo("creating vertical connections",(()=>{this.verticalConnections(),sgv.dlgLoaderSplash.setInfo("creating horizontal connections",(()=>{this.horizontalConnections(),sgv.dlgLoaderSplash.setInfo("creating specific pegasus connections",(()=>{this.pegasusConnections(),"function"==typeof e&&e()}))}))}))}))},this.connectExternalPegasusEdges=function(e,t,n){let i,s,a,l,o,r,d,c;i=s=a=l=o=r=d=c=Number.NaN;let p=0===e,u=e===this.cols-1,g=0===t,h=t===this.rows-1,f=n===this.layers-1;for(let v of[0,1])for(let b of[0,1])for(let y of[0,1])f?(u||h||(this.connect(new QbDescr(e,t,n,0,0,v),new QbDescr(e+1,t+1,0,1,b,y),o),this.connect(new QbDescr(e,t,n,1,0,v),new QbDescr(e+1,t+1,0,0,b,y),r)),h||this.connect(new QbDescr(e,t,n,0,1,v),new QbDescr(e,t+1,0,1,b,y),d),u||this.connect(new QbDescr(e,t,n,1,1,v),new QbDescr(e+1,t,0,0,b,y),c)):(this.connect(new QbDescr(e,t,n,0,0,v),new QbDescr(e,t,n+1,1,b,y),i),this.connect(new QbDescr(e,t,n,1,0,v),new QbDescr(e,t,n+1,0,b,y),s),p||this.connect(new QbDescr(e,t,n,0,1,v),new QbDescr(e-1,t,n+1,1,b,y),a),g||this.connect(new QbDescr(e,t,n,1,1,v),new QbDescr(e,t-1,n+1,0,b,y),l))},this.connectInternalPegasusEdges=function(e,t,n){let i;i=Number.NaN;for(let s of[0,1])for(let a of[0,1])this.connect(new QbDescr(e,t,n,s,a,0),new QbDescr(e,t,n,s,a,1),i)}};Pegasus.prototype=Object.create(Chimera.prototype),Pegasus.prototype.constructor=Pegasus,Graph.registerType("pegasus",Pegasus);var UI=function(){};UI.tag=function(e,t,n,i){var s=document.createElement(e);for(const e in t)s.setAttribute(e,t[e]);for(const e in n)s[e]=n[e];for(const e in i)"string"==typeof e&&"function"==typeof i[e]&&s.addEventListener(e,i[e]);return s},UI.span=function(e,t){return UI.tag("span",t,{textContent:e})},UI.selectByKey=function(e,t){let n=UI.findOption(e,t.toString());return n>-1&&(e.selectedIndex=n,!0)},UI.clearSelect=function(e,t){for(var n=t?0:1;n<e.options.length;n++)e.removeChild(e.options[n]),n--},UI.findOption=function(e,t){for(var n=0;n<e.options.length;n++)if(e.options[n].value===t)return n;return-1},UI.option=function(e,t,n){var i=document.createElement("option");return i.value=e,i.text=t,void 0!==n&&(i.selected=n?"selected":""),i},UI.input=function(e){var t=document.createElement("input");for(const n in e)t.setAttribute(n,e[n]);return t},UI.newInput=function(e,t,n,i){var s=document.createElement("input");return s.setAttribute("type",e),s.value=t,void 0!==n&&""!==n&&s.setAttribute("class",n),void 0!==i&&""!==i&&s.setAttribute("id",i),s},UI.createTitlebar=function(e,t){var n=UI.tag("div",{class:"title"});return t&&n.appendChild(UI.tag("button",{class:"hidebutton"},{innerHTML:'<span id="X">❌</span><span id="value"></span>'})),n.appendChild(UI.tag("span",{class:"titleText"},{textContent:e})),n},UI.createEmptyWindow=function(e,t,n,i){var s=document.createElement("div");void 0!==e&&""!==e&&s.setAttribute("class",e),void 0!==t&&""!==t&&s.setAttribute("id",t);let a=UI.createTitlebar(n,i);return s.offset={x:0,y:0},s.isDown=!1,a.addEventListener("mouseover",(function(){a.style.cursor="pointer",movable=!0})),a.addEventListener("mouseout",(function(){movable=!1})),a.addEventListener("mousedown",(function(e){s.isDown=movable,s.offset={x:s.offsetLeft-e.clientX,y:s.offsetTop-e.clientY}}),!0),a.addEventListener("mouseup",(function(){s.isDown=!1}),!0),document.addEventListener("mousemove",(function(e){if(s.isDown){let t={x:e.clientX,y:e.clientY};s.style.left=t.x+s.offset.x+"px",s.style.top=t.y+s.offset.y+"px"}}),!0),s.appendChild(a),s.setAttribute("tabindex","0"),s},UI.createTransparentBtn=function(e,t,n){let i=UI.tag("input",{type:"button",value:e,class:"sgvTransparentButton1",id:t});return"function"==typeof n&&i.addEventListener("click",(function(){n()})),i},UI.createTransparentBtn1=function(e,t,n){let i=UI.tag("button",{class:"sgvTransparentButton1",id:t});return i.appendChild(UI.tag("span",{},{innerHTML:e})),"function"==typeof n&&i.addEventListener("click",(function(){n()})),i};const GenericWindow=function(e,t,n){var i=null;this.ui=UI.tag("div",{class:"sgvUIwindow"});var s=!1;void 0!==e&&""!==e&&this.ui.setAttribute("id",e);let a=UI.tag("div",{class:"title"});if(a.appendChild(UI.tag("span",{class:"titleText"},{textContent:t})),"closeButton"in n&&!0===n.closeButton){let e=UI.tag("input",{type:"button",class:"hidebutton",value:"❌"});e.addEventListener("click",(()=>this._hide())),a.appendChild(e)}var l;this.ui.appendChild(a),"setMovable"in n&&!0===n.setMovable&&((l=this.ui).offset={x:0,y:0},l.isDown=!1,a.addEventListener("mouseover",(function(){a.style.cursor="pointer",s=!0})),a.addEventListener("mouseout",(function(){s=!1})),a.addEventListener("mousedown",(function(e){l.isDown=s,l.offset={x:l.offsetLeft-e.clientX,y:l.offsetTop-e.clientY}}),!0),a.addEventListener("mouseup",(function(){l.isDown=!1}),!0),document.addEventListener("mousemove",(function(e){if(l.isDown){let t={x:e.clientX,y:e.clientY};l.style.left=t.x+l.offset.x+"px",l.style.top=t.y+l.offset.y+"px"}}),!0)),this.ui.setAttribute("tabindex","0"),window.addEventListener("load",(()=>window.document.body.appendChild(this.ui))),this._show=()=>{i=window.document.activeElement,this.ui.style.display="block",this.ui.focus({focusVisible:!1})},this._hide=()=>{this.ui.style.display="none",null!==i&&i.focus({focusVisible:!1})},this._switch=()=>{"none"===this.ui.style.display?this._show():this._hide()},this._test=function(){console.log("test 1a")}};function ExePanel(){function e(e){let t=UI.tag("div");return t.append(UI.tag("input",{type:"button",id:"btnDelPath"+e,value:"➖"}),UI.tag("input",{type:"text",id:"dispBtn"+e,value:"Button text"}),UI.tag("input",{type:"text",id:"editPath"+e,value:"d:/any/path/to/prog.exe"}),UI.tag("input",{type:"button",id:"btnPath"+e,value:"..."})),t}let t=[];t.push(e(1)),t.push(e(2)),t.push(e(3));let n=UI.tag("div",{class:"content",id:"graphSelection"});return t.forEach((e=>{n.appendChild(e)})),n.appendChild(UI.tag("input",{type:"button",id:"btnDelPath1",value:"➕"})),{ui:n}}function KnownProgsPanel(){function e(e){let t,n=UI.tag("div");return n.append(UI.tag("input",{type:"checkbox",id:"chkPath"+e,checked:"checked"}),UI.tag("label",{for:"editPath"+e},{innerHTML:" Path to prog."+e+" "}),t=UI.tag("input",{type:"text",id:"editPath"+e,value:"d:/any/path/to/prog.exe"}),UI.tag("input",{type:"button",id:"btnPath"+e,value:"..."},{},{click:()=>{let e=UI.tag("input",{type:"file",id:"inputfile",display:"none"});e.addEventListener("change",(()=>{void 0!==e.files[0]&&(t.value=e.files[0].name)})),e.click()}})),n}let t=[];t.push(e(1)),t.push(e(2)),t.push(e(3));let n=UI.tag("div",{class:"content",id:"graphSelection"});return t.forEach((e=>{n.appendChild(e)})),{ui:n}}GenericWindow.prototype.show=this._show,GenericWindow.prototype.hide=this._hide,GenericWindow.prototype.switch=this._switch,GenericWindow.prototype.test=()=>{console.log("test 1")};const DlgPreferences=function(){GenericWindow.call(this,"sgvPrefsDlg","Preferences",{closeButton:!0,setMovable:!0});this.ui.appendChild(KnownProgsPanel().ui),this.ui.appendChild((()=>{let e=UI.tag("div",{id:"buttons"});e.appendChild(UI.tag("input",{type:"button",class:"actionbutton",id:"cplCancelButton",name:"cancelButton",value:"Cancel"},{},{click:this._hide}));let t=UI.tag("input",{type:"button",class:"actionbutton",id:"cplCreateButton",name:"createButton",value:"OK"});return e.appendChild(t),{ui:e}})().ui)};var parentPrototype=Object.create(GenericWindow.prototype);parentPrototype.constructor=DlgPreferences,DlgPreferences.prototype=parentPrototype;const DEFAULT_SCOPE="default";var sgv="undefined"==typeof exports?function(){}:exports;"undefined"!=typeof global&&(global.sgv=sgv),sgv.version="1.0.0",sgv.engine=null,sgv.scene=null,sgv.camera=null,sgv.graf=null,sgv.createScene=function(){var e;sgv.scene=new BABYLON.Scene(sgv.engine),sgv.camera=new BABYLON.ArcRotateCamera("Camera",0,0,10,new BABYLON.Vector3(0,0,0),sgv.scene),sgv.camera.setPosition(new BABYLON.Vector3(166,150,0)),sgv.camera.attachControl(sgv.canvas,!0),sgv.camera.inputs.attached.pointers.panningSensibility=25,sgv.camera.upperBetaLimit=Math.PI/2*.99,sgv.camera.inertia=.5,(e=new BABYLON.HemisphericLight("HemiLight",new BABYLON.Vector3(0,1,0),sgv.scene)).intensity=.75,e.parent=sgv.camera,e.position=new BABYLON.Vector3(0,0,0),sgv.SPS=new SolidPS(sgv.scene),sgv.SPS.init(),sgv.nodeToConnect=0,sgv.addEventsListeners(),sgv.scene.clearColor=new BABYLON.Color3(.7,.7,.7)},sgv.addEventsListeners=function(){var e,t,n=null;function i(){var e=sgv.scene.pick(sgv.scene.pointerX,sgv.scene.pointerY,(function(e){return e===n}));return e.hit?e.pickedPoint:null}sgv.scene.onPointerObservable.add((function(s){switch(s.type){case BABYLON.PointerEventTypes.POINTERTAP:!function(e){switch(e.event.button){case 0:!function(e){console.log("LEFT"),e.pickInfo.hit?function(e){let t=sgv.SPS.onPick(e);"node"===t.type&&t.id in sgv.graf.nodes?(console.log("Node picked"),0!==sgv.nodeToConnect?(sgv.graf.addEdge(sgv.nodeToConnect,t.id),sgv.nodeToConnect=0,sgv.SPS.refresh()):sgv.dlgNodeProperties.show(t.id,sgv.scene.pointerX,sgv.scene.pointerY)):"edge"===t.type&&t.id in sgv.graf.edges?(console.log("Edge picked"),sgv.dlgEdgeProperties.show(t.id,sgv.scene.pointerX,sgv.scene.pointerY)):(console.log("Unknown mesh picked"),sgv.dlgEdgeProperties.hide(),sgv.dlgNodeProperties.hide())}(e.pickInfo):(console.log("Probably ground picked"),sgv.dlgEdgeProperties.hide(),sgv.dlgNodeProperties.hide())}(e);break;case 1:!function(e){if(console.log("MIDDLE"),e.pickInfo.hit){let t=sgv.SPS.onPick(e.pickInfo);"node"===t.type&&t.id in sgv.graf.nodes&&(console.log("Node picked"),0===sgv.nodeToConnect?sgv.nodeToConnect=t.id:(sgv.graf.addEdge(sgv.nodeToConnect,t.id),sgv.nodeToConnect=0,sgv.SPS.refresh()))}}(e);break;case 2:console.log("RIGHT")}}(s);break;case BABYLON.PointerEventTypes.POINTERDOUBLETAP:s.pickInfo.hit&&s.pickInfo.pickedMesh!==n&&(a=s.pickInfo.pickedMesh,"edge"===(l=a.name.split(":"))[0]&&sgv.graf.edgeDoubleClicked(l[1]));break;case BABYLON.PointerEventTypes.POINTERDOWN:s.pickInfo.hit&&s.pickInfo.pickedMesh!==n&&function(n){console.log("POINTER.DOWN"),t=n.pickInfo.pickedMesh,(e=i())&&setTimeout((function(){sgv.camera.detachControl(sgv.canvas)}),0)}(s),null!==sgv.graf&&sgv.graf.showLabels(!1);break;case BABYLON.PointerEventTypes.POINTERUP:!function(){if(null!==sgv.graf&&sgv.graf.showLabels(!0),e)sgv.camera.attachControl(sgv.canvas,!0),e=null}();break;case BABYLON.PointerEventTypes.POINTERMOVE:!function(){if(null!==sgv.graf&&e){var n=i();if(n){var s=n.subtract(e),a=t.name.split(":");"node"===a[0]&&(sgv.graf.moveNode(parseInt(a[1],10),s),e=n)}}}()}var a,l}))},sgv.display=function(e){void 0!==e&&"object"==typeof e||(e={}),showSplashAndRun((()=>{let t=null;function n(){return new BABYLON.Engine(sgv.canvas,!0,{doNotHandleContextLost:!0,preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!1})}"target"in e&&(t=document.getElementById(e.target)),null===t&&(t=document.createElement("div"),t.setAttribute("id","sgvWorkspaceArea"),document.body.appendChild(t)),sgv.canvas=document.createElement("canvas"),sgv.canvas.setAttribute("id","sgvRenderCanvas"),t.appendChild(sgv.canvas),window.initFunction=async function(){if(sgv.engine=await async function(){try{return n()}catch(e){return console.log("the available createEngine function failed. Creating the default engine instead"),n()}}(),!sgv.engine)throw"engine should not be null.";sgv.engine.enableOfflineSupport=!1,sgv.createScene()},initFunction().then((function(){let e=sgv.scene;sgv.engine.runRenderLoop((function(){e&&e.activeCamera&&e.render()}))})),window.addEventListener("resize",(function(){sgv.engine.resize(),detectClient()})),desktopInit()}))};var ParserTXT={importGraph:e=>{var t=new TempGraphStructure,n=[],i=e.split("\n");let s=new GraphDescr;for(var a=function(e){var t=e.split("=");if("type"===t[0])s.setType(t[1]);else if("size"===t[0]){var n=t[1].split(",");n.length>=5?s.setSize(parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10),parseInt(n[4],10)):4===n.length&&s.setSize(parseInt(n[0],10),parseInt(n[1],10),1,parseInt(n[2],10),parseInt(n[3],10))}},l=function(e){var t=e.trim().split(/\s+/);if(t.length<3)return null;let n=parseInt(t[0],10),i=parseInt(t[1],10),s=parseFloat(t[2],10),a=null;return t.length>3&&(a=t[3]),isNaN(n)||isNaN(i)?null:{n1:n,n2:i,val:s,lbl:a}};i.length>0;){if("#"!==i[0][0]){let e=l(i[0]);null!==e&&(n.push(e),e.n1===e.n2?null===e.lbl?t.addNode1(e.n1,e.val):t.addNode1(e.n1,e.val,e.lbl):t.addEdge1(e.n1,e.n2,e.val))}else{let e=i[0].trim().split(/\s+/);e.length>1&&a(e[1])}i.shift()}void 0===s.type?sgv.dlgCreateGraph.show("load",t):Graph.create(s,t)},exportGraph:e=>{if(null==e)return null;var t="# type="+e.type+"\n";t+="# size="+e.cols+","+e.rows+","+e.layers+","+e.KL+","+e.KR+"\n";for(const n in e.nodes)t+=n+" "+n+" ",t+=e.nodes[n].getValue()+"\n";for(const n in e.edges)t+=e.edges[n].begin+" "+e.edges[n].end+" ",t+=e.edges[n].getValue()+"\n";return t}},ParserGEXF={importGraph:e=>{var t=new GraphDescr,n={},i={},s=new TempGraphStructure;function a(e){let t=e.getAttribute("id"),n=e.getAttribute("title");if(n.startsWith("default")){let e=n.split(";");return n=e[0],{id:t,title:n,type:e[1],size:e[2]}}return{id:t,title:n}}window.DOMParser?(parser=new DOMParser,xmlDoc=parser.parseFromString(e,"text/xml")):(xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async=!1,xmlDoc.loadXML(e)),function(e){let s=e.getElementsByTagName("attributes");for(let e=0;e<s.length;e++){let o=s[e].getAttribute("class"),r=s[e].getElementsByTagName("attribute");for(let e=0;e<r.length;e++)if("node"===o){let i=a(r[e]);if(n[i.id]=i.title,"type"in i&&t.setType(i.type),"size"in i){let e=i.size.split(",");t.setSize(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseInt(e[4]))}}else if("edge"===o){let t={id:(l=r[e]).getAttribute("id"),title:l.getAttribute("title")};i[t.id]=t.title}}var l}(xmlDoc),function(e){let t=e.getElementsByTagName("nodes")[0].getElementsByTagName("node");for(let e=0;e<t.length;e++){let i={},a=t[e].getAttribute("id");i.n1=i.n2=parseInt(a),i.values={};let l=t[e].getAttribute("label"),o=t[e].getElementsByTagName("attvalues");if(o.length>0){let e=o[0].getElementsByTagName("attvalue");for(let t=0;t<e.length;t++){let s=e[t].getAttribute("value"),a=e[t].getAttribute("for"),l=n[a];i.values[l]=parseFloat(s)}}null===l?s.addNode2(i.n1,i.values):s.addNode2(i.n1,i.values,l)}}(xmlDoc),function(e){let t=e.getElementsByTagName("edges")[0].getElementsByTagName("edge");for(let e=0;e<t.length;e++){let n={},a=t[e].getAttribute("source"),l=t[e].getAttribute("target");n.n1=parseInt(a),n.n2=parseInt(l),n.values={};let o=t[e].getElementsByTagName("attvalues");if(o.length>0){let e=o[0].getElementsByTagName("attvalue");for(let t=0;t<e.length;t++){let s=e[t].getAttribute("value"),a=e[t].getAttribute("for"),l=i[a];n.values[l]=parseFloat(s)}}s.addEdge2(n.n1,n.n2,n.values)}}(xmlDoc),Graph.create(t,s);for(const e in n)sgv.graf.scopeOfValues.includes(n[e])||sgv.graf.scopeOfValues.push(n[e]);return!0},exportGraph:function(e){if(null==e)return null;function t(e){let t='      <node id="'+e.id;e.isLabelVisible()&&(t+='" label="'+e.getLabel()),t+='">\n',t+="        <attvalues>\n";for(const n in e.values)t+='          <attvalue for="'+e.parentGraph.getScopeIndex(n)+'" value="'+e.values[n]+'"/>\n';return t+="        </attvalues>\n",t+="      </node>\n",t}function n(e,t){let n='      <edge id="'+t+'" source="'+e.begin+'" target="'+e.end+'">\n';n+="        <attvalues>\n";for(const t in e.values)n+='          <attvalue for="'+e.parentGraph.getScopeIndex(t)+'" value="'+e.values[t]+'"/>\n';return n+="        </attvalues>\n",n+="      </edge>\n",n}var i='<?xml version="1.0" encoding="UTF-8"?>\n';i+='<gexf xmlns="http://gexf.net/1.2" version="1.2">\n',i+="  <meta>\n",i+="    <creator>IITiS.pl</creator>\n",i+="    <description>SimGraphVisualizer GEXF export</description>\n",i+="  </meta>\n",i+='  <graph defaultedgetype="undirected">\n',i+='    <attributes class="node">\n';for(const t in e.scopeOfValues){let n=e.scopeOfValues[t];"default"===n&&(n+=";"+e.type+";"+e.cols+","+e.rows+","+e.layers+","+e.KL+","+e.KR),i+='      <attribute id="'+t+'" title="'+n+'" type="float"/>\n'}i+="    </attributes>\n",i+="    <nodes>\n";for(const n in e.nodes)i+=t(e.nodes[n]);i+="    </nodes>\n",i+='    <attributes class="edge">\n';for(const t in e.scopeOfValues){i+='      <attribute id="'+t+'" title="'+e.scopeOfValues[t]+'" type="float"/>\n'}i+="    </attributes>\n",i+="    <edges>\n";let s=0;for(const t in e.edges)i+=n(e.edges[t],++s);return i+="    </edges>\n",i+="  </graph>\n",i+="</gexf>\n"}},FileIO={onLoadButton:()=>{let e=UI.tag("input",{type:"file",id:"inputfile",display:"none"});e.addEventListener("change",(t=>{void 0!==e.files[0]&&showSplashAndRun((()=>{FileIO.loadGraph(e.files[0])}))})),e.click()},onSaveButton:()=>new Promise(((e,t)=>{if("function"==typeof window.showSaveFilePicker){const n={suggestedName:"name.txt",excludeAcceptAllOption:!0,types:[{description:"Text file",accept:{"text/plain":[".txt"]}},{description:"GEXF files",accept:{"application/xml":[".gexf"]}}]};window.showSaveFilePicker(n).then((n=>{let i;n.name.endsWith(".txt")?i=new Blob([ParserTXT.exportGraph(sgv.graf)]):n.name.endsWith(".gexf")?i=new Blob([ParserGEXF.exportGraph(sgv.graf)]):t("point 1"),n.createWritable().then((t=>{t.write(i).then((()=>{t.close(),e("point 3 (OK)")}))})).catch((()=>{t("point 5")}))})).catch((()=>{t("point 2")}))}else sgv.dlgAlternateFileSave.show(),e("point 4 (OK)")})),download:(e,t,n)=>{let i=document.createElement("a"),s=new Blob([e],{type:n});i.download=t,i.innerHTML="Download graph file",null!=window.webkitURL?i.href=window.webkitURL.createObjectURL(s):(i.href=window.URL.createObjectURL(s),i.onclick=function(e){document.body.removeChild(e.target)},i.style.display="none",document.body.appendChild(i)),i.click()},alternateSave:(e,t)=>{if(".txt"===t){let n=ParserTXT.exportGraph(sgv.graf);FileIO.download(n,e+t,"text/plain")}else if(".gexf"===t){let n=ParserGEXF.exportGraph(sgv.graf);FileIO.download(n,e+t,"application/xml")}}};sgv.stringToScope=(e,t)=>{sgv.graf.loadScopeValues(t,e).n&&sgv.dlgCPL.addScope(t),sgv.dlgCPL.selScope(t)},FileIO.loadGraph=function(e){const t=e.name,n=new FileReader;e&&(n.addEventListener("error",(()=>{console.error(`Error occurred reading file: ${e.name}`)})),n.addEventListener("load",(()=>{FileIO.loadGraph2(t,n.result)})),t.endsWith("txt")||t.endsWith("gexf")?n.readAsText(e):console.error("Incorrect file extension..."))},FileIO.loadGraph2=function(e,t){e.endsWith("txt")?(Graph.remove(),ParserTXT.importGraph(t)):e.endsWith("gexf")&&(Graph.remove(),ParserGEXF.importGraph(t)&&Dispatcher.graphCreated())};const ScopePanel=function(e,t){let n,i;this.addScope=(e,t)=>{s.add(UI.option(e,e)),s.selectedIndex=t},this.delScope=(e,t)=>{let n=UI.findOption(s,e);n>-1&&s.remove(n),s.selectedIndex=t},this.selScope=e=>{let t=UI.findOption(s,e);t>-1&&(s.selectedIndex=t)},this.getScope=()=>s.value,this.getScopeIndex=()=>s.selectedIndex,this.refresh=()=>{if(null!==sgv.graf){UI.clearSelect(s,!0);for(const e in sgv.graf.scopeOfValues){let t=sgv.graf.scopeOfValues[e],n=UI.option(t,t);sgv.graf.currentScope===sgv.graf.scopeOfValues[e]&&(n.selected="selected"),s.appendChild(n)}}},"boolean"!=typeof e&&(e=!0),this.ui=UI.tag("div",{class:"sgvSelectBox",id:"ScopePanel"}),i=UI.tag("div",{class:"sgvD1",id:"cplDivDS"}),this.ui.appendChild(i),"string"==typeof t&&i.appendChild(UI.tag("label",{for:"cplDispValues"},{innerHTML:t}));let s=UI.tag("select",{id:"cplDispValues"});if(s.addEventListener("change",(()=>{sgv.graf.displayValues(s.value)})),i.appendChild(s),e){let e=UI.tag("input",{type:"button",class:"toolButton",id:"cplDelScope",value:""});e.addEventListener("click",(()=>{sgv.graf.delScopeOfValues(this.getScope());Dispatcher.graphChanged()})),i.appendChild(e);let t=UI.tag("input",{type:"button",class:"toolButton",id:"cplAddScope",value:""});t.addEventListener("click",(()=>{n.show(),i.style.display="none"})),i.appendChild(t),this.ui.appendChild((n=function(e){let t=!0;"string"==typeof e&&""!==e&&(t=!1);let n=UI.tag("div",{class:"sgvD1",id:"cplDivNS"},{textContent:isMobile?"":t?"add new scope: ":"edit scope: "}),s=UI.tag("input",{type:"text",id:"cplAddScopeInput",value:t?"newScope":e});n.appendChild(s);let a=UI.tag("input",{type:"button",class:"toolButton",id:"cplAcceptAddScope",value:""});a.addEventListener("click",(()=>{if(t){let e=s.value;sgv.graf.addScopeOfValues(e),Dispatcher.graphChanged()}n.style.display="none",i.style.display="inline"})),n.appendChild(a);let l=UI.tag("input",{type:"button",class:"toolButton",id:"cplSkipAddScope",value:""});return l.addEventListener("click",(()=>{n.style.display="none",i.style.display="block"})),n.appendChild(l),n.style.display="none",{ui:n,show:()=>n.style.display="block",hide:()=>n.style.display="none"}}()).ui)}},SlidersPanel=function(){var e,t,n,i;this.ui=UI.tag("div",{id:"LimitSlidersPanel"}),this.ui.appendChild(n=UI.tag("span",{id:"spanRed"},{textContent:"-1.0"})),(e=UI.tag("input",{type:"range",class:"graphLimit",id:"redLimit",value:"-1.0",min:"-1.0",max:"0.0",step:"0.01"})).addEventListener("input",(async e=>{null!==sgv.graf&&(sgv.graf.redLimit=e.target.value,n.textContent=sgv.graf.redLimit+" ",sgv.graf.displayValues())})),this.ui.appendChild(e),this.ui.appendChild(UI.tag("span",{id:"spanZero"},{textContent:" 0 "})),(t=UI.tag("input",{type:"range",class:"graphLimit",id:"greenLimit",value:"1.0",min:"0.0",max:"1.0",step:"0.01"})).addEventListener("input",(async e=>{null!==sgv.graf&&(sgv.graf.greenLimit=e.target.value,i.textContent=" "+sgv.graf.greenLimit,sgv.graf.displayValues())})),this.ui.appendChild(t),this.ui.appendChild(i=UI.tag("span",{id:"spanGreen"},{textContent:"1.0"})),this.refresh=()=>{if(null===sgv.graf)return;let s=sgv.graf.getMinMaxVal();var a,l;s.min>0&&(s.min=Number.NaN),s.max<0&&(s.max=Number.NaN),a=s.min,isNaN(a)?(e.disabled="disabled",n.textContent="NaN"):(a=Math.floor(100*a)/100,sgv.graf.redLimit<a&&(sgv.graf.redLimit=a),e.min=a,e.value=sgv.graf.redLimit,n.textContent=sgv.graf.redLimit+" ",e.disabled=""),l=s.max,isNaN(l)?(t.disabled="disabled",i.textContent="NaN"):(l=Math.ceil(100*l)/100,sgv.graf.greenLimit>l&&(sgv.graf.greenLimit=l),t.max=l,t.value=sgv.graf.greenLimit,i.textContent=" "+sgv.graf.greenLimit,t.disabled="")}},DlgCPL=function(){var e,t,n,i,s,a=function(){let a=UI.tag("div",{class:"sgvUIwindow disable-select",id:"sgvDlgCPL"});function l(){var e=UI.tag("div",{class:"content",id:"graphDescription"});return e.append(function(){let e=UI.tag("div",{}),t=UI.tag("sub");return t.append(UI.span("0",{id:"dscr_KL"}),",",UI.span("0",{id:"dscr_KR"})),e.append("Current graph is ",UI.span("unknown",{id:"dscr_type"}),"-like, size: ",UI.span("0",{id:"dscr_cols"}),"x",UI.span("0",{id:"dscr_rows"}),"xK",t,UI.tag("br"),"Number of nodes: ",UI.span("0",{id:"dscr_nbNodes"}),", number of edges: ",UI.span("0",{id:"dscr_nbEdges"})),{ui:e}}().ui,(i=new ScopePanel(!0,"current scope: ")).ui,(s=new SlidersPanel).ui,function(){let e,t,n,i,s,a=UI.tag("div",{id:"panelBtns"});return a.appendChild(e=UI.createTransparentBtn1("display mode","cplDispModeButton",(()=>{Graph.switchDisplayMode()}))),a.appendChild(t=UI.createTransparentBtn1("cell view","cplCellViewButton",(()=>{sgv.dlgCellView.switchDialog()}))),a.appendChild(n=UI.createTransparentBtn1("show console","cplShowConsoleButton",(()=>{sgv.dlgConsole.switchConsole()}))),a.appendChild(i=UI.createTransparentBtn1("save graph","cplSaveButton",(()=>{FileIO.onSaveButton().then((e=>console.log(e))).catch((e=>console.log(e)))}))),a.appendChild(s=UI.createTransparentBtn1("delete graph","cplClearButton",(()=>{Graph.remove()}))),{ui:a}}().ui),e.style.display="none",{ui:e,addButton:(t,n,i)=>{e.appendChild(UI.createTransparentBtn1(t,n,i))},updateInfo:()=>{a.querySelector("#dscr_type").textContent=sgv.graf.type,a.querySelector("#dscr_cols").textContent=sgv.graf.cols,a.querySelector("#dscr_rows").textContent=sgv.graf.rows,a.querySelector("#dscr_KL").textContent=sgv.graf.KL,a.querySelector("#dscr_KR").textContent=sgv.graf.KR,a.querySelector("#dscr_nbNodes").textContent=Object.keys(sgv.graf.nodes).length,a.querySelector("#dscr_nbEdges").textContent=Object.keys(sgv.graf.edges).length},show:()=>{e.style.display="block"},hide:()=>{e.style.display="none"}}}return(e=UI.tag("div",{})).append((t=function(){let e,t,n;var i=UI.tag("div",{class:"content",id:"graphSelection"});return i.appendChild(e=UI.createTransparentBtn1("show console","cplShowConsoleButton",(()=>{sgv.dlgConsole.switchConsole()}))),i.appendChild(t=UI.createTransparentBtn1("create graph","cplCreateButton",(()=>{sgv.dlgCreateGraph.show()}))),i.appendChild(n=UI.createTransparentBtn1("load graph","cplLoadButton",(()=>{FileIO.onLoadButton()}))),i.style.display="block",{ui:i,show:()=>{i.style.display="block"},hide:()=>{i.style.display="none"}}}()).ui,(n=l()).ui),a.appendChild(e),a.appendChild(UI.tag("div",{id:"switch"},{innerHTML:"· · ·"},{click:()=>r()})),a.style.display="block",a}();function l(){e.style.display="block"}function o(){e.style.display="none"}function r(){"none"===e.style.display?l():o()}return window.addEventListener("load",(()=>{window.document.body.appendChild(a)})),{showPanel:l,hidePanel:o,switchPanel:r,setModeDescription:function(){n.updateInfo(),s.refresh(),i.refresh(),t.hide(),n.show()},setModeSelection:function(){t.show(),n.hide()},updateSliders:s.refresh,addButton:n.addButton,addScope:i.addScope,delScope:i.delScope,selScope:i.selScope,refresh:function(){s.refresh(),i.refresh()}}};sgv.dlgCPL=new DlgCPL;class DlgConsole{constructor(){this.cmdHistory=[],this.cmdHistoryPtr=-1,this.movable=!1,this.ui=this.createUI("sgvConsole"),this.initConsole(),window.addEventListener("load",(()=>{window.document.body.appendChild(this.ui)}))}initConsole(){let e=this.ui.querySelector("#commandline");e.addEventListener("keydown",(t=>{if("Enter"===t.key){let t=document.getElementById("consoleHistory");t.textContent+="> "+e.value+"\n",t.textContent+=this.parseCommand(e.value)+"\n",t.scrollTop=t.scrollHeight,this.cmdHistory.length>10&&this.cmdHistory.shift(),this.cmdHistory.push(e.value),this.cmdHistoryPtr=this.cmdHistory.length,e.value=""}else 38===t.keyCode?this.cmdHistoryPtr>0&&(this.cmdHistoryPtr--,e.value=this.cmdHistory[this.cmdHistoryPtr]):40===t.keyCode&&(this.cmdHistoryPtr<this.cmdHistory.length?(e.value=this.cmdHistory[this.cmdHistoryPtr],this.cmdHistoryPtr++):e.value="")})),this.ui.querySelector(".hidebutton").addEventListener("click",(()=>{this.hideConsole()}))}createUI(e){var t=UI.createEmptyWindow("sgvUIwindow",e,"console",!0);return t.innerHTML+='<div class="content">                 <textarea id="consoleHistory" readonly></textarea>                 <input type="text" id="commandline">             </div>',t}parseCommand(e){function t(e){switch(e){case"set":return"Set or remove value of node or edge\n\nset [nodeId](=value)\nset [nodeId]+[nodeId](=value)";case"create":return"Create new default graph\n\ncreate [chimera|pegasus] [4|8|12|16],[4|8|12|16],[1..4],[1..4]";case"clear":return"Remove current graph if exists\n\nclear";case"display":return"Switch between sets of displayed values\n\ndisplay [valueId]";case"displaymode":return"Set style of graph display.\n\ndisplaymode [classic|triangle|diamond]";default:return"For more information on a specific command, type: help command-name\n\nset\t\tSet or remove value of node or edge\ncreate\t\tCreate new default graph\nclear\t\tRemove current graph if exists\ndisplay\t\tSwitch between sets of displayed values\ndisplaymode\tSet style of graph display"}}var n=(e=e.trim().toLowerCase().replace(/\s+/g," ")).split(" ");let i=e.indexOf(" ");var s,a=e.substring(i+1).replace(/\s+/g,""),l="";switch(n[0].trim()){case"help":case"?":l=t(n[1]);break;case"limits":l=function(e){if(null===sgv.graf)return"no graph defined";let t="";if(1===e.length){t="Current display limits [red, green] are set to ["+sgv.graf.redLimit+", "+sgv.graf.greenLimit+"]\n";let e=sgv.graf.getMinMaxNodeVal();return t+="\nnode values range in current scope is: ["+e.min+", "+e.max+"] "+e.com,e=sgv.graf.getMinMaxEdgeVal(),t+="\nedge weights range in current scope is: ["+e.min+", "+e.max+"] "+e.com,t}if("set"!==e[1])return"bad arguments";{if(e.length<4)return"too few arguments\nUse: limits set <min> <max>";let n=parseFloat(e[2].replace(/,/g,".")),i=parseFloat(e[3].replace(/,/g,"."));if(isNaN(n)||isNaN(i))return"Bad arguments: <min> and <max> should be numbers.";if(n>0||i<0||n===i)return"Bad arguments: <min> cannot be greater than zero, <max> cannot be less than zero and both values cannot be zero at the same time.";sgv.graf.redLimit=n,sgv.graf.greenLimit=i,t="Display limits [red, green] are set to ["+sgv.graf.redLimit+", "+sgv.graf.greenLimit+"]"}return sgv.graf.displayValues(sgv.graf.currentScope),t}(n);break;case"create":l=function(e,t){if("chimera"!==e&&"pegasus"!==e)return"unknown graph type, use: chimera or pegasus";if(null===sgv.graf){let n=new GraphDescr;n.setType(e);const i=t.split(",");if(i.length>=5)n.setSize(parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10),parseInt(i[3],10),parseInt(i[4],10));else{if(4!==i.length||"chimera"!==e)return"bad arguments";n.setSize(parseInt(i[0],10),parseInt(i[1],10),1,parseInt(i[2],10),parseInt(i[3],10))}return Graph.create(n),"graph created"}return"graf exists, type: clear <Enter> to delete it"}(n[1],n[2]);break;case"clear":Graph.remove(),l="graph removed";break;case"set":l=function(e){if(null===sgv.graf)return"no graph defined";let t=e.split("=");if(console.log(t),t.length<2)return"too few arguments";let n=parseFloat(t[1].replace(/,/g,".")),i=t[0].split("+");return 1===i.length?function(e,t){if("q"===e[0][0]){let n=parseInt(e[0].slice(1),10);if(isNaN(n)||0===n||n>sgv.graf.maxNodeId())return"bad node Id";if(isNaN(t))return n in sgv.graf.nodes?(sgv.graf.delNode(n.toString()),"deleted node q"+n):"node q"+n+" already deleted";if(n in sgv.graf.nodes)return sgv.graf.setNodeValue(n,t),"modified node q"+n+" = "+t;if(n in sgv.graf.missing){sgv.graf.restoreNode(n);let e=document.getElementById("rest"+n);return e.parentNode.removeChild(e),sgv.graf.setNodeValue(n,t),"restored and modified node q"+n+" = "+t}return sgv.graf.addNode(n,t),"added node q"+n+" = "+t}}(i,n):2===i.length?function(e,t){if("q"===e[0][0]&&"q"===e[1][0]){let n=parseInt(e[0].slice(1),10),i=parseInt(e[1].slice(1),10);if(isNaN(n)||0===n)return"bad node Id: "+e[0];if(isNaN(i)||0===i)return"bad node Id: "+e[1];let s=n+","+i;return n>i&&(s=i+","+n),isNaN(t)?s in sgv.graf.edges?(sgv.graf.delEdge(s),"deleted edge "+s):"edge "+s+" not exists":s in sgv.graf.edges?(sgv.graf.setEdgeValue(s,t),"modified edge "+s):n in sgv.graf.nodes&&i in sgv.graf.nodes?(sgv.graf.addEdge(n,i).setValue(t),"added edge "+s):"NOT DONE: both connected nodes must exist in the graph"}}(i,n):"bad arguments"}(a);break;case"scope":l=function(e,t){if(null===sgv.graf)return"no graph defined";switch(e){case"list":return sgv.graf.scopeOfValues.toString();case"add":let e=sgv.graf.addScopeOfValues(t);return e>=0&&(sgv.dlgCPL.addScope(t,e),sgv.graf.displayValues(t)),"Added scope "+t;case"delete":let n=sgv.graf.delScopeOfValues(t);return n>=0?(sgv.dlgCPL.delScope(t,n),"Deleted scope "+t+", current scope: "+sgv.graf.currentScope):"Scope "+t+" could not to be deleted... Current scope: "+sgv.graf.currentScope;case"set":return sgv.graf.hasScope(t)?(sgv.graf.displayValues(t)&&sgv.dlgCPL.selScope(t),"Current scope: "+sgv.graf.currentScope):"Bad scope name: "+t+"... Current scope: "+sgv.graf.currentScope;default:return"Current scope: "+sgv.graf.currentScope}}(n[1],n[2]);break;case"display":s=n[1],l="displayed value: "+sgv.graf.displayValues(s);break;case"displaymode":null===sgv.graf?l="graph is not defined":Graph.displayModes.includes(n[1])?(Graph.currentDisplayMode=n[1],sgv.graf.setDisplayMode(),l="current displayMode = "+n[1]):l="unknown mode\n\n"+t("displaymode");break;default:l="unknown command\n\n"+t()}return l}switchConsole(){"block"!==this.ui.style.display?this.ui.style.display="block":this.ui.style.display="none"}showConsole(){this.ui.style.display="block"}hideConsole(){this.ui.style.display="none"}}sgv.dlgConsole=new DlgConsole;const DlgCellView=function(){var e,t,n,i,s,a,l,o,r=null;const d=600,c=600,p=d/2,u=c/2;var g=function(){a=l=o=0;let r=UI.createEmptyWindow("sgvUIwindow","sgvCellView","Cell view",!0);r.querySelector(".hidebutton").addEventListener("click",(function(){L()}));let p=UI.tag("div",{class:"content",id:"main"}),u=UI.tag("div",{id:"svg"});s=SVG.createSVG2("svgView",d,c,(e=>{"svgView"===e.target.id&&(sgv.dlgNodeProperties.hide(),sgv.dlgEdgeProperties.hide())})),u.appendChild(s),p.appendChild(u);let g=UI.tag("div",{class:"tools",id:"cellViewTools"});return g.style["text-align"]="center",(e=UI.tag("select",{id:"graphCols"})).addEventListener("change",(()=>{S(parseInt(e.value,10),parseInt(t.value,10),parseInt(n.value,10))})),g.appendChild(UI.tag("label",{for:"graphCols"},{innerHTML:" column: "})),g.appendChild(e),(t=UI.tag("select",{id:"graphRows"})).addEventListener("change",(()=>{S(parseInt(e.value,10),parseInt(t.value,10),parseInt(n.value,10))})),g.appendChild(UI.tag("label",{for:"graphRows"},{innerHTML:" row: "})),g.appendChild(t),(n=UI.tag("select",{id:"graphLays"})).addEventListener("change",(()=>{S(parseInt(e.value,10),parseInt(t.value,10),parseInt(n.value,10))})),g.appendChild(UI.tag("label",{for:"graphLays"},{innerHTML:" layer: "})),g.appendChild(n),g.appendChild((i=new ScopePanel).ui),p.appendChild(g),p.appendChild(UI.createTransparentBtn1("CLOSE","CloseButton",(()=>{L()}))),r.appendChild(p),r.style.display="none",r}();g.addEventListener("keydown",(function(e){let t=e.key;"ArrowLeft"===t?l>0&&S(l-1,a,o):"ArrowRight"===t?l<sgv.graf.cols-1&&S(l+1,a,o):"ArrowUp"===t?a<sgv.graf.rows-1&&S(l,a+1,o):"ArrowDown"===t?a>0&&S(l,a-1,o):"PageUp"===t?o<sgv.graf.layers-1&&S(l,a,o+1):"PageDown"===t?o>0&&S(l,a,o-1):"Escape"===t&&L()}));var h=null,f=null;function v(e,t){const n={classic:[{x:-60,y:150},{x:-90,y:50},{x:-120,y:-50},{x:-150,y:-150},{x:140,y:200},{x:110,y:100},{x:80,y:0},{x:50,y:-100}]};return{x:p+n[t="classic"][e].x,y:u+n[t][e].y}}function b(e){e.preventDefault();let t=e.target.id.split("_");t.length>1?id=t[1]:id=e.target.id;let n=QbDescr.fromNodeId(id,sgv.graf.rows,sgv.graf.cols);S(n.x,n.y,n.z);let i=e.target.getBoundingClientRect();sgv.dlgNodeProperties.show(id,i.x,i.y)}function y(e){e.preventDefault();let t=e.target.id.split("_"),n=e.target.getBoundingClientRect();t.length>1?sgv.dlgNodeProperties.show(t[1],n.x,n.y):sgv.dlgNodeProperties.show(e.target.id,n.x,n.y)}function w(e){e.preventDefault();let t=e.target.id.split("_"),n=e.target.getBoundingClientRect();t.length>1?sgv.dlgEdgeProperties.show(t[1],n.x,n.y):sgv.dlgEdgeProperties.show(e.target.id,n.x,n.y)}function m(e,t,n,i,a){let l=e+t,o=Edge.calcId(l,n);if(o in sgv.graf.edges){let e=sgv.graf.edgeValue(o),l=valueToColor(e),r=2+5*valueToEdgeWidth(e),d=valueToColor(sgv.graf.nodeValue(n));SVG.drawSvgEdge(s,o,v(t).x,v(t).y,i,a,l.toHexString(),r,w),SVG.drawSvgText(s,n,i,a,n,"yellow",d.toHexString(),b)}}function I(e,t,n){let i=e+t,a=e+n,l=Edge.calcId(i,a);if(l in sgv.graf.edges){let e=sgv.graf.edgeValue(l),i=valueToColor(e),a=2+5*valueToEdgeWidth(e);SVG.drawSvgEdge(s,l,v(t).x,v(t).y,v(n).x,v(n).y,i.toHexString(),a,w)}}function C(e,t){let n=e+t;if(n in sgv.graf.nodes){let e=valueToColor(sgv.graf.nodeValue(n));SVG.drawSvgNode(s,n,v(t).x,v(t).y,20,e.toHexString(),y),SVG.drawSvgText(s,n,v(t).x,v(t).y,n.toString(),"yellow","",y)}}function S(r,p,u){if(s.innerHTML="",null===sgv.graf)return;void 0===r?r=l:l=r<sgv.graf.cols?r:r=0,void 0===p?p=a:a=p<sgv.graf.rows?p:p=0,void 0===u?u=o:o=u<sgv.graf.layers?u:u=0;sgv.graf.rows,sgv.graf.cols;UI.selectByKey(e,r),UI.selectByKey(t,p),UI.selectByKey(n,u),i.selScope(sgv.graf.currentScope);let g=function(e,t,n){let i=n*sgv.graf.cols*sgv.graf.rows;return i+=t*sgv.graf.cols,i+=e,i*=8,i+=1,i}(r,p,u),h=20,f=d-20,b=c-20,y=[{x:115,y:-40},{x:75,y:-40},{x:45,y:-30},{x:45,y:-10},{x:45,y:10},{x:45,y:30},{x:75,y:40},{x:115,y:40}],w=[{x:f-95,y:-40},{x:f-55,y:-40},{x:f-25,y:-30},{x:f-25,y:-10},{x:f-25,y:10},{x:f-25,y:30},{x:f-55,y:40},{x:f-95,y:40}],S={};for(let e=0;e<8;e++){let t=sgv.graf.findAllConnected(g+e);for(let n of t.internal){let t=Edge.calcId(g+e,n);t in S||(I(g,e,(n-1)%8),S[t]=1)}for(let n of t.horizontal)m(g,e,n,g+e<n?f:h,v(e).y);for(let n of t.vertical)m(g,e,n,v(e).x,g+e<n?20:b);let n=0;if(e<4){for(let i of t.up)m(g,e,i,y[n].x,v(e).y+y[n].y),n++;for(let i of t.down)m(g,e,i,y[n].x,v(e).y+y[n].y),n++}else{for(let i of t.up)m(g,e,i,w[n].x,v(e).y+w[n].y),n++;for(let i of t.down)m(g,e,i,w[n].x,v(e).y+w[n].y),n++}C(g,e)}}function N(){UI.clearSelect(e,!0);for(let t=0;t<sgv.graf.cols;t++)e.appendChild(UI.option(t,t));e.selectedIndex=l,UI.clearSelect(t,!0);for(let e=0;e<sgv.graf.rows;e++)t.appendChild(UI.option(e,e));t.selectedIndex=a,UI.clearSelect(n,!0);for(let e=0;e<sgv.graf.layers;e++)n.appendChild(UI.option(e,e));n.selectedIndex=o,1===sgv.graf.layers?n.disabled="disabled":n.disabled="",i.refresh(),S(),g.style.display="block",r=window.document.activeElement,g.focus({focusVisible:!1})}function L(){null!==r&&r.focus({focusVisible:!1}),g.style.display="none"}return g.addEventListener("touchstart",(function(e){const t=function(e){return e.touches||e.originalEvent.touches}(e)[0];h=t.clientX,f=t.clientY}),!1),g.addEventListener("touchmove",(function(e){if(!h||!f)return;var t=e.touches[0].clientX,n=e.touches[0].clientY,i=h-t,s=f-n;Math.abs(i)>Math.abs(s)?i>0?l<sgv.graf.cols-1&&S(l+1,a,o):l>0&&S(l-1,a,o):s>0?a>0&&S(l,a-1,o):a<sgv.graf.rows-1&&S(l,a+1,o);h=null,f=null}),!1),window.addEventListener("load",(()=>{window.document.body.appendChild(g)})),{refresh:S,switchDialog:function(){"none"===g.style.display?N():L()},show:N,hide:L}};sgv.dlgCellView=new DlgCellView;const DlgCreateGraph=function(){var e,t,n,i,s,a,l,o=function(){let o=UI.tag("dialog",{class:"sgvUIwindow sgvModalDialog",id:"sgvDlgCreateGraph"}),d=UI.createTitlebar("Create graph",!1);o.appendChild(d);let c=UI.tag("div",{class:"content",id:"graphSelection"});c.appendChild(UI.tag("div",{id:"description"}));let p=UI.tag("div",{id:"description"});p.style["text-align"]="center",(e=UI.tag("select",{id:"graphType"})).appendChild(UI.option("chimera","chimera")),e.appendChild(UI.option("pegasus","pegasus")),e.addEventListener("change",(e=>{"chimera"===e.target.value?(i.selectedIndex=0,i.disabled="disabled"):i.disabled=""})),p.appendChild(UI.tag("label",{for:"graphType"},{innerHTML:"graph type: "})),p.appendChild(e),p.appendChild(UI.tag("hr")),t=UI.tag("select",{id:"graphCols"});for(let e=1;e<17;e++)t.appendChild(UI.option(e,e));UI.selectByKey(t,4),p.appendChild(UI.tag("label",{for:"graphCols"},{innerHTML:" columns: "})),p.appendChild(t),n=UI.tag("select",{id:"graphRows"});for(let e=1;e<17;e++)n.appendChild(UI.option(e,e));UI.selectByKey(n,4),p.appendChild(UI.tag("label",{for:"graphRows"},{innerHTML:" rows: "})),p.appendChild(n),i=UI.tag("select",{id:"graphLays"});for(let e=1;e<6;e++)i.appendChild(UI.option(e,e));UI.selectByKey(i,1),i.disabled="disabled",p.appendChild(UI.tag("label",{for:"graphLays"},{innerHTML:" layers: "})),p.appendChild(i),p.appendChild(UI.tag("hr")),(s=UI.tag("select",{id:"graphKL"})).appendChild(UI.option("1","1")),s.appendChild(UI.option("2","2")),s.appendChild(UI.option("3","3")),s.appendChild(UI.option("4","4",!0)),p.appendChild(UI.tag("label",{for:"graphKL"},{innerHTML:"module size: K = "})),p.appendChild(s),(a=UI.tag("select",{id:"graphKR"})).appendChild(UI.option("1","1")),a.appendChild(UI.option("2","2")),a.appendChild(UI.option("3","3")),a.appendChild(UI.option("4","4",!0)),p.appendChild(UI.tag("label",{for:"graphKR"},{innerHTML:", "})),p.appendChild(a),c.appendChild(p);let u=UI.tag("div",{id:"buttons"}),g=UI.tag("input",{type:"button",class:"actionbutton",id:"cplCancelButton",name:"cancelButton",value:"Cancel"});g.addEventListener("click",(()=>{r()})),u.appendChild(g);let h=UI.tag("input",{type:"button",class:"actionbutton",id:"cplCreateButton",name:"createButton",value:"Create"});return h.addEventListener("click",(()=>{!function(){let o=function(){let l=new GraphDescr;return l.setType(e.value),l.setSize(parseInt(t.value,10),parseInt(n.value,10),parseInt(i.value,10),parseInt(s.value,10),parseInt(a.value,10)),l}();showSplashAndRun((()=>{r(),setTimeout((()=>{Graph.create(o,l)}),100)}),!0)}()})),u.appendChild(h),c.appendChild(u),o.appendChild(c),o.style.display="none",o}();function r(){o.close(),o.style.display="none"}return window.addEventListener("load",(()=>{window.document.body.appendChild(o)})),{d:l,show:function(r,d){"load"===r?(o.querySelector("#cplCreateButton").value="Load",o.querySelector(".titleText").textContent="Load graph"):(o.querySelector("#cplCreateButton").value="Create",o.querySelector(".titleText").textContent="New graph"),o.style.display="block",d instanceof TempGraphStructure?(l=d,function(){let o=0;l.nodes.forEach((e=>{o<e.id&&(o=e.id)})),o--;let r=o>>3;o%8&&r++;let d=new GraphDescr;switch(r){case 4:d.set("chimera",2,2,1,4,4);break;case 9:d.set("chimera",3,3,1,4,4);break;case 16:default:d.set("chimera",4,4,1,4,4);break;case 64:d.set("chimera",8,8,1,4,4);break;case 144:d.set("chimera",12,12,1,4,4);break;case 256:d.set("chimera",16,16,1,4,4);break;case 12:d.set("pegasus",2,2,3,4,4);break;case 27:d.set("pegasus",3,3,3,4,4);break;case 48:d.set("pegasus",4,4,3,4,4);break;case 192:d.set("pegasus",8,8,3,4,4);break;case 432:d.set("pegasus",12,12,3,4,4);break;case 768:d.set("pegasus",16,16,3,4,4)}UI.selectByKey(e,d.type),UI.selectByKey(t,d.size.cols),UI.selectByKey(n,d.size.rows),UI.selectByKey(i,d.size.lays),UI.selectByKey(s,d.size.KL),UI.selectByKey(a,d.size.KR),"chimera"===d.type?i.disabled="disabled":i.disabled=""}()):l=null,o.showModal()},hide:r}};sgv.dlgCreateGraph=new DlgCreateGraph;const DlgEdgeProperties=function(){var e,t,n,i,s,a,l,o,r,d=null,c=!0,p=function(){let d=UI.createEmptyWindow("sgvUIwindow","sgvEdgeProperties","Edge properties",!0);d.querySelector(".hidebutton").addEventListener("click",(function(){g()})),i=UI.newInput("hidden","0","","edgeId"),d.appendChild(i),e=UI.tag("div",{class:"content"}),(s=UI.tag("select",{id:"selectEdgeId"})).appendChild(UI.tag("option",{value:0,selected:!0},{innerHTML:"-- id --"})),s.addEventListener("change",(function(){u(event.target.value)})),e.appendChild(UI.tag("label",{for:"selectEdgeId"},{innerHTML:"Edge: "})),e.appendChild(s),d.appendChild(e),t=UI.tag("div",{class:"content"}),d.appendChild(t),t.appendChild((a=new ScopePanel(!1,"scope: ")).ui);var c=UI.tag("div",{id:"ValueBlock"});return(l=UI.newInput("checkbox","","","valueCheckE")).addEventListener("click",(function(){!function(){let e=l.checked,t=a.getScope();if(e){let e=parseFloat(o.value.replace(/,/g,"."));(""===e||isNaN(e))&&(e=0),sgv.graf.setEdgeValue(i.value,e,t)}else sgv.graf.delEdgeValue(i.value,t);Dispatcher.graphChanged()}()})),c.appendChild(l),(o=UI.newInput("number","0","","wagaE")).addEventListener("change",(function(){h()})),c.appendChild(o),(r=UI.newInput("button","set","setvaluebutton","setE")).addEventListener("click",(function(){h()})),c.appendChild(r),t.appendChild(c),d.appendChild(n=UI.tag("div",{class:"content"},{innerHTML:"Select an edge, please."})),d.appendChild(UI.createTransparentBtn1("CLOSE","CloseButton",(()=>{g()}))),d.appendChild(UI.createTransparentBtn1("DELETE","DeleteButton",(()=>{g(),sgv.graf.delEdge(i.value)}))),d}();function u(e,u,g){if(void 0!==e?(e=e.toString(),i.value=e):e=i.value,"0"===e)return t.style.display="none",void(n.style.display="block");n.style.display="none",t.style.display="block",UI.clearSelect(s,!1);for(const e in sgv.graf.edges)s.appendChild(UI.tag("option",{value:e},{innerHTML:"q"+sgv.graf.edges[e].begin+" - q"+sgv.graf.edges[e].end}));UI.selectByKey(s,e),a.refresh();let h=sgv.graf.edgeValue(e);if(null===h||isNaN(h)?(l.checked="",o.value=null,o.disabled="disabled",r.disabled="disabled"):(l.checked="checked",o.value=h,o.disabled="",r.disabled=""),!isMobile&&c&&(c=!1,void 0!==u&&void 0!==g)){let e=sgv.canvas.clientLeft;p.style.top=g+"px",p.style.left=e+u+"px"}p.style.display="block",d=window.document.activeElement,p.focus({focusVisible:!1})}function g(){null!==d&&d.focus({focusVisible:!1}),null!==p&&(p.style.display="none")}function h(){let e=parseFloat(o.value.replace(/,/g,".")),t=a.getScope();""===e||isNaN(e)?sgv.graf.delEdgeValue(i.value,t):sgv.graf.setEdgeValue(i.value,e,t),Dispatcher.graphChanged()}return p.addEventListener("keydown",(function(e){"Escape"===e.key&&g()})),window.addEventListener("load",(()=>{window.document.body.appendChild(p),g()})),{show:u,hide:g,refresh:function(){"block"===p.style.display&&u()},isVisible:()=>null!==p&&"block"===p.style.display}};sgv.dlgEdgeProperties=new DlgEdgeProperties;const ValuePanel=function(){var e,t,n,i,s,a=UI.tag("div",{id:"ValueBlock"});function l(){let e=parseFloat(n.value.replace(/,/g,"."));sgv.graf.setNodeValue(i,e,s),Dispatcher.graphChanged()}function o(){let a=sgv.graf.nodeValue(i,s);null===a||isNaN(a)?(t.checked="",n.value=null,n.disabled="disabled",e.disabled="disabled"):(t.checked="checked",n.value=a,n.disabled="",e.disabled="")}return(t=UI.newInput("checkbox","","","valueCheckN")).addEventListener("click",(function(t){!function(t){if(t){n.disabled="",e.disabled="";let t=parseFloat(n.value.replace(/,/g,"."));isNaN(t)&&(t=0,n.value=t),console.log(t),sgv.graf.setNodeValue(i,t,s)}else n.disabled="disabled",e.disabled="disabled",sgv.graf.delNodeValue(i,s);Dispatcher.graphChanged()}(t.target.checked)})),a.appendChild(t),(n=UI.newInput("number","0","","wagaN")).addEventListener("change",(function(){l()})),a.appendChild(n),(e=UI.newInput("button","set","setvaluebutton","setN")).addEventListener("click",(function(){l()})),a.appendChild(e),{ui:a,setNode:function(e){i=e,o()},setScope:function(e){s=e,o()},show:function(e,t){i=e,s=t,o()}}},DlgNodeProperties=function(){var e,t,n,i,s,a,l,o,r,d,c,p,u=null,g=!0,h=function(){let u=UI.createEmptyWindow("sgvUIwindow","sgvNodeProperties","Node properties",!0);u.querySelector(".hidebutton").addEventListener("click",(function(){b()})),e=UI.newInput("hidden","0","","nodeId"),u.appendChild(e);var g=UI.tag("div",{id:"main"});u.appendChild(g);var h=UI.tag("div",{id:"nodeid",class:"content"});(t=UI.tag("select",{id:"selectNodeId"})).appendChild(UI.tag("option",{value:0,selected:!0},{innerHTML:"-- id --"})),t.addEventListener("change",(function(){v(event.target.value)})),h.appendChild(UI.tag("label",{for:"selectNodeId"},{innerHTML:"Node: "})),h.appendChild(t),g.appendChild(h);let f=UI.tag("div",{id:"svg"});p=SVG.createSVG2("svgView",250,250,(e=>{"svgView"===e.target.id&&sgv.dlgEdgeProperties.hide()})),f.appendChild(p),g.appendChild(f),d=UI.tag("div",{id:"tools",class:"content"});var m=UI.tag("div",{id:"LabelBlock"});(l=UI.newInput("checkbox","","","checkLabelN")).addEventListener("click",(function(t){let n=t.target.checked;o.disabled=n?"":"disabled",sgv.graf.nodes[e.value].showLabel(n)})),m.appendChild(UI.tag("label",{for:"checkLabelN"},{innerHTML:"Label: "})),m.appendChild(l),(o=UI.newInput("text","","","editLabelN")).addEventListener("change",(function(t){sgv.graf.nodes[e.value].setLabel(t.target.value,!0)})),m.appendChild(o),d.appendChild(m),d.appendChild((n=new ScopePanel(!1,"scope: ")).ui),d.appendChild((r=new ValuePanel).ui);var I=UI.tag("div",{id:"ConnectBlock"});return(i=UI.newInput("button","connect to...","","connectN")).addEventListener("click",(function(){w()})),I.appendChild(i),s=UI.tag("select",{id:"destN"}),I.appendChild(s),(a=UI.newInput("button","^","","connectSelectN")).addEventListener("click",(function(){y()})),I.appendChild(a),d.appendChild(I),g.appendChild(d),c=UI.tag("div",{id:"zeroInfo",class:"content"},{innerHTML:"Select a node, please."}),g.appendChild(c),g.appendChild(UI.createTransparentBtn1("DELETE","DeleteButton",(()=>{!function(){let t=e.value;e.value=0,sgv.graf.delNode(t),b()}()}))),g.appendChild(UI.createTransparentBtn1("CLOSE","CloseButton",(()=>{b()}))),u}();function f(t){if(void 0===t&&(t=e.value),n.selScope(sgv.graf.currentScope),p.innerHTML="",t in sgv.graf.nodes){let e=valueToColor(sgv.graf.nodeValue(t));!function(e){let t=sgv.graf.findAllConnected(e),n=new Set;for(let e of t.internal)n.add(e);for(let e of t.horizontal)n.add(e);for(let e of t.vertical)n.add(e);for(let e of t.up)n.add(e);for(let e of t.down)n.add(e);let i=2*Math.PI/n.size,s=i;n.forEach((t=>{let n=100*Math.sin(s),a=100*Math.cos(s),l=Edge.calcId(e,t);if(l in sgv.graf.edges){let e=sgv.graf.edgeValue(l),i=valueToColor(e),s=2+5*valueToEdgeWidth(e),o=valueToColor(sgv.graf.nodeValue(t));SVG.drawSvgEdge(p,l,125,125,125+n,125+a,i.toHexString(),s,(e=>{let t=e.target.getBoundingClientRect();sgv.dlgEdgeProperties.show(l,t.x,t.y),sgv.dlgEdgeProperties.ui.style["z-index"]=101})),SVG.drawSvgText(p,t,125+n,125+a,t,"yellow",o.toHexString(),(()=>{v(t)}))}s+=i}))}(t),SVG.drawSvgNode(p,t,125,125,25,e.toHexString(),(()=>{})),SVG.drawSvgText(p,t,125,125,t.toString(),"yellow","",(()=>{}))}}function v(i,a,v){if(void 0!==i?(i=i.toString(),e.value=i):i=e.value,"0"===i)return d.style.display="none",c.style.display="block",void(p.innerHTML="");c.style.display="none",d.style.display="block",e.value=i,f(i),n.refresh(),r.show(i,sgv.graf.currentScope),l.checked="",o.value=sgv.graf.nodeLabel(i),sgv.graf.isNodeLabelVisible(i)?(l.checked="checked",o.disabled=""):o.disabled="disabled",UI.clearSelect(s,!0),UI.clearSelect(t,!1);for(const e in sgv.graf.nodes){let n=e.toString()!==i.toString();t.appendChild(UI.tag("option",{value:e},{innerHTML:"q"+e})),n&&s.appendChild(UI.tag("option",{value:e},{innerHTML:"q"+e}))}if(UI.selectByKey(t,i),!isMobile&&g&&(g=!1,void 0!==a&&void 0!==v)){let e=sgv.canvas.clientLeft;h.style.top=v+"px",h.style.left=e+a+"px"}h.style.display="block",u=window.document.activeElement,h.focus({focusVisible:!1})}function b(){null!==u&&u.focus({focusVisible:!1}),null!==h&&(h.style.display="none")}function y(){sgv.nodeToConnect=parseInt(h.querySelector("#nodeId").value,10),h.style.display="none"}function w(){var e=h.querySelector("#nodeId").value,t=h.querySelector("#destN").value;null!==sgv.graf&&(sgv.graf.addEdge(e,t),Dispatcher.graphChanged())}return h.addEventListener("keydown",(function(e){"Escape"===e.key&&b()})),window.addEventListener("load",(()=>{window.document.body.appendChild(h),b()})),{show:v,hide:b,refresh:function(){"block"===h.style.display&&v()},isVisible:()=>null!==h&&"block"===h.style.display}};sgv.dlgNodeProperties=new DlgNodeProperties;const DlgAlternateFileSave=function(){var e,t,n,i,s,a=function(){let a=UI.tag("dialog",{class:"sgvUIwindow sgvModalDialog",id:"sgvDlgAltSaveGraph"}),o=UI.createTitlebar("Save graph",!1);a.appendChild(o),content=UI.tag("div",{class:"content"}),content.appendChild(UI.tag("div",{},{style:"max-width:400px",textContent:"Your browser does not allow us to open the system window for selecting a file to save. Please select the file format and its name and click Save button. Depending on your browser's settings, the file will be saved in the default location (usually: Downloads) or a selection window will appear."})),content.appendChild(UI.tag("hr"));let r=UI.tag("div");(e=UI.tag("select",{id:"savSelectType"})).appendChild(UI.option(".txt","TXT")),e.appendChild(UI.option(".gexf","GEXF")),e.addEventListener("change",(e=>{n.textContent=e.target.value})),r.appendChild(UI.tag("label",{for:"savSelectType"},{innerHTML:"Select format: "})),r.appendChild(e),content.appendChild(r);let d=UI.tag("div");return t=UI.tag("input",{type:"text",id:"savSelectName",value:"filename"}),d.appendChild(UI.tag("label",{for:"savSelectname"},{innerHTML:"Select filename: "})),d.appendChild(t),n=UI.tag("span",{},{textContent:".txt"}),d.appendChild(n),content.appendChild(d),(i=UI.newInput("button","cancel","actionbutton","")).addEventListener("click",(function(){l()})),content.appendChild(i),(s=UI.newInput("button","save","actionbutton","")).addEventListener("click",(function(){FileIO.alternateSave(t.value,n.textContent),l()})),content.appendChild(s),a.appendChild(content),a.style.display="none",a}();function l(){a.close(),a.style.display="none"}return window.addEventListener("load",(()=>{window.document.body.appendChild(a)})),{show:function(){a.style.display="block",a.showModal()},hide:l}};sgv.dlgAlternateFileSave=new DlgAlternateFileSave;class DlgMissingNodes{constructor(){this.ui=this.createUI("sgvMissingNodes"),window.addEventListener("load",(()=>{window.document.body.appendChild(this.ui)}))}createUI(e){let t=UI.createEmptyWindow("sgvUIwindow",e,"removed nodes",!0);var n=UI.tag("div",{class:"content"});this.misN=UI.tag("div",{id:"misN"}),n.appendChild(this.misN);var i=UI.newInput("button","clear history","delbutton","");return i.addEventListener("click",(()=>{this.delAll()})),n.appendChild(i),t.appendChild(n),t}addNode(e){let t=UI.newInput("button"," q"+e+" ","","rest"+e);t.addEventListener("click",(()=>{this.restoreNode(e)})),this.misN.appendChild(t),this.ui.style.display="block"}restoreNode(e){if(sgv.graf.restoreNode(e)){let t=this.ui.querySelector("#rest"+e);return t.parentNode.removeChild(t),!0}return!1}delAll(){this.misN.innerHTML="",null!==sgv.graf&&(sgv.graf.missing={}),this.hide()}show(){this.ui.style.display="block"}hide(){this.ui.style.display="none"}}sgv.dlgMissingNodes=new DlgMissingNodes;class DlgAbout{constructor(){this.ui=null}create(){null===this.ui&&(this.ui=UI.tag("dialog",{class:"sgvUIwindow sgvModalDialog",id:"sgvDlgAbout"}));var e=UI.tag("div",{class:"content"});e.style["text-align"]="center",e.style.width="fit-content",e.innerHTML+='<div><img src="pics/EuroHPC.jpg"></div>',e.innerHTML+="<div>Narodowa Infrastruktura Superkomputerowa dla EuroHPC - EuroHPC PL</div>",e.innerHTML+='<div class="info">simGraphVisualizer v.1.0</div>',e.innerHTML+='<div><img src="pics/Flagi.jpg"></div>';let t=UI.tag("input",{type:"button",value:"Close",class:"actionbutton",id:"closeButton",name:"closeButton"});e.appendChild(t),t.addEventListener("click",(()=>{this.hide()}));let n=UI.createTitlebar("About",!1);this.ui.appendChild(n),this.ui.appendChild(e),this.ui.style.display="none",window.document.body.appendChild(this.ui)}show(){null===this.ui&&this.create(),this.ui.style.display="block",this.ui.showModal()}hide(){this.ui.close(),this.ui.style.display="none"}}sgv.dlgAbout=new DlgAbout;class DlgLoaderSplash{constructor(){this.ui=null,this.info}createDialog(){null===this.ui&&(this.ui=UI.tag("dialog",{class:"sgvModalDialog",id:"loaderSplash"})),this.ui.appendChild(UI.tag("span",{},{textContent:"working hard for you"})),this.ui.appendChild(UI.tag("div",{class:"loader"})),this.ui.appendChild(UI.tag("span",{},{textContent:"... please wait ..."})),this.ui.appendChild(this.info=UI.tag("div",{id:"infoBlock"})),this.ui.style.display="none",window.document.body.appendChild(this.ui)}show(){null===this.ui&&this.createDialog(),this.ui.open&&this.ui.close(),this.info.innerHTML="",this.ui.style.display="block",this.ui.showModal()}hide(){this.ui.close(),this.ui.style.display="none"}setInfo(e,t){this.ui.open&&this.ui.close(),this.ui.style.display="block",this.ui.showModal(),this.info.innerHTML=e,"function"==typeof t&&setTimeout((()=>{t()}),100)}}function showSplash(){sgv.dlgLoaderSplash.show()}function hideSplash(){setTimeout((function(){sgv.dlgLoaderSplash.hide()}),200)}function showSplashAndRun(e,t){void 0===t&&(t=!1),showSplash(),setTimeout((()=>{e(),t||hideSplash()}),100)}sgv.dlgLoaderSplash=new DlgLoaderSplash;const SingleFilePanel=function(e,t,n,i){var s=e,a=UI.tag("div",{class:"singleFilePanel"});a.style.padding="2px",a.style.margin="2px";var l=UI.newInput("text",t,"label","");a.appendChild(l);var o=UI.newInput("text",n,"path","");a.appendChild(o);var r=UI.newInput("text",i,"params","");a.appendChild(r);let d=UI.tag("input",{type:"button",class:"toolButton",value:"x"});return d.addEventListener("click",(e=>{SingleFilePanel.removeByUi(e.target.parentNode)})),a.appendChild(d),{id:s,ui:a,label:l,path:o,params:r,close:()=>{SingleFilePanel.removeByUi(a)}}};SingleFilePanel.panels=[],SingleFilePanel.removeByUi=function(e){e.parentNode.removeChild(e);for(var t=0;t<SingleFilePanel.panels.length;t++)SingleFilePanel.panels[t].ui===e&&SingleFilePanel.panels.splice(t,1)},SingleFilePanel.removeAll=function(){for(var e=SingleFilePanel.panels.length-1;e>=0;e--){let t=SingleFilePanel.panels[e].ui;t.parentNode.removeChild(t),SingleFilePanel.panels.splice(e,1)}},SingleFilePanel.create=function(e,t,n,i){return(SingleFilePanel.panels[SingleFilePanel.panels.length]=new SingleFilePanel(e,t,n,i)).ui};const DlgEditSettings=function(){var e,t,n=function(){let n=UI.tag("dialog",{class:"sgvUIwindow sgvModalDialog",id:"sgvDlgEditSettings"}),s=UI.createTitlebar("Edit settings",!1);n.appendChild(s);let a=UI.tag("div",{id:"switches"}),l=UI.tag("input",{type:"button",class:"actionbutton",id:"addPanelButton",name:"addPanelButton",value:"External programs"});l.style["border-bottom"]="0",l.style["background-color"]="rgba(0,0,0,1.0)",l.style.position="relative",l.style.top="2px",l.style["border-bottom-left-radius"]="0",l.style["border-bottom-right-radius"]="0",a.appendChild(l),n.appendChild(a);let o=UI.tag("div",{id:"switch_content"});o.style.border="1px solid #888",o.style["background-color"]="#000",(e=UI.tag("div",{id:"files"})).style["min-width"]="630px",e.style.padding="2px",o.appendChild(e);let r=UI.tag("input",{type:"button",class:"actionbutton",id:"addPanelButton",name:"addPanelButton",value:"add new"});r.addEventListener("click",(()=>{if(0===SingleFilePanel.panels.length)e.appendChild(SingleFilePanel.create(0,"label_0","path_0","params_0"));else{let t=SingleFilePanel.panels[SingleFilePanel.panels.length-1].id+1;e.appendChild(SingleFilePanel.create(t,"label_"+t,"path_"+t,"params_"+t))}})),o.appendChild(r),n.appendChild(o);let d=UI.tag("div",{id:"wd"});d.style.color="#ddd",d.style["padding-top"]="15px",d.style["text-align"]="center",d.appendChild(UI.span("Temporary directory: ",{id:"wDirLabel"}));let c=UI.tag("input",{type:"button",class:"actionbutton",id:"wdButton",name:"wdButton",value:"..."});c.style.width="auto",c.addEventListener("click",(()=>{void 0!==window.api&&window.api.invoke("getDirectoryDlg").then((e=>{t.value=e}))})),d.appendChild(c),t=UI.newInput("text","","","workingDir"),d.appendChild(t),n.appendChild(d);let p=UI.tag("div",{id:"buttons"}),u=UI.tag("input",{type:"button",class:"actionbutton",id:"cancelButton",name:"cancelButton",value:"Cancel"});u.addEventListener("click",(()=>{i()})),p.appendChild(u);let g=UI.tag("input",{type:"button",class:"actionbutton",id:"saveButton",name:"saveButton",value:"Save settings"});return g.addEventListener("click",(()=>{!function(){let e={workingDir:t.value,externApps:[]};for(const t of SingleFilePanel.panels)e.externApps.push({label:t.label.value,path:t.path.value,params:t.params.value});Settings.set(e),i()}()})),p.appendChild(g),n.appendChild(p),n}();function i(){n.close()}return window.addEventListener("load",(()=>{window.document.body.appendChild(n)})),{show:function(i,s){n.close(),SingleFilePanel.removeAll();let a=0;for(const t of i)e.appendChild(SingleFilePanel.create(a,t.label,t.path,t.params)),a++;t.value=s,n.showModal()},hide:i}};sgv.dlgEditSettings=new DlgEditSettings,void 0!==window.api?(console.log("desktopApp!"),window.api.on("showLoaderSplash",(()=>showSplash())),window.api.on("hideLoaderSplash",(()=>hideSplash())),window.api.on("setDisplayMode",(e=>{null!==sgv.graf&&(Graph.currentDisplayMode=e,sgv.graf.setDisplayMode())})),window.api.on("externalResult",(e=>{sgv.stringToScope(e,"result"),hideSplash()})),window.api.on("clearGraph",(()=>Graph.remove())),window.api.on("showAbout",(()=>sgv.dlgAbout.show())),window.api.on("showSettings",((e,t)=>sgv.dlgEditSettings.show(e,t))),window.api.on("createDefault",(()=>sgv.dlgCreateGraph.show())),window.api.on("switchConsole",(()=>sgv.dlgConsole.switchConsole())),window.api.on("switchCellView",(()=>sgv.dlgCellView.switchDialog())),window.api.on("loadFile",((e,t)=>{showSplashAndRun((()=>{FileIO.loadGraph2(e,t)}))})),window.api.on("clickSaveGraph",(e=>{showSplashAndRun((()=>{var t="";e.endsWith("txt")?t=ParserTXT.exportGraph(sgv.graf):e.endsWith("gexf")&&(t=ParserGEXF.exportGraph(sgv.graf)),window.api.invoke("saveStringToFile",t,e)}))})),window.api.on("saveEnd",(()=>hideSplash())),window.api.on("m2w_getScopeAsTXT_request",((e,...t)=>{console.log('2. (index.js) window.api.on("m2w_getScopeAsTXT_request")');let n=null!==sgv.graf?ParserTXT.exportGraph(sgv.graf):null;window.api.invoke(e,n,...t).then((t=>{console.log("4. (index.js) window.api.invoke("+e+").then()"),console.log("result = ",t)}))})),desktopInit=()=>{setTimeout((function(){sgv.dlgCPL.hidePanel()}),200)},enableMenu=(e,t)=>{void 0===t&&(t=!0),window.api.invoke("enableMenu",e,t)}):(desktopInit=()=>{},enableMenu=(e,t)=>{});